<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="wolfand11" />



<meta name="description" content="《Action Script Developer Guide To PureMVC》的读书笔记.
很早之前的一篇读书笔记，大部分是将原书内容翻译了一下。">
<meta property="og:type" content="article">
<meta property="og:title" content="Action Script Developer Guide To PureMVC">
<meta property="og:url" content="http://wolfand11.coding.me/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/index.html">
<meta property="og:site_name" content="wolfand11's blog">
<meta property="og:description" content="《Action Script Developer Guide To PureMVC》的读书笔记.
很早之前的一篇读书笔记，大部分是将原书内容翻译了一下。">
<meta property="og:image" content="http://wolfand11.coding.me/PureMVC-package-structure.png">
<meta property="og:image" content="http://wolfand11.coding.me/PureMVC-startup.png">
<meta property="og:image" content="http://wolfand11.coding.me/VO_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Note_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Setting_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Milieu_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Character_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Cast_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Draft_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Scene_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Chapter_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Part_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Story_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Season_xml_schema.jpg">
<meta property="og:image" content="http://wolfand11.coding.me/Series_xml_schema.jpg">
<meta property="og:updated_time" content="2017-04-02T12:45:46.180Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Action Script Developer Guide To PureMVC">
<meta name="twitter:description" content="《Action Script Developer Guide To PureMVC》的读书笔记.
很早之前的一篇读书笔记，大部分是将原书内容翻译了一下。">
<meta name="twitter:image" content="http://wolfand11.coding.me/PureMVC-package-structure.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="wolfand11&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Action Script Developer Guide To PureMVC | wolfand11&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/images/m_lambda-320.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">wolfand11</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" href="https://github.com/wolfand11" title="GitHub"></a>
                            
                                <a class="fa 豆瓣" href="https://www.douban.com/people/wolfand11" title="豆瓣"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/InitPC/">InitPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ai/">ai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/">architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/art/">art</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/artist/">artist</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/behaviortree/">behaviortree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmd/">cmd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cryptology/">cryptology</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csharp/">csharp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decode/">decode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dynamic-programming/">dynamic programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elisp/">elisp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emacs/">emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encode/">encode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/framework/">framework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fsm/">fsm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game/">game</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/game-engine/">game engine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gameplay/">gameplay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/graphics/">graphics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gui/">gui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hot-update/">hot-update</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/htn/">htn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/language/">language</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lcs/">lcs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lua/">lua</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/matlab/">matlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvc/">mvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngui/">ngui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/package/">package</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resource/">resource</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/script/">script</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slua/">slua</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/software-architecture/">software architecture</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spacemacs/">spacemacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ugui/">ugui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity/">unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity-doc/">unity-doc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/working-in-unity/">working-in-unity</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="http://xtutu.me/">xtutu</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">wolfand11</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/images/m_lambda-320.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">wolfand11</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/wolfand11" title="GitHub"></a>
                            
                                <a class="fa 豆瓣" target="_blank" href="https://www.douban.com/people/wolfand11" title="豆瓣"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-architecture/ActionScriptDeveloperGuideToPureMVC" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/" class="article-date">
      <time datetime="2017-02-12T16:00:00.000Z" itemprop="datePublished">2017-02-13</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Action Script Developer Guide To PureMVC
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/architecture/">architecture</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/book/">book</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mvc/">mvc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/software-architecture/">software architecture</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        

<p>
《Action Script Developer Guide To PureMVC》的读书笔记.<br>
很早之前的一篇读书笔记，大部分是将原书内容翻译了一下。<br>
</p>
<a id="more"></a>
<div id="outline-container-orgheadline112" class="outline-2">
<h2 id="orgheadline112"><span class="section-number-2">1</span> Action Script Developer Guide To PureMVC</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">1.1</span> 简介</h3>
</div>
<div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27"><span class="section-number-3">1.2</span> 使用 PureMVC 创建一个程序</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2"><span class="section-number-4">1.2.1</span> 选择平台</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
不同的平台意味着，创建 View 的方法以及将 View 和 PureMVC 连接的方法会稍有不同。同样数据在 View 组件中的传递，保存和获取也有不同。不同的面向对象平台，语法也会不同。但是，创建 PureMVC 应用程序使用的方式方法应该大致相同。<br>
</p>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-4">
<h4 id="orgheadline7"><span class="section-number-4">1.2.2</span> 写小说和编程</h4>
<div class="outline-text-4" id="text-1-2-2">
</div><ol class="org-ol"><li><a id="orgheadline3"></a>写小说和编程的共同点<br><div class="outline-text-5" id="text-1-2-2-1">
<p>
两者都需要规划和构造。为人物创建清晰的角色，责任，协作是这两者成功的关键。<br>
</p>
</div></li>

<li><a id="orgheadline6"></a>CRC 卡片法<br><div class="outline-text-5" id="text-1-2-2-2">
<p>
CRC 是 Classes, Responsibilities, Collaborations 的缩写。<br>
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline4"></a>开发程序<br><div class="outline-text-6" id="text-1-2-2-2-1">
<p>
分析和规划面向对象系统中人物的简单方法是创建 CRC 卡片。<br>
在卡片的最上面，写类或接口的名字<br>
在接下来的多行中，写人物的职责<br>
在最后面，写人物的协作者列表（例如：当前人物知道的所有人物，以及知道当前人物的所有人物）<br>
</p>
</div></li>
<li><a id="orgheadline5"></a>写小说<br><div class="outline-text-6" id="text-1-2-2-2-2">
<p>
所有的人物都有一张卡片，用来描述:他们故事的目标，达成目标的过程中会发生的事情，他们的个性是什么，他们的外形是怎样的。<br>
故事发生的地方被称作故事的环境。在为相关的场景打草稿前，描述了组成环境的每个设定的卡片可以用来创建假想的丰富的地方。<br>
人物的视角，他们的场景目标，他们的对手（一个角色，自然力量等等），落到他们身上的阻碍等所有事物都可以被快速地记录在一张卡片上。<br>
卡片方式的好处是写卡片和丢下卡片一样简单，它使得你的思维保持流畅，你不会觉得那样消耗很大。<br>
</p>
</div></li></ol></li></ol>
</div>
<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">1.2.3</span> StoryArchitect 一个写小说的工具</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
该节描述了开始写一个软件时，明确需求的过程。<br>
</p>
<ul class="org-ul">
<li>我们在编码层面做的选择会受我们所知道的和不知道的领域知识的影响。<br></li>
<li>开发者应该知道，在一个新的软件项目中，有两个最重要的输入：<br>
<ol class="org-ol">
<li>用户试图做什么？<br></li>
<li>用户现在是怎样做的？<br></li>
</ol></li>
<li>需求文档中的特性列表通常无法告诉你很多当前流程中的痛点。以用户的角度理解他们的领域数据和当前的流程，会让你的工作更有意义。<br></li>
</ul>
</div>
<ol class="org-ol"><li><a id="orgheadline8"></a>目的陈述(Statement of Purpose)<br><div class="outline-text-5" id="text-1-2-3-1">
<p>
为了保证所有项目成员，包括用户，对软件的目标有一致的认识。我们需要有意义的、总结性的一句话来描述软件的目标。<br>
例如：StoryArchitect 将允许小说作者做什么？ 这个问题的答案可以作为目标陈述。<br>
StoryArchitect 是一个小说作者的工具，用于整合小说的策划、研究、构想、起草。<br>
</p>
</div></li>
<li><a id="orgheadline9"></a>确定范围（Determining Scope）<br><div class="outline-text-5" id="text-1-2-3-2">
<p>
维护范围的一个重要的原则是，对当前版本的必要特性做计划表，按照计划表进行开发。收集高级特性到一个列表，如果在下一个版本中他们比较重要，则在下一版本中将其列入开发计划。<br>
</p>
</div></li>
<li><a id="orgheadline10"></a>描述领域（Describing the Domain）<br><div class="outline-text-5" id="text-1-2-3-3">
<p>
当开始规划一个项目时，你需要对领域进行更多的研究。<br>
下面列出 小说 的领域描述：<br>
</p>
<ul class="org-ul">
<li>故事是由场景组成的。<br>
Story is made of Scenes.<br>
场景可以看作故事的原子<br></li>
<li>场景可以包含多个草稿，其中的一个草稿被当做当前草稿。<br>
a Scene may have multiple Drafts.<br></li>
<li>场景可以被组织为章节<br>
As Stories grow larger, their Scenes are grouped into Chapters.<br></li>
<li>章节可以被组织为部分<br>
A more complex fiction Story will have its Chapters further grouped into Parts.<br></li>
<li>非小说类的书将章节组织为 Sections<br></li>
<li>电视连续剧包含很多集，它们通常被组织为季（Seasons）<br></li>
<li>无论是故事还是电视连续剧都有对应的人物演员表 （Cast），以及由各种设定组成的环境。<br></li>
</ul>
</div></li>
<li><a id="orgheadline11"></a>构想用户接口（Imagining the User Interface）<br><div class="outline-text-5" id="text-1-2-3-4">
<ul class="org-ul">
<li>应该包含一个简单的输入界面，不需要包含高级的文字装饰和格式，但是需要可以控制字体的大小和间距。<br></li>
<li>可以创建和扩展小说的任何层次的对象。<br></li>
<li>支持非线性的方式来打草稿<br></li>
<li>需要一个按某种方式排序的时间线，从而可以进入故事的任何一点，而且不需要时，可以隐藏该时间线。<br></li>
<li>当创建一个故事或打开一个故事时，应该定位到文字的结尾，方便立刻添加新的内容。<br></li>
<li>可以方便地查看和修改当前选中对象（Story,Part,Chapter 等等）的名字、说明、笔记<br></li>
<li>可以方便地删除对象，可以方便地更改对象的顺序。<br></li>
</ul>

<p>
因为该程序后续还会移植到移动设备上，所以不要使用移动设备上不好操作的 UI 控件。<br>
</p>
</div></li>
<li><a id="orgheadline12"></a>存储策略（Persistence Strategy）<br><div class="outline-text-5" id="text-1-2-3-5">
<p>
最简单的方法是将数据存储在本地，但是，考虑到将来需要在不同客户端编辑内容，还需要将本地内容同步到服务器端。<br>
</p>

<p>
采用的数据存储结构可以分为两种。一种是表结构，可以用 SQLite 来存储这种数据，用 SQL 来查询修改数据。另一种是树结构，可以用 XML 文件来存储这种结构。考虑到当前项目领域中的大部分对象（Series,Season,Story,Part,Chapter,Scene,Draft）都为树形结构，我们采用 XML 来作为数据存储结构。<br>
</p>
</div></li></ol>
</div>
<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">1.2.4</span> 搭建启动框架 （Erecting the Startup Scaffolding）</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
熟悉 PureMVC 结构和标准的启动流程后，搭建启动框架会变得很容易。<br>
<img src="PureMVC-package-structure.png"><br>
<img src="PureMVC-startup.png"><br>
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline15"></a>Create an Application Constants Class<br><div class="outline-text-5" id="text-1-2-4-1">
<p>
AppConstants 类用来存放消息名称常量。这些消息可以被 View 和 Controller 发送或接收。<br>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">Class</span>
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">AppConstants.as</span>

<span style="color: #ff0000;">// </span><span style="color: #ff0000;">Code</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.controller.<span style="color: #7fffd4;">constant</span>
{
    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * Notification Constants for the 'App' (View and Controller tiers)</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">AppConstants</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">STARTUP</span>:String = <span style="color: #ffa07a;">"Startup"</span>
    }
}
</pre>
</div>
</div>
<ol class="org-ol"><li><a id="orgheadline14"></a>TIPS<br><div class="outline-text-6" id="text-1-2-4-1-1">
<p>
View 和 Controller 层通常一起被称作应用程序，Model 层应该很容易地抽取出来作为一个独立的库，然后在另一个 App 中复用。<br>
Model 层不应该依赖应用程序，但是应用程序是依赖 Model 层的。应用程序的唯一目的就是将领域模型的细节展示给用户，并且允许用户和模型层交互。所以，View 和 Controller 层是知道 Model 层的角色的。为了保持模型层的独立，应该将模型层发送的消息定义在 Proxys 中，或者一个单独的 ModelConstants 类中。<br>
</p>
</div></li></ol></li>
<li><a id="orgheadline17"></a>Create a Startup Command<br><div class="outline-text-5" id="text-1-2-4-2">
<p>
当初始的界面层级被创建时，首要的业务逻辑是，创建你定义的各部分 PureMVC 元素，并且将他们和应用程序连接。<br>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">Class</span>
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">StartupCommand.as</span>
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">Code</span>
com.futurescale.sa.controller.command
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">INotification</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">command</span>.<span style="color: #98fb98;">SimpleCommand</span>;

    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * Startup the PureMVC apparatus, preparing the app for use.</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">StartupCommand</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">SimpleCommand</span>
    {
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">execute</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Get the application instance from the note</span>
        <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">app</span>:StoryArchitect = StoryArchitect( note.getBody() );

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">That is it for the scaffolding phase.</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">The following will be added incrementally later...</span>

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Register the Proxys</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Register the Mediators</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
        }
    }
 }
</pre>
</div>
</div>
<ol class="org-ol"><li><a id="orgheadline16"></a>TIPS<br><div class="outline-text-6" id="text-1-2-4-2-1">
<p>
需要先注册 Proxys，后注册 Mediators，因为，在 Mediators 中可能会引用 Proxys。<br>
</p>
</div></li></ol></li>
<li><a id="orgheadline18"></a>Create the Application Facade<br><div class="outline-text-5" id="text-1-2-4-3">
<div class="org-src-container">

<pre class="src src-java">Class
ApplicationFacade.as
<span style="color: #98fb98;">Code</span>
<span style="color: #00ffff;">package</span> com.futurescale.<span style="color: #7fffd4;">sa</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">controller</span>.<span style="color: #7fffd4;">command</span>.<span style="color: #98fb98;">StartupCommand</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">controller</span>.<span style="color: #7fffd4;">constant</span>.<span style="color: #98fb98;">AppConstants</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">facade</span>.<span style="color: #98fb98;">Facade</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">ApplicationFacade</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Facade</span>
    {
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * The Singleton instance factory method.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getInstance</span>( ) : ApplicationFacade
        {
            <span style="color: #00ffff;">if</span> ( instance == <span style="color: #7fffd4;">null</span> ) instance = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ApplicationFacade</span>( );
            <span style="color: #00ffff;">return</span> instance as ApplicationFacade;
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Initialize the Controller and Register the Commands.</span>
<span style="color: #ffa07a;">        */</span>
        override <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">initializeController</span>():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">super</span>.initializeController();
            registerCommand( <span style="color: #7fffd4;">AppConstants</span>.STARTUP, StartupCommand );
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Register the rest of the Commands incrementally later...</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">.</span>
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * A convenience method for starting up the PureMVC</span>
<span style="color: #ffa07a;">        * apparatus from the application.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">startup</span>( app:MyApp ):<span style="color: #98fb98;">void</span>
        {
            sendNotification( <span style="color: #7fffd4;">AppConstants</span>.STARTUP, app );
        }
    }
}
</pre>
</div>
</div></li>
<li><a id="orgheadline19"></a>Initialize the Application Facade and call startup()<br><div class="outline-text-5" id="text-1-2-4-4">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">Class</span>
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">StoryArchitect.mxml</span>
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">Code</span>
&lt;?xml version=<span style="color: #ffa07a;">"1.0"</span> encoding=<span style="color: #ffa07a;">"utf-8"</span>?&gt;
&lt;s:WindowedApplication
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#22312;&#24212;&#29992;&#31243;&#24207;&#21551;&#21160;&#23436;&#25104;&#21518;&#65292;&#35843;&#29992; facade.startup(app)</span>
    applicationComplete=<span style="color: #ffa07a;">"facade.startup(this)"</span>
    xmlns:fx=<span style="color: #ffa07a;">"http://ns.adobe.com/mxml/2009"</span>
    xmlns:s=<span style="color: #ffa07a;">"library://ns.adobe.com/flex/spark"</span>
    xmlns:mx=<span style="color: #ffa07a;">"library://ns.adobe.com/flex/mx"</span>&gt;

    &lt;fx:Script&gt;
    &lt;![CDATA[
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #98fb98;">ApplicationFacade</span>;

    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#22312;&#21019;&#24314; MXML &#24212;&#29992;&#31243;&#24207;&#36807;&#31243;&#20013;&#65292;&#21021;&#22987;&#21270; ApplicationFacade</span>
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Initialize the ApplicationFacade during MXML application construction</span>
    <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">facade</span>:ApplicationFacade = ApplicationFacade.getInstance();
    ]]&gt;
    &lt;/fx:Script&gt;

&lt;/s:WindowedApplication&gt;
</pre>
</div>
</div></li></ol>
</div>
<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26"><span class="section-number-4">1.2.5</span> 按照从外到内的顺序进行创建</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
<a id="orgtarget1"></a><br>
</p>
<ul class="org-ul">
<li>先创建 Value Objects 和 View Components，他们属于应用程序的最外层。<br>
好处之一是，不了解应用程序所用框架的人也可以做创建 Value Objects 和 View Components 的工作。<br>
也保证了 Value Objects、View Components 独立于框架，使得他们具有复用性。<br></li>
<li><p>
接下来创建 PureMVC 的各部分元素<br>
</p>
<ul class="org-ul">
<li>首先，创建 Proxys，用它作为应用程序的数据源<br></li>
<li>其次，创建 Mediators，它可以为 View Components 提供数据<br></li>
<li>最后，创建 Commands<br></li>
<li>TIPS:<br></li>
</ul>
<p>
<a href="#orgtarget2">1.8.1</a><br>
</p></li>
</ul>
</div>
<ol class="org-ol"><li><a id="orgheadline21"></a>Step 1: Value Objects<br><div class="outline-text-5" id="text-1-2-5-1">
<p>
创建好启动框架后，首先要做的事情是创建 ValueObjects。思考领域模型并为你想到的每个实体创建 ValueObjects。定义一些枚举或常量来表示合法的属性值。<br>
</p>
<ul class="org-ul">
<li>TIPS:<br></li>
</ul>
<p>
通常在 ValueObjects 类名称后面添加"VO"后缀，来明确类的角色，也可以避免和 View Components 类重名。<br>
</p>
</div></li>
<li><a id="orgheadline22"></a>Step 2: View Components<br><div class="outline-text-5" id="text-1-2-5-2">
<p>
依据领域模型设计和构建适合使用需求的 View Components。这个过程中，就会了解 View Components 需要什么，这些需求从父级 View Components 获得，还是从 Mediator 获得。将公共的属性暴露给父级 View Components 或 Mediator，将 View Components 自己的职责封装起来。<br>
在这个阶段，你可以用前面定义的 ValueObjects 的虚拟数据来填充 View Components，进行测试，这样会提前发现某些 Value Objects 可能需要调整。<br>
</p>
<ul class="org-ul">
<li><p>
TIPS:<br>
</p>
<ul class="org-ul">
<li>View Components 不能依赖任何框架的角色。<br></li>
<li>注意将大的 View Components 划分为小的 View Components，让 View Components 保持简单，从而使其实现更容易理解和修改。<br></li>
<li>View Components 的命名应该按照他们的功能来命名，而不是他们的实现。因为，View Components 的实现可能会被修改。<br></li>
</ul>
<p>
例如： 卡牌集合 一开始使用 ListView 来实现，后来改为用 TableView 来实现，所以 CardSet 比 CardsList 或 CardsTable 更好。<br>
</p></li>
</ul>
</div></li>
<li><a id="orgheadline23"></a>Step 3: Proxys<br><div class="outline-text-5" id="text-1-2-5-3">
<p>
Proxys 决定了 Value Objects 的存储和访问。<br>
Proxys 有很多用处，可以使用它来访问 FlashVars 和 URL 的参数，本地共享对象，加密后的本地存储，文件系统，web 服务器，实时消息协议通道，甚至是当前应用程序状态的临时数据（尽管这些数据不会被当作领域模型的一部分）<br>
Proxy 类通常暴露一个 ValueObject 或一个集合该集合中存储一系列同一类型的 ValueObject。<br>
一个 Proxy 可以和另一个 Proxy 协作来维护相关数据的完整性，尽管这些数据被分开管理。这降低了每个 Proxy 的复杂度。<br>
</p>
<ul class="org-ul">
<li>TIPS:<br>
通常 Proxy 的命名使用“Proxy”做后缀，Proxy 的名字和它所提供的数据相同。<br>
例如：HeroProxy 提供了 HeroVO 数据。<br></li>
</ul>
</div></li>
<li><a id="orgheadline24"></a>Step 4: Mediators<br><div class="outline-text-5" id="text-1-2-5-4">
<p>
并不是所有的 View Component 都需要 Mediator。在视图树中的某些地方，数据或新的 View Component 需要注入和取出，这就是需要调解的地方。<br>
可以为根 View Component 创建 Mediator，而子 View Component 由根 View Component 来处理。<br>
Mediator 的通讯是双向的，它不仅关心它所管理的 View Component 发出的消息，而且也关心系统其他部分发送的和它的 View Component 相关的消息。<br>
</p>
<ul class="org-ul">
<li>TIPS:<br></li>
</ul>
<p>
通常 Mediator 的命名使用"Mediator"后缀。<br>
例如：CardSetMediator<br>
</p>
</div></li>
<li><a id="orgheadline25"></a>Step 5: Commands<br><div class="outline-text-5" id="text-1-2-5-5">
<p>
除了 StartupCommand 以外，当你创建某些 Commands 时，PureMVC 的其他大部分角色已经完善了。<br>
</p>
<ul class="org-ul">
<li>TIPS:<br></li>
</ul>
<p>
通常 Command 的命名使用“Command”后缀，名称按照它实现的操作来命名。例如：DeleteCardCommand<br>
</p>
</div></li></ol>
</div>
</div>
<div id="outline-container-orgheadline48" class="outline-3">
<h3 id="orgheadline48"><span class="section-number-3">1.3</span> 为领域建模</h3>
<div class="outline-text-3" id="text-1-3">
</div><div id="outline-container-orgheadline43" class="outline-4">
<h4 id="orgheadline43"><span class="section-number-4">1.3.1</span> Designing the Schema</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
通盘考虑 StoryArchitect 应用程序领域模型的各个对象后，我们计划使用 XML 文件来保持数据。一开始会将文件保存在本地，再以后版本中，会将文件同步到服务器。随后，我们需要将 XML 的操作封装到 Value Objects 内部。所以，我们的逻辑起点是设计 XML 的模式（schema）.<br>
如果我们将数据保存到数据库，我们首先应该设计数据库的模式，设计表格和索引。<br>
</p>
<ul class="org-ul">
<li>TIPS:<br></li>
</ul>
<p>
使用 Value Objects 来封装 XML 对象的模式有以下几个优点：<br>
</p>
<ol class="org-ol">
<li>降低 Proxy 的压力，避免 Proxy 需要知道 VOs 的所有一切。（XML 相关的操作就不需要在 Proxy 中实现了）<br></li>
<li>不需要创建操作 XML 的 utility/helper classes(这些类角色松散，增加了依赖和复杂度)<br></li>
<li>可以让你快速处理已经存在或者是新设计的服务器 API 返回的结果。<br></li>
</ol>
</div>
<ol class="org-ol"><li><a id="orgheadline28"></a>复审领域模型实体对象 Reviewing the Domain Model Entities<br><div class="outline-text-5" id="text-1-3-1-1">
<p>
下面是 StoryArchitect 领域模型中的实体对象：<br>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Entities</th>
<th scope="col" class="org-left">名称</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Note</td>
<td class="org-left">备注/笔记</td>
<td class="org-left">一个 URL 或/和 关于任何实体的任意形式的文本</td>
</tr>

<tr>
<td class="org-left">Setting</td>
<td class="org-left">设定</td>
<td class="org-left">故事发生的地方</td>
</tr>

<tr>
<td class="org-left">Milieu</td>
<td class="org-left">环境</td>
<td class="org-left">和一个故事或连续剧相关的一系列设定（Setting）</td>
</tr>

<tr>
<td class="org-left">Character</td>
<td class="org-left">角色</td>
<td class="org-left">故事或连续剧中的一个个体</td>
</tr>

<tr>
<td class="org-left">Cast</td>
<td class="org-left">演员表</td>
<td class="org-left">和一个故事或连续剧相关的一系列角色（Character）</td>
</tr>

<tr>
<td class="org-left">Draft</td>
<td class="org-left">草稿</td>
<td class="org-left">场景原始文字的一个版本</td>
</tr>

<tr>
<td class="org-left">Scene</td>
<td class="org-left">场景</td>
<td class="org-left">故事的原子元素，可以包含多个草稿</td>
</tr>

<tr>
<td class="org-left">Chapter</td>
<td class="org-left">章节</td>
<td class="org-left">故事或部分中的一组场景，即一组场景可以被划分为一章</td>
</tr>

<tr>
<td class="org-left">Part</td>
<td class="org-left">部分</td>
<td class="org-left">故事中的一组章节，即一组章节可以被划分为一部分</td>
</tr>

<tr>
<td class="org-left">Story</td>
<td class="org-left">故事</td>
<td class="org-left">多个场景的集合，即一组场景可以组成一个故事,也可以被组织到章节或部分中</td>
</tr>

<tr>
<td class="org-left">Season</td>
<td class="org-left">季</td>
<td class="org-left">连续剧中的多个故事一起被划分为一季，即多集电视连续剧可以组成一季</td>
</tr>

<tr>
<td class="org-left">Series</td>
<td class="org-left">连续剧</td>
<td class="org-left">一组故事，它们使用相同的演员表和环境，被称为连续剧</td>
</tr>
</tbody>
</table>
</div></li>
<li><a id="orgheadline42"></a>Creating the Schema<br><ol class="org-ol"><li><a id="orgheadline29"></a>ValueObject<br><div class="outline-text-6" id="text-1-3-1-2-1">
<p>
ValueObject 是永远不会被创建的元素，但是其他元素会继承它的属性和子元素。<br>
<img src="VO_xml_schema.jpg"><br>
</p>
</div></li>
<li><a id="orgheadline30"></a>Note<br><div class="outline-text-6" id="text-1-3-1-2-2">
<p>
Note 不从 VO 扩展，因为它被包含在 VO 内，而且不需要任何 VO 的属性。<br>
<img src="Note_xml_schema.jpg"><br>
</p>
</div></li>
<li><a id="orgheadline31"></a>Setting<br><div class="outline-text-6" id="text-1-3-1-2-3">
<p>
Setting 从 VO 继承了所有它需要的属性.<br>
<img src="Setting_xml_schema.jpg"><br>
</p>
</div></li>
<li><a id="orgheadline32"></a>Milieu<br><div class="outline-text-6" id="text-1-3-1-2-4">

<div class="figure">
<p><img src="Milieu_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline33"></a>Character<br><div class="outline-text-6" id="text-1-3-1-2-5">

<div class="figure">
<p><img src="Character_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline34"></a>Cast<br><div class="outline-text-6" id="text-1-3-1-2-6">

<div class="figure">
<p><img src="Cast_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline35"></a>Draft<br><div class="outline-text-6" id="text-1-3-1-2-7">

<div class="figure">
<p><img src="Draft_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline36"></a>Scene<br><div class="outline-text-6" id="text-1-3-1-2-8">

<div class="figure">
<p><img src="Scene_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline37"></a>Chapter<br><div class="outline-text-6" id="text-1-3-1-2-9">

<div class="figure">
<p><img src="Chapter_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline38"></a>Part<br><div class="outline-text-6" id="text-1-3-1-2-10">

<div class="figure">
<p><img src="Part_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline39"></a>Story<br><div class="outline-text-6" id="text-1-3-1-2-11">
<div class="org-src-container">

<pre class="src src-nxml">&lt;<span style="color: #87cefa;">Story</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Story-12345678-1</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">isStub</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">false</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">type</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">0</span><span style="color: #ffa07a;">"</span>&gt;
 &lt;<span style="color: #87cefa;">name</span>&gt;Untitled Scifi Story&lt;/<span style="color: #87cefa;">name</span>&gt;
 &lt;<span style="color: #87cefa;">description</span>&gt;The Vroomfastians have been traveling the Dark Matter Highway for quite
awhile. They've just pulled off at our exit, and Man are they hungry!&lt;/<span style="color: #87cefa;">description</span>&gt;
 &lt;<span style="color: #87cefa;">Note</span> <span style="color: #eedd82;">url</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">http://bit.ly/Ogz7Q</span><span style="color: #ffa07a;">"</span>&gt;Interesting article about filaments of Dark Matter
pulling in gas and funneling it across the galaxy.&lt;/<span style="color: #87cefa;">Note</span>&gt;
 &lt;<span style="color: #87cefa;">Note</span>&gt;How about "Once, Upon the Dark Matter Highway" for a title?&lt;/<span style="color: #87cefa;">Note</span>&gt;
 &lt;<span style="color: #87cefa;">Cast</span>/&gt;
 &lt;<span style="color: #87cefa;">Milieu</span>/&gt;
 &lt;<span style="color: #87cefa;">Scene</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Scene-89543346-3</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1</span><span style="color: #ffa07a;">"</span>&gt;
    &lt;<span style="color: #87cefa;">Draft</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Draft-5465344-43</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">isCurrent</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">false</span><span style="color: #ffa07a;">"</span>&gt;It was a dark and
    stormy night.&lt;/<span style="color: #87cefa;">Draft</span>&gt;
    &lt;<span style="color: #87cefa;">Draft</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Draft-5443523-22</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">2</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">isCurrent</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">false</span><span style="color: #ffa07a;">"</span>&gt;Dawn hit him in the
    face like a sack of frozen turnips.&lt;/<span style="color: #87cefa;">Draft</span>&gt;
    &lt;<span style="color: #87cefa;">Draft</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Draft-9678546-34</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">3</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">isCurrent</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">true</span><span style="color: #ffa07a;">"</span>&gt;A harsh klaxon echoed
    through the ship as the autopilot disengaged from hyperspace.&lt;/<span style="color: #87cefa;">Draft</span>&gt;
 &lt;/<span style="color: #87cefa;">Scene</span>&gt;
 &lt;<span style="color: #87cefa;">Scene</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Scene-56562546-2</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">2</span><span style="color: #ffa07a;">"</span> /&gt;
 &lt;<span style="color: #87cefa;">Scene</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Scene-78678346-12</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">3</span><span style="color: #ffa07a;">"</span> /&gt;
&lt;/<span style="color: #87cefa;">Story</span>&gt;
</pre>
</div>

<div class="figure">
<p><img src="Story_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline40"></a>Season<br><div class="outline-text-6" id="text-1-3-1-2-12">
<div class="org-src-container">

<pre class="src src-nxml">&lt;<span style="color: #87cefa;">Season</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Season-43534573-1</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1</span><span style="color: #ffa07a;">"</span>&gt;
  &lt;<span style="color: #87cefa;">Story</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Story-56562546-41</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1</span><span style="color: #ffa07a;">"</span> /&gt;
  &lt;<span style="color: #87cefa;">Story</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Story-78678346-24</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">2</span><span style="color: #ffa07a;">"</span> /&gt;
&lt;/<span style="color: #87cefa;">Story</span>
</pre>
</div>

<div class="figure">
<p><img src="Season_xml_schema.jpg"><br>
</p>
</div>
</div></li>
<li><a id="orgheadline41"></a>Series<br><div class="outline-text-6" id="text-1-3-1-2-13">
<div class="org-src-container">

<pre class="src src-nxml">&lt;<span style="color: #87cefa;">Series</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Story-12345678-1</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">isStub</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">false</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">useSeasons</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">false</span><span style="color: #ffa07a;">"</span>&gt;
    &lt;<span style="color: #87cefa;">name</span>&gt;Untitled Scifi Series&lt;/<span style="color: #87cefa;">name</span>&gt;
    &lt;<span style="color: #87cefa;">description</span>&gt;A young boy becomes a central figure in a saga of galactic intrigue when
    he and his father are abducted by aliens and given a powerful secret to keep.
    &lt;/<span style="color: #87cefa;">description</span>&gt;
    &lt;<span style="color: #87cefa;">Note</span> <span style="color: #eedd82;">url</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">http://bit.ly/Ogz7Q</span><span style="color: #ffa07a;">"</span>&gt;Interesting article about filaments of Dark Matter
    pulling in gas and funneling it across the galaxy.&lt;/<span style="color: #87cefa;">Note</span>&gt;
    &lt;<span style="color: #87cefa;">Cast</span>/&gt;
    &lt;<span style="color: #87cefa;">Milieu</span>/&gt;
    &lt;<span style="color: #87cefa;">Story</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Story-56562546-2</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1</span><span style="color: #ffa07a;">"</span>&gt;
        &lt;<span style="color: #87cefa;">name</span>&gt;Once, Upon the Dark Matter Highway&lt;/<span style="color: #87cefa;">name</span>&gt;
        &lt;<span style="color: #87cefa;">description</span>&gt;The Vroomfastians have been traveling the Dark Matter Highway for
        quite awhile. They've just pulled off at our exit, and Man are they hungry!
        &lt;/<span style="color: #87cefa;">description</span>&gt;
    &lt;/<span style="color: #87cefa;">Story</span>&gt;
    &lt;<span style="color: #87cefa;">Story</span> <span style="color: #eedd82;">uid</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">Scene-78678346-12</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">ordinal</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">2</span><span style="color: #ffa07a;">"</span> /&gt;
&lt;/<span style="color: #87cefa;">Series</span>&gt;
</pre>
</div>

<div class="figure">
<p><img src="Series_xml_schema.jpg"><br>
</p>
</div>
</div></li></ol></li></ol>
</div>

<div id="outline-container-orgheadline44" class="outline-4">
<h4 id="orgheadline44"><span class="section-number-4">1.3.2</span> Creating the Value Objects</h4>
<div class="outline-text-4" id="text-1-3-2">
<ul class="org-ul">
<li>TIPS<br></li>
</ul>
<p>
创建的 ValueObjects 不能引用任何 PureMVC 的类，在你的 PureMVC 应用程序外，应该能够独立的测试和复用这些 ValueObjects。<br>
</p>
</div>
</div>
<div id="outline-container-orgheadline46" class="outline-4">
<h4 id="orgheadline46"><span class="section-number-4">1.3.3</span> Creating the Enums</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
Enums 也是一类领域模型实体对象。例如：游戏中卡牌、装备、怪物的品质 1-橙卡，2-紫卡，3-蓝卡，4-绿卡，5-白卡。<br>
将 Enum 值转化为名称的操作、判断相等的操作，封装在 Enum 内部，提高 Enum 的内聚，减少 Enum 的依赖。<br>
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline45"></a><span class="todo TODO">TODO</span> 是否存在某些情况，Enum 需要多个名字？如果存在，Enum 应该如何设计来满足这种需求?<br><div class="outline-text-5" id="text-1-3-3-1">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #98fb98;">Enum</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.model.<span style="color: #00ffff;">enum</span>
{
    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * A base class for enumerations</span>
<span style="color: #ffa07a;">    */</span>
    [Bindable] <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> Enum
    {
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">name</span>:String;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">ordinal</span>:Number;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">description</span>:String;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">Enum</span>( ordinal:Number, name:String, description:String )
        {
            <span style="color: #00ffff;">this</span>.name = name;
            <span style="color: #00ffff;">this</span>.ordinal = ordinal;
            <span style="color: #00ffff;">this</span>.description = description;
        }
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Compare to another enum instance</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">equals</span>( <span style="color: #00ffff;">enum</span>:Enum ):Boolean
        {
            <span style="color: #00ffff;">return</span> ( ( <span style="color: #00ffff;">this</span>.name == <span style="color: #00ffff;">enum</span>.name ) &amp;&amp;
            ( <span style="color: #00ffff;">this</span>.ordinal == <span style="color: #00ffff;">enum</span>.ordinal ) &amp;&amp;
            ( <span style="color: #00ffff;">this</span>.description == <span style="color: #00ffff;">enum</span>.description )
            );
        }
    }
}
<span style="color: #98fb98;">StoryTypeEnum</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.model.<span style="color: #00ffff;">enum</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">mx</span>.<span style="color: #7fffd4;">collections</span>.<span style="color: #98fb98;">ArrayCollection</span>;

    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * An enumeration of Story types.</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">StoryTypeEnum</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Enum</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NONE</span>:StoryTypeEnum =
        <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">StoryTypeEnum</span>( -1, <span style="color: #ffa07a;">"--None Selected--"</span>, <span style="color: #ffa07a;">"Choose a Story Type"</span> );
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">SIMPLE</span>:StoryTypeEnum =
        <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">StoryTypeEnum</span>( 0, <span style="color: #ffa07a;">"Simple"</span>, <span style="color: #ffa07a;">"Scenes only"</span> );
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NORMAL</span>:StoryTypeEnum =
        <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">StoryTypeEnum</span>( 1, <span style="color: #ffa07a;">"Normal"</span>, <span style="color: #ffa07a;">"Chapters and Scenes"</span> );
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">COMPLEX</span>:StoryTypeEnum =
        <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">StoryTypeEnum</span>( 2, <span style="color: #ffa07a;">"Complex"</span>, <span style="color: #ffa07a;">"Chapters, Parts, and Scenes"</span> );

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">StoryTypeEnum</span>( ordinal:Number, name:String, description:String )
        {
            <span style="color: #00ffff;">super</span>( ordinal, name, description );
        }

        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">function</span> <span style="color: #98fb98;">get</span> <span style="color: #87cefa;">list</span>():Array
        {
            <span style="color: #00ffff;">return</span> [ SIMPLE, NORMAL, COMPLEX ];
        }

        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">function</span> <span style="color: #98fb98;">get</span> <span style="color: #87cefa;">comboList</span>():ArrayCollection
        {
            <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ArrayCollection</span>( [ NONE ].concat( list ) );
        }

        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">equals</span>( <span style="color: #00ffff;">enum</span>:Enum ):Boolean
        {
            <span style="color: #00ffff;">return</span> ( <span style="color: #00ffff;">enum</span> <span style="color: #98fb98;">is</span> <span style="color: #98fb98;">StoryTypeEnum</span> &amp;&amp; <span style="color: #00ffff;">super</span>.equals( <span style="color: #00ffff;">enum</span> ) );
        }
    }
}
</pre>
</div>
</div></li></ol>
</div>
<div id="outline-container-orgheadline47" class="outline-4">
<h4 id="orgheadline47"><span class="section-number-4">1.3.4</span> Testing the Entities</h4>
<div class="outline-text-4" id="text-1-3-4">
<p>
ValueObjects 是整个应用程序的基石。其他代码的作用只是暴露 Value Objects 类的实例给用户，让他们进行操作和持有。因为 Value Objects 封装了序列化和反序列化逻辑，所以在继续完善程序之前，需要对 Value Objects 进行测试。<br>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">NoteVOTest</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.model.vo.<span style="color: #7fffd4;">test</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">vo</span>.<span style="color: #98fb98;">NoteVO</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flexunit</span>.<span style="color: #7fffd4;">framework</span>.<span style="color: #98fb98;">Assert</span>;
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">NoteVOTest</span>
    {
        [Test] <span style="color: #00ffff;">public</span> function testNoteVOWithXML():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">url</span>:String = <span style="color: #ffa07a;">"http://google.com"</span>;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">text</span>:String = <span style="color: #ffa07a;">"Some stuff I'm keeping in the cloud."</span>;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">xml</span>:XML = &lt;Note url={url}&gt;{text}&lt;/Note&gt;;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">vo</span>:NoteVO = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">NoteVO</span>( xml );
            <span style="color: #00ffff;">if</span> (! vo is NoteVO ) Assert.fail(<span style="color: #ffa07a;">"Construction with xml failed"</span>);
            <span style="color: #00ffff;">if</span> ( vo.text != text ) Assert.fail(<span style="color: #ffa07a;">"text match failed"</span>);
            <span style="color: #00ffff;">if</span> ( vo.url != url ) Assert.fail(<span style="color: #ffa07a;">"url match failed"</span>);
        }
        [Test] <span style="color: #00ffff;">public</span> function testNoteVOWithoutXML():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">vo</span>:NoteVO = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">NoteVO</span>();
            <span style="color: #00ffff;">if</span> (! vo is NoteVO ) Assert.fail(<span style="color: #ffa07a;">"Construction without xml failed"</span>);
            <span style="color: #00ffff;">if</span> ( vo.xml.localName() != <span style="color: #7fffd4;">NoteVO</span>.ELEMENT )
            Assert.fail(<span style="color: #ffa07a;">"default xml not provided"</span>);
        }
        [Test] <span style="color: #00ffff;">public</span> function testSet_text():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">text</span>:String = <span style="color: #ffa07a;">"Bunnies are nice!"</span>;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">vo</span>:NoteVO = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">NoteVO</span>();
            vo.text = text;
            <span style="color: #00ffff;">if</span> ( vo.text != text ) Assert.fail(<span style="color: #ffa07a;">"text match failed"</span>);
        }
        [Test] <span style="color: #00ffff;">public</span> function testSet_url():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">url</span>:String = <span style="color: #ffa07a;">"http://puremvc.org"</span>;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">vo</span>:NoteVO = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">NoteVO</span>();
            vo.url = url;
            <span style="color: #00ffff;">if</span> ( vo.url != url ) Assert.fail(<span style="color: #ffa07a;">"url match failed"</span>);
        }
        [Test] <span style="color: #00ffff;">public</span> function testSet_xml():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">url</span>:String = <span style="color: #ffa07a;">"http://puremvc.org"</span>;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">text</span>:String = <span style="color: #ffa07a;">"Code at the Speed of Thought!"</span>;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">xml</span>:XML = &lt;Note url={url}&gt;{text}&lt;/Note&gt;;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">vo</span>:NoteVO = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">NoteVO</span>();
            vo.xml = xml;
            <span style="color: #00ffff;">if</span> ( vo.text != text ) Assert.fail(<span style="color: #ffa07a;">"text match failed"</span>);
            <span style="color: #00ffff;">if</span> ( vo.url != url ) Assert.fail(<span style="color: #ffa07a;">"url match failed"</span>);
        }
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline65" class="outline-3">
<h3 id="orgheadline65"><span class="section-number-3">1.4</span> 实现用户界面</h3>
<div class="outline-text-3" id="text-1-4">
<p>
组成用户界面的类应该封装他们自己的行为和表现。当它们需要和外部通讯时，应该只是发布事件、或者设置属性、或者调用它们子控件的方法。<br>
实现 View Components 的时候，你应该暴露事件、属性和交互方法这些 API，隐藏 View Components 的内部实现。<br>
View Components 暴露属性来接收数据；发送事件来传递用户的意图；查看共享选中内容并保持其一致性。它只和自己的子节点，以及赋给它的数据进行交互(这些数据是通过父节点、或者 Mediator 赋给它的)。<br>
</p>
</div>
<div id="outline-container-orgheadline53" class="outline-4">
<h4 id="orgheadline53"><span class="section-number-4">1.4.1</span> Application</h4>
<div class="outline-text-4" id="text-1-4-1">
</div><ol class="org-ol"><li><a id="orgheadline49"></a>Class<br><div class="outline-text-5" id="text-1-4-1-1">
<p>
StoryArchitect.mxml<br>
</p>
</div></li>
<li><a id="orgheadline50"></a>Responsibilities<br><div class="outline-text-5" id="text-1-4-1-2">
<ul class="org-ul">
<li>声明和布局 Chooser 和 Editor View Components<br></li>
<li>初始化 PureMVC Facade<br></li>
<li>触发 PureMVC 的启动流程，传递 app 的引用<br></li>
<li>为 Starting，Chooser 和 Editor 定义三种启动模式<br></li>
<li>暴露一个 bindable 公共属性，来设置字数<br></li>
<li>暴露一个 bindable 公共属性，来设置显示模式<br></li>
<li>暴露一个 bindable 公共属性，来设置 SelectionContxt<br></li>
<li>提供 SelectionContxt 给子节点<br></li>
<li>基于显示模式来控制可见性和布局<br></li>
<li>在状态栏展示显示模式（Editor 模式下，还要显示字数）<br></li>
<li>监听 Editor 组件的 ReportWordCount AppEvents，当该事件发生时，更新 wordCount 属性<br></li>
</ul>
</div></li>
<li><a id="orgheadline51"></a>Collaborations<br></li>
<li><a id="orgheadline52"></a>Code<br><div class="outline-text-5" id="text-1-4-1-4">
<div class="org-src-container">

<pre class="src src-nxml">&lt;?<span style="color: #00ffff;">xml</span> <span style="color: #eedd82;">version</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">1.0</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">encoding</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">utf-8</span><span style="color: #ffa07a;">"</span>?&gt;
<span style="color: #ff0000;">&lt;!--</span><span style="color: #ff0000;"> STORY ARCHITECT APPLICATION </span><span style="color: #ff0000;">--&gt;</span>
&lt;<span style="color: #b0c4de;">s</span>:<span style="color: #87cefa;">WindowedApplication</span> <span style="color: #b0c4de;">xmlns</span>:<span style="color: #eedd82;">editor</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">com.futurescale.sa.view.component.editor.*</span><span style="color: #ffa07a;">"</span>
                        <span style="color: #b0c4de;">xmlns</span>:<span style="color: #eedd82;">chooser</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">com.futurescale.sa.view.component.chooser.*</span><span style="color: #ffa07a;">"</span>
                        <span style="color: #b0c4de;">xmlns</span>:<span style="color: #eedd82;">s</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">library://ns.adobe.com/flex/spark</span><span style="color: #ffa07a;">"</span>
                        <span style="color: #b0c4de;">xmlns</span>:<span style="color: #eedd82;">fx</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">http://ns.adobe.com/mxml/2009</span><span style="color: #ffa07a;">"</span>
                        <span style="color: #eedd82;">applicationComplete</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">facade.startup(this); // startup app</span><span style="color: #ffa07a;">"</span>
                        <span style="color: #eedd82;">minWidth</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">800</span><span style="color: #ffa07a;">"</span> <span style="color: #eedd82;">minHeight</span>=<span style="color: #ffa07a;">"</span><span style="color: #ffa07a;">600</span><span style="color: #ffa07a;">"</span>&gt;
      &lt;<span style="color: #b0c4de;">fx</span>:<span style="color: #87cefa;">Script</span>&gt;
          &lt;![<span style="color: #b0c4de;">CDATA</span>[
              import com.futurescale.sa.ApplicationFacade;
              import com.futurescale.sa.view.context.SelectionContext;

              public static const MODE_STARTING:String = "Starting...";
              public static const MODE_CHOOSER:String = "Chooser";
              public static const MODE_EDITOR:String = "Editor";

              // Selection context shared between View Components.
              [Bindable] public var context:SelectionContext;

              // Word Count (displayed on status bar in Editor mode)
              [Bindable] public var wordCount:String = "";

              // Display Mode (Chooser/Editor)
              [Bindable] private var mode:String = MODE_STARTING;

              // Initialize the PureMVC Facade
              private var facade:ApplicationFacade = ApplicationFacade.getInstance();

              /**
              * Set the application display mode, and if showing
              * the Editor, initialize the word count from the
              * selected Story.
              */
              public function setMode( mode:String ):void
              {
                  this.mode=mode;
                  if (mode == MODE_EDITOR &amp;&amp; context.story) {
                      wordCount = context.story.wordCount.toString();
                  } else {
                      wordCount = "";
                  }
              }
      &lt;/fx:Script&gt;

  &lt;!-- LAYOUT --&gt;
  &lt;s:layout&gt;
      &lt;s:VerticalLayout horizontalAlign="center"/&gt;
  &lt;/s:layout&gt;

  &lt;!-- STATUS BAR --&gt;
  &lt;s:status&gt;{mode}{(wordCount != "")?" | "+wordCount+" words":""}&lt;/s:status&gt;

  &lt;!-- CHOOSER --&gt;
  &lt;chooser:Chooser id="chooser" width="100%" height="100%"
                    includeInLayout="{mode == MODE_CHOOSER}"
                    visible="{mode == MODE_CHOOSER}"/&gt;
  &lt;!-- EDITOR --&gt;
  &lt;editor:Editor id="editor" width="100%" height="100%"
                  includeInLayout="{mode == MODE_EDITOR}"
                  visible="{mode == MODE_EDITOR}"
                  &lt;!-- &#22312;&#36825;&#37324;&#30417;&#21548; reportWordCount &#20107;&#20214; --&gt;
                  reportWordCount="wordCount=String(event.data)"
                  context="{context}"/&gt;
&lt;/s:WindowedApplication&gt;
</pre>
</div>
</div></li></ol>
</div>
<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="section-number-4">1.4.2</span> Other View Components</h4>
<div class="outline-text-4" id="text-1-4-2">
<p>
The Chooser<br>
The Story Chooser<br>
The Editor<br>
The Editor Controls<br>
The Details Component<br>
The Item Info Component<br>
The Notes Component<br>
The Timeline Component<br>
The Story Tile<br>
The Part Tile<br>
The Chapter Tile<br>
The Scene Tile<br>
The Draft Tile<br>
</p>
</div>
</div>
<div id="outline-container-orgheadline59" class="outline-4">
<h4 id="orgheadline59"><span class="section-number-4">1.4.3</span> The Selection Context</h4>
<div class="outline-text-4" id="text-1-4-3">
<p>
<a id="orgtarget3"></a><br>
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline55"></a>Class<br><div class="outline-text-5" id="text-1-4-3-1">
<p>
SelectionContext.as<br>
</p>
</div></li>
<li><a id="orgheadline56"></a>Responsibilities<br><div class="outline-text-5" id="text-1-4-3-2">
<ul class="org-ul">
<li>暴露公共的方法来选择各种各样的 ValueObject 子类对象.<br>
选中操作伴随着，选中其他相关 ValueObject 对象 和 取消选中其他相关 ValueObject 对象。<br></li>
<li>通过 selectedItem 来记录选中操作选择的对象。selectedItem 是 bindable 的<br></li>
<li>暴露 bindable 的属性来读取当前选中的 CastVO,ChapterVO,CharacterVO,DraftVO,MilieuVO,NoteVO,PartVO,SceneVO,SeasonVO,SeriesVO,SettingVO,StoryVO 等等。<br></li>
</ul>
</div></li>
<li><a id="orgheadline57"></a>Collaborations<br></li>
<li><a id="orgheadline58"></a>Code<br><div class="outline-text-5" id="text-1-4-3-4">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #00ffff;">package</span> com.futurescale.sa.view.<span style="color: #7fffd4;">context</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">vo</span>.<span style="color: #98fb98;">CastVO</span>;
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#30465;&#30053;&#19968;&#37096;&#20998; import ......</span>
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">vo</span>.<span style="color: #98fb98;">ValueObject</span>;
    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * The currently selected items in the UI.</span>
<span style="color: #ffa07a;">    *</span>
<span style="color: #ffa07a;">    * When calling the select methods, items</span>
<span style="color: #ffa07a;">    * below the selection in the Series/Story</span>
<span style="color: #ffa07a;">    * hierarchy as well as the selected Note,</span>
<span style="color: #ffa07a;">    * Cast and Milieu are automatically nulled</span>
<span style="color: #ffa07a;">    * as appropriate.</span>
<span style="color: #ffa07a;">    */</span>
    [Bindable] <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> SelectionContext
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">"SelectionContext"</span>;

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">selectSeries</span>( series:SeriesVO ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">this</span>.selectedItem = series;
            <span style="color: #00ffff;">this</span>.series = series;
            <span style="color: #00ffff;">this</span>.season = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">this</span>.story = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">this</span>.part = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">this</span>.chapter = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">this</span>.scene = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">this</span>.draft = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">this</span>.note = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">if</span> ( series ) {
            <span style="color: #00ffff;">this</span>.cast = series.cast;
            <span style="color: #00ffff;">this</span>.milieu = series.milieu;
            <span style="color: #00ffff;">this</span>.setting = <span style="color: #7fffd4;">null</span>;
            <span style="color: #00ffff;">this</span>.character = <span style="color: #7fffd4;">null</span>;
        }
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#27492;&#22788;&#30465;&#30053;&#19968;&#37096;&#20998;&#20195;&#30721;......</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">selectNote</span>( note:NoteVO ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">this</span>.note = note;
        }

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">selectCharacter</span>( character:CharacterVO ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">this</span>.selectedItem = character;
            <span style="color: #00ffff;">this</span>.character = character;
            <span style="color: #00ffff;">this</span>.note = <span style="color: #7fffd4;">null</span>;
        }

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">selectSetting</span>( setting:SettingVO ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">this</span>.selectedItem = setting;
            <span style="color: #00ffff;">this</span>.setting = setting;
            <span style="color: #00ffff;">this</span>.note = <span style="color: #7fffd4;">null</span>;
        }

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">selectedText</span>:String;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">selectedItem</span>:ValueObject;

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">series</span>:SeriesVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">season</span>:SeasonVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">story</span>:StoryVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">part</span>:PartVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">chapter</span>:ChapterVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">scene</span>:SceneVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">draft</span>:DraftVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">note</span>:NoteVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">cast</span>:CastVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">milieu</span>:MilieuVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">character</span>:CharacterVO;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">setting</span>:SettingVO;
    }
}
</pre>
</div>
</div></li></ol>
</div>
<div id="outline-container-orgheadline64" class="outline-4">
<h4 id="orgheadline64"><span class="section-number-4">1.4.4</span> The App Event</h4>
<div class="outline-text-4" id="text-1-4-4">
</div><ol class="org-ol"><li><a id="orgheadline60"></a>Class<br><div class="outline-text-5" id="text-1-4-4-1">
<p>
AppEvent.as<br>
</p>
</div></li>
<li><a id="orgheadline61"></a>Responsibilities<br><div class="outline-text-5" id="text-1-4-4-2">
<p>
用 AppEvent 来创建两部分协议的其中一部分。AppEvent 定义了所有从用户界面发起的请求，这些请求在其他地方（其他 ViewCommpoents 或者 Mediators 和 Commands）被处理。两部分协议的另外一部分是 AppConstants，其中定义了消息名称，它们由 View 层和 Controller 层共用。<br>
AppEvent 和 AppConstants 中的一些名称会相同，但是不要将这两个文件合为一个文件，因为 AppEvent 是定义和用户界面相关的事件名称，而 AppConstants 定义的是 PureMVC 系统中用到的消息名称，分开两者可以让 View Components 独立于 PureMVC。<br>
</p>
<ul class="org-ul">
<li>扩展 Flash Event 类<br></li>
<li>定义事件类型<br></li>
<li>为数据和相关数据定义 Object 类型的属性<br></li>
<li>在构造函数中接受 type data related 参数来设置相关的属性<br></li>
</ul>
</div></li>
<li><a id="orgheadline62"></a>Collaborations<br></li>
<li><a id="orgheadline63"></a>Code<br><div class="outline-text-5" id="text-1-4-4-4">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #00ffff;">package</span> com.futurescale.sa.view.<span style="color: #7fffd4;">event</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">events</span>.<span style="color: #98fb98;">Event</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">AppEvent</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Event</span>
    {
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Components of the AppEvent types</span>
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">ADD</span>:String = <span style="color: #ffa07a;">"add"</span>;
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">DELETE</span>:String = <span style="color: #ffa07a;">"delete"</span>;
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">MANAGE</span>:String = <span style="color: #ffa07a;">"manage"</span>;
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">...... &#30465;&#30053;</span>

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">AppEvent types</span>
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">ADD_SERIES</span>:String = ADD+SERIES;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">ADD_SEASON</span>:String = ADD+SEASON;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">ADD_EPISODE</span>:String = ADD+EPISODE;
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">...... &#30465;&#30053;</span>

        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">DELETE_SERIES</span>:String = DELETE+SERIES;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">DELETE_SEASON</span>:String = DELETE+SEASON;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">DELETE_EPISODE</span>:String = DELETE+EPISODE;
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">...... &#30465;&#30053;</span>

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">data</span>:Object; <span style="color: #ff0000;">// </span><span style="color: #ff0000;">optional data object</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">related</span>:Object; <span style="color: #ff0000;">// </span><span style="color: #ff0000;">optional related data object</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">AppEvent</span>( type:String, data:Object=<span style="color: #7fffd4;">null</span>, related:Object=<span style="color: #7fffd4;">null</span> )
        {
            <span style="color: #00ffff;">super</span>(type, <span style="color: #7fffd4;">true</span>, <span style="color: #7fffd4;">true</span>);
            <span style="color: #00ffff;">this</span>.data = data;
            <span style="color: #00ffff;">this</span>.related = related;
        }
    }
}
</pre>
</div>
</div></li></ol>
</div>
</div>
<div id="outline-container-orgheadline75" class="outline-3">
<h3 id="orgheadline75"><span class="section-number-3">1.5</span> 为模型实现 Proxys</h3>
<div class="outline-text-3" id="text-1-5">
<ul class="org-ul">
<li>Proxy 类非常简单，它有一些生命周期函数，在注册和删除时，这些函数会被调用；它包含一个 Object 类型的数据属性，以及对应的 getData 和 setData 方法；它可以发送消息，来单向通知 Mediators 或触发 Commands 执行。<br></li>
<li>Proxy 应该不关心任何 View 或 Controller 层的类，即不要再 Proxy 中引用任何 View 或 Controller 层的对象。<br></li>
<li>Proxy 通常是长期存在的角色，他们在启动时被注册，并且在运行过程中一直不被释放。那些被动态创建的 Proxy 实例通常为临时对象。<br></li>
<li>将 PureMVC 的 Model 想象为一个银行的地下室，而 Proxy 为其中的保险箱。每个保险箱有一个唯一的 key，你可以在保险箱中存储任何你想存储的东西。<br></li>
<li>Proxy 包含一个 facade 属性，这是一个 ApplicationFacade 的引用。可以用来注册、删除、获取其他 Proxys 甚至 Mediator。该属性是因为 Proxy 从 Notifier 派生而获得的，所以 Proxy 还可以直接调用 sendNotification()发送消息。切记，不要使用 facade 属性来操作和 View 或 Controller 层的对象。<br></li>
</ul>
</div>
<div id="outline-container-orgheadline66" class="outline-4">
<h4 id="orgheadline66"><span class="section-number-4">1.5.1</span> Proxy Life Cycle</h4>
<div class="outline-text-4" id="text-1-5-1">
<ul class="org-ul">
<li>你写的大部分 Proxy 子类，都是为了和远程服务器或文件系统交换数据，执行认证，执行 RTMP 通道通讯，执行 Socket 通讯等。对于系统的剩余部分，Proxys 相当于数据保存者和外面世界的网关。<br></li>
<li>Proxy 通常在模型准备阶段注册一次，一般时在 StartupCommand 中，在 Mediators 注册之前。<br></li>
<li>在运行过程中，Commands 和 Mediators 会使用名称来获取他们需要的 Proxys，然后调用 Proxys 的方法，设置或获取 Proxys 持有的数据。Proxys 不能接收消息。<br></li>
<li>有时候，为了保证数据的完整性，Proxys 之间需要相互通讯。一旦注册，他们可以像 Meditors 和 Commands 一样，获取某个 Proxy，然后和它交互。但是，这需要在 StartupCommand 中保证 Proxys 的注册顺序，从而加大了 StartupCommand 的维护难度。所以，当一个 Proxy 需要和另外一个 Proxy 通讯时，最好是在 Proxy 的构造函数中 require 它所依赖的其他 Proxys。<br></li>
<li>放在 Proxy 构造函数中做的事情，应该移到 onRegister()中，因为在构造函数执行完以后，Proxy 并没有注册，此时通过 facade 无法获取到 Proxy。<br></li>
<li>如果 Proxy 是动态创建和添加的，你需要在 Proxy 的 onRemove()事件中发送消息给 Mediators，让他们设置该 Proxy 的引用为 null<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline67" class="outline-4">
<h4 id="orgheadline67"><span class="section-number-4">1.5.2</span> 重新考察持久化策略</h4>
<div class="outline-text-4" id="text-1-5-2">
<p>
同步的工作方式为 数据请求发出后，阻塞等待数据返回，所需数据返回后，直接对数据进行操作。其优点是代码比较简单。<br>
异步的工作方式为 数据请求发出后，立即返回做其他事情，等数据返回后，再对数据进行操作。其优点是程序不会阻塞。<br>
</p>

<p>
在 StoryAchitect 中，应用程序采用同步的方式访问本地文件，本地文件镜像到服务器采用异步的方式。这样就可以充分利用同步和异步各自的优点。<br>
在 StoryAchitect 中，添加 index.xml 来存放实体元素的简介信息。例如：存储新的 StoryVO 时，可以将全部数据存储在一个数据 xml 文件中，将简介数据存储在一个索引 xml 文件中。这样就避免了，程序需要加载所有数据 xml 文件。<br>
</p>
</div>
</div>
<div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74"><span class="section-number-4">1.5.3</span> 创建 Proxys</h4>
<div class="outline-text-4" id="text-1-5-3">
<ol class="org-ol">
<li>到目前为止，我们确定需要创建下面四个 Proxy 子类：CastProxy,MilieuProxy,SeriesProxy,StoryProxy.我们知道这些类之间存在依赖关系，并且我们允许他们相互协作来管理这些依赖关系，这些类也都会对系统文件 I/O 和索引做很多相同的事情。<br></li>
<li>OOP 的一个经典决策点是：我们应该通过继承方式还是组合方式来添加这些相同的功能？有些人认为你应该总是采用某个而不是另一个，其实，你应该根据当前遇到的问题来选择合适的策略。Delegate 模式是组合方式的一个实例。如果你希望改变这些相同的功能，那么组合方式是一个好的选择，你只要重新设置 Delegate，就可以改变功能。组合描述的是 contain-a 的关系，派生描述的是 is-a 的关系，所以组合更加灵活。<br></li>
<li>StoryAchitect 中采用了继承方式来实现 Proxy 中的公共功能，当然也可以采用组合的方式来实现，在 ProxyHelper 类中实现所有公共的功能，然后，在各个 Proxy 子类中调用 ProxyHelper 的方法。<br></li>
</ol>
</div>
<ol class="org-ol"><li><a id="orgheadline72"></a>AbstractProxy<br><ol class="org-ol"><li><a id="orgheadline68"></a>Class<br><div class="outline-text-6" id="text-1-5-3-1-1">
<p>
AbstractProxy.as<br>
</p>
</div></li>
<li><a id="orgheadline69"></a>Responsibilities<br><div class="outline-text-6" id="text-1-5-3-1-2">
<ul class="org-ul">
<li>提供一个函数来连接到一个文件夹，该文件夹名称由子类提供。如果文件夹不存在就创建它，并且保证文件夹中存在一个索引文件，即使文件夹中不包含任何条目。<br></li>
<li>提供增加、保存、删除 ValueObject 的方法，自动更新文件系统和内存中对应的索引。<br></li>
<li>提供函数返回在文件夹索引文件中保存的 ValueObject 简介内容的集合<br></li>
<li>保证索引按照 ValueObject 的名称排序<br></li>
</ul>
</div></li>
<li><a id="orgheadline70"></a>Collaborations<br><div class="outline-text-6" id="text-1-5-3-1-3">
<p>
AbstractProxy 知道的元素 ：AbstractProxy 知道 Flash 的 File,FileMode 以及 FileStream 类来执行文件系统 I/O.它还知道 ArrayCollection,Sort 以及 SortField 来来创建基于名字排序的索引。它还知道 PureMVC 的 Proxy 类，以及我们定义的 ValueObject 类。<br>
知道 AbstractProxy 的元素：AbstractProxy 只被它的子类所知道<br>
</p>
</div></li>
<li><a id="orgheadline71"></a>Code<br><div class="outline-text-6" id="text-1-5-3-1-4">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #00ffff;">package</span> com.futurescale.sa.model.<span style="color: #7fffd4;">proxy</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">vo</span>.<span style="color: #98fb98;">ValueObject</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">filesystem</span>.<span style="color: #98fb98;">File</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">filesystem</span>.<span style="color: #98fb98;">FileMode</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">filesystem</span>.<span style="color: #98fb98;">FileStream</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">mx</span>.<span style="color: #7fffd4;">collections</span>.<span style="color: #98fb98;">ArrayCollection</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">proxy</span>.<span style="color: #98fb98;">Proxy</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">spark</span>.<span style="color: #7fffd4;">collections</span>.<span style="color: #98fb98;">Sort</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">spark</span>.<span style="color: #7fffd4;">collections</span>.<span style="color: #98fb98;">SortField</span>;

    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * Provides subclasses with a simple VO-to-disk</span>
<span style="color: #ffa07a;">    * API with automatic name-sorted indexing.</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">AbstractProxy</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Proxy</span>
    {

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Extension for files</span>
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">FILE_EXT</span>:String = <span style="color: #ffa07a;">".xml"</span>;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Index filename</span>
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">INDEX</span>:String = <span style="color: #ffa07a;">"index"</span>+FILE_EXT;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">The folder to access. Set by connectToFolder()</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">folder</span>:File;

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Constructor.</span>
<span style="color: #ffa07a;">        *</span>
<span style="color: #ffa07a;">        * Name provided by subclass, data property</span>
<span style="color: #ffa07a;">        * (used for the index of stubbed VOs) is</span>
<span style="color: #ffa07a;">        * initialized to ArrayCollection.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">AbstractProxy</span>( name:String )
        {
            <span style="color: #00ffff;">super</span>( name, <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ArrayCollection</span>() );
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * The name-sorted index of stubbed VOs.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #98fb98;">get</span> <span style="color: #87cefa;">index</span>():ArrayCollection
        {
            <span style="color: #00ffff;">return</span> data as ArrayCollection;
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Abstract factory method to create stubbed VOs</span>
<span style="color: #ffa07a;">        * for the index. Must be overridden in subclass</span>
<span style="color: #ffa07a;">        * and return a stubbed VO of the appropriate type</span>
<span style="color: #ffa07a;">        * for inclusion in the index.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getVoInstance</span>( xml:XML ):ValueObject
        {
            <span style="color: #00ffff;">return</span> <span style="color: #7fffd4;">null</span>;
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Sets the protected folder property.</span>
<span style="color: #ffa07a;">        *</span>
<span style="color: #ffa07a;">        * Also, if the folder does not exist, it is</span>
<span style="color: #ffa07a;">        * created and an empty index written. Otherwise,</span>
<span style="color: #ffa07a;">        * the index is read from the existing folder.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">connectToFolder</span>( name:String ):<span style="color: #98fb98;">void</span>
        {
            folder = File.applicationStorageDirectory.resolvePath( name );
            <span style="color: #00ffff;">if</span> ( !folder.exists ) {
                folder.createDirectory();
                writeIndex();
            } <span style="color: #00ffff;">else</span> {
                readIndex();
            }
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Write the Value Object's XML property to a file</span>
<span style="color: #ffa07a;">        * and update the index on disk and in memory.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">writeVO</span>( vo:ValueObject ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">file</span>:File = getFile( vo );
            writeFile( file, vo.xml );
            updateIndex( vo );
        }
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        *From the stub passed in, read the corresponding VO</span>
<span style="color: #ffa07a;">        * from the disk and return the XML.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">readVO</span>( voStub:ValueObject ):XML
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">file</span>:File = getFile( voStub );
            <span style="color: #00ffff;">return</span> XML ( readFile( file ) );
        }
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * From the VO passed in, delete the corresponding VO</span>
<span style="color: #ffa07a;">        * from the disk and update the index.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">deleteVO</span>( vo:ValueObject ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">file</span>:File = getFile( vo );
            <span style="color: #00ffff;">if</span> ( file.exists ) file.deleteFile();
            updateIndex( vo, <span style="color: #7fffd4;">true</span> );
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Read the index XML from disk and create the</span>
<span style="color: #ffa07a;">        * in memory index of stubbed VOs.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">readIndex</span>():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">read in the index XML</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">file</span>:File = folder.resolvePath( INDEX );
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">xml</span>:XML = readFile( file );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">build the index from the XML</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">ac</span>:ArrayCollection = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ArrayCollection</span>();
            <span style="color: #00ffff;">for</span> each ( <span style="color: #98fb98;">var</span> <span style="color: #87cefa;">ix</span>:XML in xml.children() )
            {
                <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">vo</span>:ValueObject = getVoInstance( ix );
                ac.addItem( vo );
            }

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Sort the index by name</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">sort</span>:Sort = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Sort</span>();
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">field</span>:SortField = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">SortField</span>( <span style="color: #ffa07a;">"name"</span> );
            sort.fields = [ field ];
            ac.sort = sort;
            ac.refresh();

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">set the index as the proxy data</span>
            setData( ac );
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Read the in memory index of stubbed VOs to</span>
<span style="color: #ffa07a;">        * the index XML file on disk.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">writeIndex</span>():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">file</span>:File = folder.resolvePath( INDEX );
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">xml</span>:XML = &lt;<span style="color: #98fb98;">index</span>&gt;&lt;/index&gt;;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">ivo</span>:ValueObject;
            <span style="color: #00ffff;">for</span> ( <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">i</span>:<span style="color: #98fb98;">int</span>=0; i &lt; index.<span style="color: #98fb98;">length</span>; i++ ){
                ivo = ValueObject( index.getItemAt(i) );
                xml.appendChild( ivo.getStub() );
            }
            writeFile( file, xml );
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Update the in memory index of stubbed VOs, replacing or</span>
<span style="color: #ffa07a;">        * removing the stubbed VO passed in, sort the index, and</span>
<span style="color: #ffa07a;">        * write the index XML file on disk.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">updateIndex</span>( vo:ValueObject, removing:Boolean=<span style="color: #7fffd4;">false</span> ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Find and remove existing item if present</span>
            <span style="color: #00ffff;">for</span> ( <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">i</span>:<span style="color: #98fb98;">int</span>=0; i &lt; index.<span style="color: #98fb98;">length</span>; i++ ){
                <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">ivo</span>:ValueObject = ValueObject( index.getItemAt(i) );
                <span style="color: #00ffff;">if</span> ( ivo.uid == vo.uid ) {
                    index.removeItemAt( i );
                    <span style="color: #00ffff;">break</span>;
                }
            }

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">add the new or updated item to index if not removing</span>
            <span style="color: #00ffff;">if</span> ( ! removing ) index.addItem( getVoInstance( vo.getStub() ) );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">re-sort the index</span>
            index.refresh();

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">persist the index</span>
            writeIndex();
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Write xml to a file.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">writeFile</span>( file:File, xml:XML ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">stream</span>:FileStream = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">FileStream</span>()
            stream.open( file, <span style="color: #7fffd4;">FileMode</span>.WRITE );
            stream.writeUTFBytes( xml );
            stream.close();
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Read XML from a file and return it.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">readFile</span>( file:File ):XML
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">stream</span>:FileStream = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">FileStream</span>()
            stream.open( file, <span style="color: #7fffd4;">FileMode</span>.READ );
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">xml</span>:XML = XML( stream.readUTFBytes( stream.bytesAvailable ) );
            stream.close();
            <span style="color: #00ffff;">return</span> xml;
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Get the corresponding File object for a given VO.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getFile</span>( vo:ValueObject ):File
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">filename</span>:String = vo.uid + FILE_EXT;
            <span style="color: #00ffff;">return</span> folder.resolvePath( filename );
        }
    }
}
</pre>
</div>
</div></li></ol></li>
<li><a id="orgheadline73"></a>其他 Proxy<br><div class="outline-text-5" id="text-1-5-3-2">
<ul class="org-ul">
<li>CastProxy<br></li>
<li>MilieuProxy<br></li>
<li>StoryProxy<br></li>
<li>SeriesProxy<br></li>
</ul>
</div></li></ol>
</div>
</div>
<div id="outline-container-orgheadline88" class="outline-3">
<h3 id="orgheadline88"><span class="section-number-3">1.6</span> 为视图实现 Mediators</h3>
<div class="outline-text-3" id="text-1-6">
<ol class="org-ol">
<li>就像前面说的，通讯是个双向街道。这是 Mediator 存在的核心原因，Mediator 用来促进 View Component 和应用程序的剩余部分之间的双向通讯。所以，Mediator 的大部分职责都是处理来自 ViewComponent 的事件，以及处理来自应用程序剩余部分的消息。这样就解除了应用程序和 ViewComponents 之间的耦合。<br></li>
<li>Mediator 类有一个 facade 属性，它是 ApplicationFacade 的引用。使用 facade 属性可以注册、删除、获取 Meditor，Proxys 以及 Commands。这个属性是通过继承 Notifier 来获得的，所以 Meditor 还可以调用 sendNotification。切记，不要使用 facade 来获取其他 Mediators，这样会让 Mediators 之间耦合在一起。<br></li>
</ol>
</div>
<div id="outline-container-orgheadline76" class="outline-4">
<h4 id="orgheadline76"><span class="section-number-4">1.6.1</span> Mediator Life Cycle</h4>
<div class="outline-text-4" id="text-1-6-1">
<ul class="org-ul">
<li>Mediator 获得它的 ViewComponent 的方式包括：<br></li>
<li>创建 Mediator 时，将 ViewComponent 传递给 Mediator 的构造函数。<br></li>
<li>Mediator 自己创建 ViewComponent<br></li>
<li>Mediator 注册之后，从某个消息接收到 ViewComponent<br></li>
</ul>
<p>
等等<br>
</p>
<ul class="org-ul">
<li>通常 Mediator 从被注册开始，在运行过程中长期存在。<br></li>
<li>在 Mediator 的 onRegister()方法中，我们会监听 ViewComponent 发送给 Mediator 的事件；获取 Mediator 要交互的 Proxys。<br></li>
<li>在 Mediator 的 onRemove()方法中，移除对 Proxys 的引用<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline78" class="outline-4">
<h4 id="orgheadline78"><span class="section-number-4">1.6.2</span> 和 ViewComponent 的交互</h4>
<div class="outline-text-4" id="text-1-6-2">
<ul class="org-ul">
<li>在实现一个 ViewComponent 的时候，我们不会到达应用程序的内部，获取一个 Proxy 来得到所需的数据。我们会为 ViewComponent 暴露属性和方法，这样数据就可以传递到 ViewComponent 内部。同样的在系统的其他地方，我们也不会直接获取一个 ViewCompoent，然后对它直接进行操作。我们会发送一个消息给它的 Mediator，由 Mediator 来通知它。<br></li>
<li>一个 Mediator 它应该调节，而不是思考。将思考的工作留给 Commands，它们只是将消息传递走。<br></li>
</ul>
</div>
<ol class="org-ol"><li><a id="orgheadline77"></a>依赖注入 Dependency Injection<br><div class="outline-text-5" id="text-1-6-2-1">
<p>
很多人认为 PureMVC 缺乏 DI 特性，其实 Mediator 做的事情就是依赖注入。通过函数调用或设置属性它将 VO 传递给 ViewComponent。ViewComponent 依赖于 ValueObject 来执行工作。Mediator 将 ValueObject 注入到 ViewComponent 中。<br>
PureMVC 缺乏的是编译级别的依赖注入。例如 Flex 的数据绑定就是编译器依赖注入。而编译级别的依赖注入，会降低应用程序的可移植性。<br>
</p>
</div></li></ol>
</div>
<div id="outline-container-orgheadline79" class="outline-4">
<h4 id="orgheadline79"><span class="section-number-4">1.6.3</span> 和应用程序的交互</h4>
<div class="outline-text-4" id="text-1-6-3">
<ol class="org-ol">
<li>通过 listNotificationInterests()来列出 Mediator 感兴趣的消息<br></li>
<li>通过 handleNotification()来相应接收到的消息<br></li>
<li><p>
什么时候你发送一个消息给 Command 来处理，而什么时候你直接和 Proxys 交互？<br>
</p>
<ul class="org-ul">
<li>如果你要执行逻辑，传递或验证数据或者是和多个 Proxy 通讯，最好是将这些操作放在一个 Command 中，然后，通过 Mediator 发送一个消息来触发 Command 的执行。<br></li>
</ul>
<p>
当你需要在很多地方触发相同的功能时，也采用这种方式。<br>
Notification 和 Command 是多对一的关系。不同的消息，可以触发相同的 Command。<br>
</p>
<ul class="org-ul">
<li>如果你只是将数据从 ViewComponent 传递给 Proxy 的一个方法，你可以直接调用 Proxy 的方法即可。<br></li>
</ul></li>
<li>避免在一个 Mediator 中获取另一个 Mediator，来调用另一个 Mediator 的方法或设置它的属性。Proxys 之间可以获取彼此，是为了方便维护数据模型的完整性，而 Mediator 之间没有什么理由耦合在一起。<br></li>
<li>一个 ViewComponent 可以有多个 Mediator，Notification 有一个 type 属性，通过该属性可以标识，消息发送给哪个 Meditor。<br></li>
</ol>
</div>
</div>
<div id="outline-container-orgheadline80" class="outline-4">
<h4 id="orgheadline80"><span class="section-number-4">1.6.4</span> 确定调解的粒度 (Determing Granularity of Mediation)</h4>
<div class="outline-text-4" id="text-1-6-4">
<p>
我们需要多少 Mediator，是否每个 Button 都需要一个 Mediator？<br>
这取决于我们创建的视图树。以及由多少组件需要自定义处理。最好的方式是从上到下来考虑，而不是从一个 Button 开始考虑。<br>
首先，我们通常人物 App 需要一个 Mediator。在我们的 StoryArchitect 中，这个 App 的 Mediator 需要有注入的 SelectionContxt，并且我们可以让 ApplicationMediator 来切换 StoryArchitect 的显示模式。<br>
其次，Chooser 和 Editor 是用户界面中的两个主要视图，他们在需求上完全不同，所以将分别为他们创建 Mediator 比将所有操作都放在 ApplicationMediator 中要更好。<br>
</p>
</div>
</div>
<div id="outline-container-orgheadline87" class="outline-4">
<h4 id="orgheadline87"><span class="section-number-4">1.6.5</span> 创建 Mediators</h4>
<div class="outline-text-4" id="text-1-6-5">
<p>
根据我们的情况，我们需要创建下面三个 Mediator 子类：ApplicationMediator,ChooserMediator,EditorMediator.这些类之间不需要共享公共的功能，所以我们不需要创建一个像 AbstractProxy 一样的 AbstractMediator。<br>
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline85"></a>ApplicationMediator<br><ol class="org-ol"><li><a id="orgheadline81"></a>Class<br><div class="outline-text-6" id="text-1-6-5-1-1">
<p>
ApplicationMediator.as<br>
</p>
</div></li>
<li><a id="orgheadline82"></a>Responsibilities<br><div class="outline-text-6" id="text-1-6-5-1-2">
<ul class="org-ul">
<li>在注册的时候，获取临时的 Proxy 保存 SelectionContext 并且设置 StoryArchitect 的 context 属性。<br></li>
<li>在注册的时候，同时设置应用程序为 StoryArchitect.MODE_CHOOSER<br></li>
<li>需要注意的是，在注册的时候，StoryArchitect 不会发送任何我们需要处理的事件<br></li>
<li>声明感兴趣的消息：AppConstants.SHOW_EDITOR 和 AppConstants.SHOW_CHOOSER<br></li>
<li>通过设置 Application 为对于的模式来处理这些消息<br></li>
<li>定义一个名为 app 的私有的 getter 方法，将 viewComponent 属性转化为 StoryArchitect 类型<br></li>
</ul>
</div></li>
<li><a id="orgheadline83"></a>Collaborations<br></li>
<li><a id="orgheadline84"></a>Code<br><div class="outline-text-6" id="text-1-6-5-1-4">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #00ffff;">package</span> com.futurescale.sa.view.<span style="color: #7fffd4;">mediator</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">controller</span>.<span style="color: #7fffd4;">constant</span>.<span style="color: #98fb98;">AppConstants</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">context</span>.<span style="color: #98fb98;">SelectionContext</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">INotification</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">IProxy</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">Mediator</span>;

    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * Mediate communications with the Application component.</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">ApplicationMediator</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Mediator</span>
    {
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Mediator registration name.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">"ApplicationMediator"</span>;

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Construct with an instance of the application.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">ApplicationMediator</span>( app:StoryArchitect )
        {
            <span style="color: #00ffff;">super</span>( NAME, app );
        }
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Called when Mediator is registered.</span>
<span style="color: #ffa07a;">        */</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">onRegister</span>():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Set the SelectionContext</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">scProxy</span>:IProxy = facade.retrieveProxy( <span style="color: #7fffd4;">SelectionContext</span>.NAME );
            app.context = SelectionContext( scProxy.getData() );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Set the initial display mode</span>
            app.setMode( <span style="color: #7fffd4;">StoryArchitect</span>.MODE_CHOOSER );
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Notifications this Mediator is interested in.</span>
<span style="color: #ffa07a;">        */</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">listNotificationInterests</span>():Array
        {
            <span style="color: #00ffff;">return</span> [ <span style="color: #7fffd4;">AppConstants</span>.SHOW_EDITOR,
            <span style="color: #7fffd4;">AppConstants</span>.SHOW_CHOOSER,
            ];
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Handle the notifications this Mediator is interested in.</span>
<span style="color: #ffa07a;">        */</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handleNotification</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">switch</span> ( note.getName() )
            {
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.SHOW_EDITOR:
                    app.setMode( <span style="color: #7fffd4;">StoryArchitect</span>.MODE_EDITOR );
                    <span style="color: #00ffff;">break</span>;
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.SHOW_CHOOSER:
                    app.setMode( <span style="color: #7fffd4;">StoryArchitect</span>.MODE_CHOOSER );
                    <span style="color: #00ffff;">break</span>;
            }
        }
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Cast the View Component to the correct type</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #98fb98;">get</span> <span style="color: #87cefa;">app</span>():StoryArchitect
        {
            <span style="color: #00ffff;">return</span> viewComponent as StoryArchitect;
        }
    }
}
</pre>
</div>
</div></li></ol></li>
<li><a id="orgheadline86"></a>其他 Mediator<br><div class="outline-text-5" id="text-1-6-5-2">
<ul class="org-ul">
<li>ChooserMediator<br></li>
<li>EditorMediator<br></li>
</ul>
</div></li></ol>
</div>
</div>
<div id="outline-container-orgheadline102" class="outline-3">
<h3 id="orgheadline102"><span class="section-number-3">1.7</span> 在 Commands 中实现业务逻辑</h3>
<div class="outline-text-3" id="text-1-7">
</div><div id="outline-container-orgheadline92" class="outline-4">
<h4 id="orgheadline92"><span class="section-number-4">1.7.1</span> 两种逻辑</h4>
<div class="outline-text-4" id="text-1-7-1">
</div><ol class="org-ol"><li><a id="orgheadline89"></a>领域逻辑 Domain Logic<br><div class="outline-text-5" id="text-1-7-1-1">
<ul class="org-ul">
<li>ValueObject,AbstarctProxy 以及它们的子类都属于领域逻辑。它主要处理领域模型数据结构的表示持久化。<br></li>
<li>ValueObjects 封装一些必要的逻辑来将数据表示为类型对象，并且提供属性让应用程序的其他部分操作。通常 ValueObjects 中只有属性，而没有逻辑；或者是当逻辑很简单时，它可以放在 Proxys 中；或者是当逻辑很多时，以 delegate 或者 helper 的形式来被 Proxys 使用。<br></li>
<li>Proxys 和 VOs 以可靠的方式来处理数据的持久化和获取。我们不会依赖 Commands 来保证数据的完整性，或者是直接负责数据的持久化。<br></li>
</ul>
</div></li>
<li><a id="orgheadline90"></a>业务逻辑 Business Logic<br><div class="outline-text-5" id="text-1-7-1-2">
<p>
业务逻辑必须处理应用程序的目标或者业务，满足各种使用需求。这些代码使用领域模型数据来工作，但是其目的是为了准备让 View 层来展示这些数据。它不属于 Model 层，当某个使用需求不需要时，可以去掉该使用需求相应的 Business Logic 代码，但是这些业务逻辑代码使用的领域数据不能去掉，因为这些数据可能还会被其他业务逻辑使用。<br>
</p>
</div></li>
<li><a id="orgheadline91"></a>为什么要区分领域逻辑和业务逻辑？<br><div class="outline-text-5" id="text-1-7-1-3">
<p>
这样提高了 Model 层的复用性。当需要复用 Model 时，只需要将相关的 ValueObjects、Proxys 打包到另一个应用程序中就可以了。而如果不区分这两者时，还需要在 Command 中分离出业务逻辑相关的代码，如果业务逻辑和领域逻辑混合在一起，分离就更加困难了。<br>
</p>
</div></li></ol>
</div>
<div id="outline-container-orgheadline93" class="outline-4">
<h4 id="orgheadline93"><span class="section-number-4">1.7.2</span> Command Life Cycle</h4>
<div class="outline-text-4" id="text-1-7-2">
<ul class="org-ul">
<li>Commands 通常在 ApplicationFacade 的 initializeController()函数中注册，在那里将一个或多个事件名称注册给一个 Command 类。<br></li>
<li>Command 没有 onRegister()和 onRemove()方法，它是一个短生命周期的角色。当任何一个 Command 所注册到的消息被其他角色发送时，就会实例化一个该 Command 类型的实例。一旦该 Command 完成它的工作，框架将不会保持该 Command 实例的任何引用，它就会被释放。所以，Command 应该是无状态的。<br></li>
<li>有两种类型的 Command：SimpleCommand 和 MacroCommand。<br></li>
<li>在 SimpleCommand 中，你只需要重写 execute()方法并且将你的逻辑放在其中。在构造函数结束后，会立即调用 execute，并会将触发它的 Notification 传递进来。<br></li>
<li>在 MacroCommand 中，你需要重写 initializeMacroCommand()方法，并且调用 addSubCommand()一次或多次，并且传递 Command 类名。当一个 MacroCommand 的 execute 被调用时，它会以先进先出的顺序调用各个子 Command。每个子 Command 可以是一个 SimpleCommand 也可以是一个 MacroCommand，他们都会接收到原始的 Notification。<br></li>
<li>Command 类有一个 facade 属性，它是 ApplicationFacade 的引用。可以使用该属性注册、删除或获取 Mediators、Proxys，并且可以注册和删除 Commands。这个属性是通过继承 Notifier 来获得的，所以 Command 还可以调用 sendNotification。<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline100" class="outline-4">
<h4 id="orgheadline100"><span class="section-number-4">1.7.3</span> 创建 Commands</h4>
<div class="outline-text-4" id="text-1-7-3">
</div><ol class="org-ol"><li><a id="orgheadline98"></a>StartupCommand<br><ol class="org-ol"><li><a id="orgheadline94"></a>Class<br><div class="outline-text-6" id="text-1-7-3-1-1">
<p>
StartupCommand.as<br>
</p>
</div></li>
<li><a id="orgheadline95"></a>Responsibilities<br></li>
<li><a id="orgheadline96"></a>Collaborations<br></li>
<li><a id="orgheadline97"></a>Code<br><div class="outline-text-6" id="text-1-7-3-1-4">
<div class="org-src-container">

<pre class="src src-java"><span style="color: #00ffff;">package</span> com.futurescale.sa.controller.command.<span style="color: #7fffd4;">startup</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">proxy</span>.<span style="color: #98fb98;">CastProxy</span>;
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#30465;&#30053;&#37096;&#20998;&#23548;&#20837;&#31867;&#20195;&#30721;</span>
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">popup</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">StoryPopupMediator</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">INotification</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">command</span>.<span style="color: #98fb98;">SimpleCommand</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">proxy</span>.<span style="color: #98fb98;">Proxy</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">StartupCommand</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">SimpleCommand</span>
    {
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">execute</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">MODEL PREPARATION PHASE</span>
            <span style="color: #ff0000;">//</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Create and register the Proxys for the domain model.</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">castProxy</span>:CastProxy = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">CastProxy</span>();
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">milieuProxy</span>:MilieuProxy = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">MilieuProxy</span>();
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">storyProxy</span>:StoryProxy = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">StoryProxy</span>( milieuProxy, castProxy );
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">seriesProxy</span>:SeriesProxy = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">SeriesProxy</span>( storyProxy, milieuProxy,
            castProxy);
            facade.registerProxy( castProxy );
            facade.registerProxy( milieuProxy );
            facade.registerProxy( storyProxy );
            facade.registerProxy( seriesProxy );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">VIEW PREPARATION PHASE</span>
            <span style="color: #ff0000;">//</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Get the application from the note body</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">app</span>:StoryArchitect = StoryArchitect( note.getBody() );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Register a convenience Proxy to hold the SelectionContext.</span>
            <span style="color: #ff0000;">//</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">The SelectionContext tracks the selected items in the View</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">and is not part of the domain model, but we can utilize</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">the framework Proxy class as a quick way to cache this data</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">entity used solely by the View and Controller tiers.</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">selectionContext</span>:SelectionContext = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">SelectionContext</span>();
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">scProxy</span>:Proxy = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Proxy</span>( <span style="color: #7fffd4;">SelectionContext</span>.NAME, selectionContext );
            facade.registerProxy( scProxy );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Mediate the initial View Components</span>
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ApplicationMediator</span>( app ) );
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">EditorMediator</span>( app.editor ) );
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ChooserMediator</span>( app.chooser ) );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Register the popup mediators</span>
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">AlertPopupMediator</span>() );
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ConfirmationPopupMediator</span>() );
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">StoryPopupMediator</span>() );
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">SeriesPopupMediator</span>() );
        }
    }
}
</pre>
</div>
</div></li></ol></li>
<li><a id="orgheadline99"></a>其他 Command<br><div class="outline-text-5" id="text-1-7-3-2">
<ul class="org-ul">
<li>EditStoryCommand<br></li>
<li>ApplySelectionCommand<br></li>
<li>RemoveSelectionCommand<br></li>
<li>ApplyChangesCommand<br></li>
<li>DiscardChangesCommand<br></li>
<li>AddItemCommand<br></li>
</ul>
</div></li></ol>
</div>
<div id="outline-container-orgheadline101" class="outline-4">
<h4 id="orgheadline101"><span class="section-number-4">1.7.4</span> 注册 Commands</h4>
<div class="outline-text-4" id="text-1-7-4">
<p>
我们不将 Commands 的注册也放在 StartupCommand 中的原因是，我们通常会在 ApplicationFacade 中重写 initializeController()来使用一个 STARTUP 消息来引导应用程序的启动。所以将所有的 Command 注册放在一个地方是合情合理的。<br>
当然，除了注册到 STARTUP 的 Command 以外，也可以将其他 Command 的注册移到 StartupCommand 中。将 StartCommand 变为一个 MacroCommand，调用 addSubCommand()方法，并且依次以 PrepareControllerCommand，PrepareModelCommand,PrepareViewCommand 为参数。<br>
先注册 Commands 的好处是，可以处理 Proxy 和 Mediator 在 onRegister()中触发的消息。<br>
</p>
<ul class="org-ul">
<li>TIPS<br></li>
</ul>
<p>
如果 Commands 没有被注册，他们就不会被执行。<br>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;"> * Register the Commands.</span>
<span style="color: #ffa07a;"> */</span>
 override <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">initializeController</span>():<span style="color: #98fb98;">void</span>
 {
    <span style="color: #00ffff;">super</span>.initializeController();

    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Initiated by the App</span>
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.STARTUP, StartupCommand );
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Initiated by the Chooser</span>
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.MANAGE_STORY, ManageStoryCommand );
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.MANAGE_SERIES, ManageSeriesCommand );
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.EDIT_STORY, EditStoryCommand );
    registerCommand( <span style="color: #7fffd4;">StoryProxy</span>.STORY_ADDED, EditStoryCommand );
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Initiated by the Editor</span>
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.ADD_ITEM, AddItemCommand );
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.DELETE_ITEM, DeleteItemCommand );
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.APPLY_SELECTION, ApplySelectionCommand );
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.REMOVE_SELECTION, RemoveSelectionCommand);
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.DISCARD_CHANGES, DiscardChangesCommand );
    registerCommand( <span style="color: #7fffd4;">AppConstants</span>.APPLY_CHANGES, ApplyChangesCommand);
 }
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline107" class="outline-3">
<h3 id="orgheadline107"><span class="section-number-3">1.8</span> 关于 Model 的高级主题</h3>
<div class="outline-text-3" id="text-1-8">
</div><div id="outline-container-orgheadline105" class="outline-4">
<h4 id="orgheadline105"><span class="section-number-4">1.8.1</span> 处理异步行为</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
<a id="orgtarget2"></a><br>
在 Proxy 为同步的实例中，Command 中获取数据和对取得的数据的操作是在同一段代码中依次执行的。而在 Proxy 为异步的实例中，Command 中获取数据和对取得数据的操作是分开的。这意味着创建 App 的方式和 Proxy 采用了同步、异步还是混合的行为方式有关。这也是为什么需要在创建 Mediators 和 Commands 之前创建 Proxys 的原因之一。<br>
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline103"></a>分开调用者和响应者<br><div class="outline-text-5" id="text-1-8-1-1">
<p>
一个角色在 Proxy 上调用请求，另一个或多个角色(Mediators 和/或 Command)处理请求结果<br>
</p>
</div></li>
<li><a id="orgheadline104"></a>不分开调用者和响应者<br><div class="outline-text-5" id="text-1-8-1-2">
<p>
有时候我们希望可以有一个 SimpleCommand 实例，使用用它既可以调用 Proxy 上获取远端数据的方法，又可以接收异步的返回，从而使用获得的数据继续处理它的业务逻辑。这种方式的最大好处是从领域逻辑中解耦了 Command。<br>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">ServiceRequest.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.model.<span style="color: #7fffd4;">request</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">observer</span>.<span style="color: #98fb98;">Observer</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">ServiceRequest</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Observer</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">RESULT_OK</span>:String = <span style="color: #ffa07a;">"result/ok"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">RESULT_FAIL</span>:String = <span style="color: #ffa07a;">"result/fail"</span>;

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">hasCallback</span>:Boolean = <span style="color: #7fffd4;">false</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">requestData</span>:Object;
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">resultData</span>:Object;

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">ServiceRequest</span>( requestData:Object = <span style="color: #7fffd4;">null</span>,
        callback:Function = <span style="color: #7fffd4;">null</span>,
        caller:Object = <span style="color: #7fffd4;">null</span> ) {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Store the Observer info</span>
            <span style="color: #00ffff;">super</span>( callback, caller );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Store the request data</span>
            <span style="color: #00ffff;">this</span>.requestData = requestData;

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Remember whether complete Observer info was specified</span>
            hasCallback = ( callback != <span style="color: #7fffd4;">null</span> &amp;&amp; caller != <span style="color: #7fffd4;">null</span> );
        }
    }
}
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">SearchStoryCommand.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.controller.command.<span style="color: #7fffd4;">story</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">controller</span>.<span style="color: #7fffd4;">constant</span>.<span style="color: #98fb98;">AppConstants</span>;
    <span style="color: #ff0000;">//</span><span style="color: #ff0000;">&#30465;&#30053;......</span>

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">SearchStoryCommand</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">SimpleCommand</span>
    {
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">term</span>:String; <span style="color: #ff0000;">// </span><span style="color: #ff0000;">the search term</span>

        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">execute</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Get the search term from the note type</span>
            term = note.getType();

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Get the story stub from the note body</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">storyVO</span>:StoryVO = StoryVO( note.getBody );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Get the StoryReadingProxy</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">proxy</span>:IProxy = facade.retrieveProxy( <span style="color: #7fffd4;">StoryReadingProxy</span>.NAME );
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">readerProxy</span>:StoryReadingProxy = StoryReadingProxy( proxy );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Create the ServiceRequest</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">request</span>:ServiceRequest =
            <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ServiceRequest</span>( storyVO, searchStory, <span style="color: #00ffff;">this</span> );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Load the story</span>
            readerProxy.loadStory( request );
        }

        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">searchStory</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Get the completed request from the note body</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">request</span>:ServiceRequest = ServiceRequest( note.getBody() );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Handle the result</span>
            <span style="color: #00ffff;">switch</span> ( note.getName() ) {

                <span style="color: #ff0000;">// </span><span style="color: #ff0000;">RESULT_OK: Search for first occurance, send note with result</span>
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">ServiceRequest</span>.RESULT_OK:
                    <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">story</span>:StoryVO = StoryVO( request.resultData );
                    <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">firstOccurance</span>:<span style="color: #98fb98;">int</span> = story.getText().indexOf( term );
                    sendNotification( <span style="color: #7fffd4;">AppConstants</span>.SEARCH_RESULT, firstOccurance );
                    <span style="color: #00ffff;">break</span>;

                <span style="color: #ff0000;">// </span><span style="color: #ff0000;">RESULT_FAIL: Send failure message in a note to be displayed</span>
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">ServiceRequest</span>.RESULT_FAIL:
                    <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">message</span>:String = String( request.resultData );
                    sendNotification( <span style="color: #7fffd4;">AppConstants</span>.REPORT_FAILURE, message );
                    <span style="color: #00ffff;">break</span>;
            }
        }
    }
}
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">StoryReadingProxy.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.model.<span style="color: #7fffd4;">proxy</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">request</span>.<span style="color: #98fb98;">ServiceRequest</span>;
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#30465;&#30053;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;</span>

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">StoryReadingProxy</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Proxy</span> <span style="color: #00ffff;">implements</span> <span style="color: #98fb98;">IResponder</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">"StoryReadingProxy"</span>;
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">service</span>:RemoteObject;

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">StoryReadingProxy</span>()
        {
            <span style="color: #00ffff;">super</span>( NAME );
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Create the service at registration time</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">onRegister</span>():<span style="color: #98fb98;">void</span>
        {
            service = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">RemoteObject</span>(<span style="color: #ffa07a;">"StoryReadingService"</span>);
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Load Story from remote service</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">loadStory</span>( request:ServiceRequest ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">story</span>:StoryVO = request.requestData as StoryVO;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">token</span>:AsyncToken = service.loadStory( story );
            token.request = request; <span style="color: #ff0000;">// </span><span style="color: #ff0000;">hang onto the request</span>
            token.addResponder( <span style="color: #00ffff;">this</span> ); <span style="color: #ff0000;">// </span><span style="color: #ff0000;">this proxy will respond</span>
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Handle loaded story</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">result</span>( data:Object ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">event</span>:ResultEvent = ResultEvent(data);
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">token</span>:AsyncToken = event.token;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">request</span>:ServiceRequest = token.request;
            request.resultData = event.result; <span style="color: #ff0000;">// </span><span style="color: #ff0000;">the loaded story</span>
            <span style="color: #00ffff;">if</span> ( request.hasCallback ) {
                <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">note</span>:Notification;
                note = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Notification</span>( <span style="color: #7fffd4;">ServiceRequest</span>.RESULT_OK, request );
                request.notifyObserver( note );
            }
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Handle a failed story load</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">fault</span>( info:Object ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">event</span>:FaultEvent = FaultEvent(data);
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">token</span>:AsyncToken = event.token;
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">request</span>:ServiceRequest = token.request;
            request.resultData = event.message.toString();
            <span style="color: #00ffff;">if</span> ( request.hasCallback ) {
                <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">note</span>:Notification;
                note = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Notification</span>( <span style="color: #7fffd4;">ServiceRequest</span>.RESULT_FAIL, request );
                request.notifyObserver( note );
                Handling <span style="color: #98fb98;">Asynchronous</span> <span style="color: #eedd82;">Behavior</span> | 187
            }
        }
    }
}
</pre>
</div>
</div></li></ol>
</div>
<div id="outline-container-orgheadline106" class="outline-4">
<h4 id="orgheadline106"><span class="section-number-4">1.8.2</span> 复用 Model 层</h4>
<div class="outline-text-4" id="text-1-8-2">
<ol class="org-ol">
<li>如果你想在多个应用程序之间共享 Model 层；或者你想在单独的项目中对 Model 层进行测试；或者只是为了确保 Model 层完全独立于应用程序的其他部分可以被复用。你可以将 Model 层移到一个新的库工程中，将其独立出来。<br></li>
<li>独立出来后，可以为 Model 层的注册创建一个 PrepareModelCommand。相应的创建 PrepareViewCommand,PrepareControllerCommand，使的三者的注册相互独立。<br></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgheadline111" class="outline-3">
<h3 id="orgheadline111"><span class="section-number-3">1.9</span> 关于 View 的高级主题</h3>
<div class="outline-text-3" id="text-1-9">
</div><div id="outline-container-orgheadline108" class="outline-4">
<h4 id="orgheadline108"><span class="section-number-4">1.9.1</span> Managing Pop Ups</h4>
<div class="outline-text-4" id="text-1-9-1">
<p>
PureMVC 处理弹出框的方式：<br>
<a id="orgtarget4"></a><br>
</p>
<ul class="org-ul">
<li>在任何 Command 中，当需要弹框时，创建一个弹框，设置事件监听，使用 PopUpManager 打开它将其放置在中心，从弹框内部或通过 Command 的事件处理来关闭它。<br>
<a id="orgtarget5"></a><br>
单例确实是魔鬼，因为我们可以在任何地方访问它，这使得我们的代码莫名其妙的相互依赖。<br></li>
<li>使用 PopMediator 来处理所有的弹框，创建弹框通过消息来传递给其他的 Command 或 Mediator。<br>
这种方式将所有和 PopUpManager 交互的逻辑放在了一个角色中，这非常好，但是这种方法将我们的逻辑分为两半，即分为了调用者和响应者，增加了逻辑的复杂度。<br></li>
<li>使用 PopMediator 来处理和 PopUpManager 的交互，但是使用 Command 来创建弹框，为弹框发送的事件设置监听，将创建的弹框通过消息发送给 PopMediator。<br>
这种方式可以让我们将大部分或所有使用逻辑放在一个 Command 中，但是这种方式将 Command 和 ViewComponent 耦合在了一起。Command 可以直接更新 ViewComponent，但是，在 Command 中创建和操作 ViewComponent 是无理由的。<br></li>
<li>我们在这里遇到的问题，其实和 Proxy 异步获取数据问题一样，这些都是异步边界交互。我们可以形式化请求并封装会掉机制到一个单独的 Request 类中，以这种方式来解决上面问题。<br></li>
</ul>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">PopupRequest.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.view.popup.<span style="color: #7fffd4;">request</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">display</span>.<span style="color: #98fb98;">DisplayObject</span>;
    <span style="color: #ff0000;">//</span><span style="color: #ff0000;">&#30465;&#30053;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;</span>

    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * PopupRequest carries all the information necessary</span>
<span style="color: #ffa07a;">    * to request a popup be created by its mediator.</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">PopupRequest</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Observer</span>
    {
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Prefix for all request notification names</span>
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">"PopupRequest/"</span>;
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Add new request notification names here...</span>
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">ALERT_POPUP</span>:String = NAME + <span style="color: #ffa07a;">"AlertPopup"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">CONFIRMATION_POPUP</span>:String = NAME + <span style="color: #ffa07a;">"ConfirmationPopup"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">SERIES_POPUP</span>:String = NAME + <span style="color: #ffa07a;">"SeriesPopup"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">STORY_POPUP</span>:String = NAME + <span style="color: #ffa07a;">"StoryPopup"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">CHARACTER_POPUP</span>:String = NAME + <span style="color: #ffa07a;">"CharacterPopup"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">SETTING_POPUP</span>:String = NAME + <span style="color: #ffa07a;">"SettingPopup"</span>;

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Constructor.</span>
<span style="color: #ffa07a;">        * Example: new PopupRequest( handlePopupNotification, this );</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">PopupRequest</span>( callback:Function=<span style="color: #7fffd4;">null</span>,
        caller:Object=<span style="color: #7fffd4;">null</span> )
        {
            <span style="color: #00ffff;">super</span>( callback, caller );
            hasCallback = ( callback != <span style="color: #7fffd4;">null</span> &amp;&amp; caller != <span style="color: #7fffd4;">null</span> );
        }
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Request has a callback. (Set by constructor)</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">hasCallback</span>:Boolean = <span style="color: #7fffd4;">false</span>;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Parent in the display list to open the popup over.</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">parent</span>:DisplayObject =
        FlexGlobals.topLevelApplication as DisplayObject;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Child list to place the popup in</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">childList</span>:String = <span style="color: #7fffd4;">PopUpManagerChildList</span>.PARENT;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Should the popup be centered?</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">center</span>:Boolean = <span style="color: #7fffd4;">true</span>;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Should the popup be modal?</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">modal</span>:Boolean = <span style="color: #7fffd4;">true</span>;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Optional data for the popup to use,</span>
        <span style="color: #ff0000;">//</span><span style="color: #ff0000;">such as a title or width and height</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">data</span>:Object = {};

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Convenience method for creating a new Alert Request</span>
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getAlertRequest</span>( message:String,
        windowTitle:String=<span style="color: #ffa07a;">"Alert"</span>,
        callback:Function=<span style="color: #7fffd4;">null</span>,
        caller:Object = <span style="color: #7fffd4;">null</span>):PopupRequest {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">request</span>:PopupRequest = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">PopupRequest</span>( callback, caller );
            request.childList = <span style="color: #7fffd4;">PopUpManagerChildList</span>.POPUP;
            request.data.windowTitle = windowTitle;
            request.data.message = message;
            <span style="color: #00ffff;">return</span> request;
        }
    }
}
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">PopupActionEvent.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.view.popup.<span style="color: #7fffd4;">event</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">events</span>.<span style="color: #98fb98;">Event</span>;
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">PopupActionEvent</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Event</span>
    {
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Prefix for all popup action event types</span>
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">"PopupEvent/"</span>;
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Add new event names here...</span>
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">CANCEL</span>:String = NAME + <span style="color: #ffa07a;">"cancel"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">OK</span>:String = NAME + <span style="color: #ffa07a;">"ok"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">ADD</span>:String = NAME + <span style="color: #ffa07a;">"add"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">SAVE</span>:String = NAME + <span style="color: #ffa07a;">"save"</span>;
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">DELETE</span>:String = NAME + <span style="color: #ffa07a;">"delete"</span>;

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Constructor.</span>
<span style="color: #ffa07a;">        *</span>
<span style="color: #ffa07a;">        * Dispatched from a popup, captured by PopupMediatorBase and sent</span>
<span style="color: #ffa07a;">        * back to the original caller for interpretation.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">PopupActionEvent</span>( type:String,
        data:Object = <span style="color: #7fffd4;">null</span>,
        closePopup:Boolean=<span style="color: #7fffd4;">true</span> ) {
            <span style="color: #00ffff;">super</span>( type );
            <span style="color: #00ffff;">this</span>.data = data;
            <span style="color: #00ffff;">this</span>.closePopup = closePopup;
        }

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">data</span>:Object; <span style="color: #ff0000;">// </span><span style="color: #ff0000;">optional data</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">closePopup</span>:Boolean; <span style="color: #ff0000;">// </span><span style="color: #ff0000;">close the popup?</span>

    }
}
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">IPopup.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.view.popup.<span style="color: #7fffd4;">component</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">mx</span>.<span style="color: #7fffd4;">core</span>.<span style="color: #98fb98;">IFlexDisplayObject</span>;
    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * Interface for popups</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">interface</span> <span style="color: #98fb98;">IPopup</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">IFlexDisplayObject</span>
    {
        <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">setData</span>( data:Object ):<span style="color: #98fb98;">void</span>;
        <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getEvents</span>():Array;
    }
}
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">ConfirmationPopup.mxml</span>
&lt;?xml version=<span style="color: #ffa07a;">"1.0"</span> encoding=<span style="color: #ffa07a;">"utf-8"</span>?&gt;
&lt;!-- CONFIRMATION POPUP --&gt;
&lt;s:TitleWindow xmlns:fx=<span style="color: #ffa07a;">"http://ns.adobe.com/mxml/2009"</span>
                xmlns:s=<span style="color: #ffa07a;">"library://ns.adobe.com/flex/spark"</span>
                title=<span style="color: #ffa07a;">"{windowTitle}"</span> width=<span style="color: #ffa07a;">"200"</span> height=<span style="color: #ffa07a;">"150"</span> close=<span style="color: #ffa07a;">"onCancel()"</span>
                <span style="color: #00ffff;">implements</span>=<span style="color: #ffa07a;">"com.futurescale.sa.view.popup.component.IPopup"</span>&gt;
    &lt;fx:Script&gt;
        &lt;![CDATA[
        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">popup</span>.<span style="color: #7fffd4;">event</span>.<span style="color: #98fb98;">PopupActionEvent</span>;

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Required by IPopup interface</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">setData</span>( data:Object ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">if</span> ( data.windowTitle ) windowTitle = data.windowTitle;
            <span style="color: #00ffff;">if</span> ( data.promptText ) promptText = data.promptText;
            <span style="color: #00ffff;">if</span> ( data.width ) width = data.width;
            <span style="color: #00ffff;">if</span> ( data.height ) height = data.height;
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Required by IPopup interface</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getEvents</span>( ):Array
        {
            <span style="color: #00ffff;">return</span> [ <span style="color: #7fffd4;">PopupActionEvent</span>.OK, <span style="color: #7fffd4;">PopupActionEvent</span>.CANCEL ]
        }

        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">onOk</span>():<span style="color: #98fb98;">void</span>
        {
            dispatchEvent( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">PopupActionEvent</span>( <span style="color: #7fffd4;">PopupActionEvent</span>.OK ) )
        }

        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">onCancel</span>():<span style="color: #98fb98;">void</span>
        {
            dispatchEvent( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">PopupActionEvent</span>( <span style="color: #7fffd4;">PopupActionEvent</span>.CANCEL ) )
        }

        [Bindable] <span style="color: #00ffff;">private</span> var windowTitle:String = <span style="color: #ffa07a;">"Confirmation"</span>;
        [Bindable] <span style="color: #00ffff;">private</span> var promptText:String = <span style="color: #ffa07a;">"Are you sure?"</span>;


    &lt;/fx:Script&gt;

    &lt;!-- LAYOUT --&gt;
    &lt;s:VGroup width=<span style="color: #ffa07a;">"100%"</span> height=<span style="color: #ffa07a;">"100%"</span> gap=<span style="color: #ffa07a;">"20"</span> horizontalAlign=<span style="color: #ffa07a;">"center"</span> verticalAlign=<span style="color: #ffa07a;">"middle"</span>&gt;

        &lt;!-- MESSAGE --&gt;
        &lt;s:Label text=<span style="color: #ffa07a;">"{promptText}"</span>/&gt;

        &lt;!-- BUTTONS --&gt;
        &lt;s:HGroup gap=<span style="color: #ffa07a;">"20"</span>&gt;
            &lt;s:Button label=<span style="color: #ffa07a;">"Cancel"</span> click=<span style="color: #ffa07a;">"onCancel()"</span>/&gt;
            &lt;s:Button label=<span style="color: #ffa07a;">"OK"</span> click=<span style="color: #ffa07a;">"onOk()"</span>/&gt;
        &lt;/s:HGroup&gt;
    &lt;/s:VGroup&gt;

&lt;/s:TitleWindow&gt;

<span style="color: #ff0000;">// </span><span style="color: #ff0000;">AbstractPopupMediator.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.view.popup.<span style="color: #7fffd4;">mediator</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">popup</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">IPopup</span>;
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#30465;&#30053;......</span>

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">AbstractPopupMediator</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Mediator</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">AbstractPopupMediator</span>( name:String )
        {
            <span style="color: #00ffff;">super</span>( name );
        }
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Override in subclass.</span>
<span style="color: #ffa07a;">        * Just create and the concrete popup.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">popupFactory</span>():IPopup
        {
            <span style="color: #00ffff;">return</span> <span style="color: #7fffd4;">null</span>;
        }
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Called from the handleNotification method when a request notification</span>
<span style="color: #ffa07a;">        * is received. Creates the popup with popupFactory(), gives it the data</span>
<span style="color: #ffa07a;">        * from the request, calls setEventInterests to add the listeners, then</span>
<span style="color: #ffa07a;">        * pops up the popup and optionally centers it.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">openPopup</span>( ) : <span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">popup</span>:IPopup = popupFactory();
            <span style="color: #00ffff;">if</span> (popup) {
                popup.setData( request.data );
                setEventInterests( popup );
                PopUpManager.addPopUp( popup,
                request.parent,
                request.modal,
                request.childList );
                <span style="color: #00ffff;">if</span> ( request.center ) PopUpManager.centerPopUp( popup );
            }
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Called from openPopup when the request is set, before</span>
<span style="color: #ffa07a;">        * popping up the popup. Interrogates the popup for the</span>
<span style="color: #ffa07a;">        * events it will dispatch and sets listeners for each.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">setEventInterests</span>( popup:IPopup ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">for</span> each ( <span style="color: #98fb98;">var</span> <span style="color: #87cefa;">interest</span>:String in popup.getEvents() )
            {
                popup.addEventListener( interest,
                handlePopupAction,
                <span style="color: #7fffd4;">false</span>, 0, <span style="color: #7fffd4;">true</span> );
            }
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Subclasses will register a single notification interest,</span>
<span style="color: #ffa07a;">        * which will be handled here in the same way for all subclasses.</span>
<span style="color: #ffa07a;">        */</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handleNotification</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            request = note.getBody() as PopupRequest;
            openPopup( );
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Subclasses will set a single notification interest,</span>
<span style="color: #ffa07a;">        * which will be handled here in the same way for all subclasses.</span>
<span style="color: #ffa07a;">        * The popup will be closed if specified by the event, and then the</span>
<span style="color: #ffa07a;">        * caller will be notified with the PopupEvent and the</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handlePopupAction</span>( event:PopupActionEvent ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">popup</span>:IPopup = event.target as IPopup;
            <span style="color: #00ffff;">if</span> ( event.closePopup ) removePopup( popup );
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">note</span>:Notification = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Notification</span>( event.type, event );
            <span style="color: #00ffff;">if</span> (request.hasCallback) request.notifyObserver( note );
            request = <span style="color: #7fffd4;">null</span>;
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Called if the PopupActionEvent's closePopup property is true</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">removePopup</span>( popup:IPopup ):<span style="color: #98fb98;">void</span>
        {
            PopUpManager.removePopUp( popup );
        }
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">The request is stored temporarily while the popup is alive</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">so that the mediator can notify the caller.</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">request</span>:PopupRequest;
    }
}
<span style="color: #ff0000;">//  </span><span style="color: #ff0000;">ConfirmationPopupMediator.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.view.popup.<span style="color: #7fffd4;">mediator</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">popup</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">ConfirmationPopup</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">popup</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">IPopup</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">popup</span>.<span style="color: #7fffd4;">request</span>.<span style="color: #98fb98;">PopupRequest</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">ConfirmationPopupMediator</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">AbstractPopupMediator</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">"ConfirmationPopupMediator"</span>;

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">ConfirmationPopupMediator</span>()
        {
            <span style="color: #00ffff;">super</span>( NAME );
        }

        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">listNotificationInterests</span>():Array
        {
            <span style="color: #00ffff;">return</span> [ <span style="color: #7fffd4;">PopupRequest</span>.CONFIRMATION_POPUP ];
        }
        override <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">popupFactory</span>():IPopup
        {
            <span style="color: #00ffff;">return</span> <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ConfirmationPopup</span>();
        }
    }
}
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">ManageStoryCommand.as</span>
<span style="color: #00ffff;">package</span> com.futurescale.sa.controller.command.<span style="color: #7fffd4;">story</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">futurescale</span>.<span style="color: #7fffd4;">sa</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">proxy</span>.<span style="color: #98fb98;">StoryProxy</span>;
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#30465;&#30053;......</span>

    <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">    * Add, change or delete a Story.</span>
<span style="color: #ffa07a;">    *</span>
<span style="color: #ffa07a;">    * Popup the StoryPopup, and if the Story is</span>
<span style="color: #ffa07a;">    * added or saved, persist it. If deleted, confirm,</span>
<span style="color: #ffa07a;">    * then delete it.</span>
<span style="color: #ffa07a;">    */</span>
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">ManageStoryCommand</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">SimpleCommand</span>
    {
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">story</span>:StoryVO;
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">storyProxy</span>:StoryProxy;

        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">execute</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">storyStub</span>:StoryVO = StoryVO( note.getBody() ); <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Null if adding</span>
            storyProxy = StoryProxy( facade.retrieveProxy( <span style="color: #7fffd4;">StoryProxy</span>.NAME ) );
            <span style="color: #00ffff;">if</span> ( storyStub ) story = storyProxy.loadStory( storyStub );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Request the popup</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">request</span>:PopupRequest =
            <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">PopupRequest</span>( handleEditPopupNote, <span style="color: #00ffff;">this</span> );
            request.data.story = story;
            sendNotification( <span style="color: #7fffd4;">PopupRequest</span>.STORY_POPUP, request );
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Handle the popup actions.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handleEditPopupNote</span>( actionNote:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">event</span>:PopupActionEvent = PopupActionEvent( actionNote.getBody() );
            story = StoryVO( event.data );
            <span style="color: #00ffff;">switch</span> ( actionNote.getName() )
            {
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">PopupActionEvent</span>.ADD:
                    storyProxy.addStory( story );
                    <span style="color: #00ffff;">break</span>;

                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">PopupActionEvent</span>.SAVE:
                    storyProxy.saveStory( story );
                    <span style="color: #00ffff;">break</span>;

                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">PopupActionEvent</span>.DELETE:
                    <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">confirm</span>:PopupRequest =
                    <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">PopupRequest</span>( handleConfirmPopupNote, <span style="color: #00ffff;">this</span> );
                    confirm.data.promptText = <span style="color: #ffa07a;">"Delete Story?"</span>;
                    sendNotification( <span style="color: #7fffd4;">PopupRequest</span>.CONFIRMATION_POPUP, confirm );
                    <span style="color: #00ffff;">break</span>;

                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">PopupActionEvent</span>.CANCEL:
                    <span style="color: #00ffff;">break</span>;
            }
        }

        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Handle the ConfirmationPopup actions.</span>
<span style="color: #ffa07a;">        */</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handleConfirmPopupNote</span>( actionNote:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">event</span>:PopupActionEvent = PopupActionEvent( actionNote.getBody() );
            <span style="color: #00ffff;">switch</span> ( actionNote.getName() )
            {
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">PopupActionEvent</span>.OK:
                    storyProxy.deleteStory(story);
                    <span style="color: #00ffff;">break</span>;

                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">PopupActionEvent</span>.CANCEL:
                    <span style="color: #00ffff;">break</span>;
            }
        }
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline109" class="outline-4">
<h4 id="orgheadline109"><span class="section-number-4">1.9.2</span> 动态添加视图 Dynamically Adding View Components</h4>
<div class="outline-text-4" id="text-1-9-2">
<p>
下面的代码中实现了动态添加 Player 视图和 Fixture 视图<br>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">GameBoard.mxml</span>
&lt;?xml version=<span style="color: #ffa07a;">"1.0"</span> encoding=<span style="color: #ffa07a;">"utf-8"</span>?&gt;
    &lt;s:Group xmlns:fx=<span style="color: #ffa07a;">"http://ns.adobe.com/mxml/2009"</span>
            xmlns:s=<span style="color: #ffa07a;">"library://ns.adobe.com/flex/spark"</span>
            xmlns:mx=<span style="color: #ffa07a;">"library://ns.adobe.com/flex/mx"</span>&gt;
        &lt;fx:Script&gt;
            &lt;![CDATA[
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Add a Player component to the center of the gameboard</span>
            <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> addPlayerToBoard( player:Player ):<span style="color: #98fb98;">void</span>
            {
                player.x = <span style="color: #00ffff;">this</span>.width/2;
                player.y = <span style="color: #00ffff;">this</span>.height/2;
                addElement( player );
            }

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Add a Fixture component to a random location on the gameboard</span>
            <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">addFixtureToBoard</span>( fixture:Fixture ):<span style="color: #98fb98;">void</span>
            {
                fixture.x = Math.random() * <span style="color: #00ffff;">this</span>.width;
                fixture.y = Math.random() * <span style="color: #00ffff;">this</span>.height;
                addElement( fixture );
            }
        &lt;/fx:Script&gt;
    &lt;/s:Group&gt;

<span style="color: #ff0000;">// </span><span style="color: #ff0000;">GameBoardMediator.as</span>
<span style="color: #00ffff;">package</span> com.me.myapp.view.<span style="color: #7fffd4;">mediator</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">GameBoard</span>;
    <span style="color: #ff0000;">// </span><span style="color: #ff0000;">&#30465;&#30053;......</span>

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">GameBoardMediator</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Mediator</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">'GameBoardMediator'</span>;

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">GameBoardMediator</span>( viewComponent:GameBoard )
        {
            <span style="color: #00ffff;">super</span>( NAME, viewComponent );
        }

        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #98fb98;">get</span> <span style="color: #87cefa;">gameBoard</span>():GameBoard
        {
            <span style="color: #00ffff;">return</span> viewComponent as GameBoard;
        }

        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">listNotificationInterests</span>():Array
        {
            <span style="color: #00ffff;">return</span> [ <span style="color: #7fffd4;">AppConstants</span>.ADD_PLAYER,
            <span style="color: #7fffd4;">AppConstants</span>.ADD_FIXTURE ];
        }

        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handleNotification</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">handle inbound requests to add different components</span>
            <span style="color: #00ffff;">switch</span> (note.getName())
            {
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.ADD_PLAYER:
                    <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">pConfig</span>:PlayerConfigVO = PlayerConfigVO( note.getBody() );
                    addPlayer( pConfig );
                    <span style="color: #00ffff;">break</span>;

                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.ADD_FIXTURE:
                    <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">fConfig</span>:FixtureConfigVO = FixtureConfigVO( note.getBody() );
                    addFixture( fConfig );
                    <span style="color: #00ffff;">break</span>;
            }
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Add a mediated Player component to the Gameboard</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">addPlayer</span>( playerConfig:PlayerConfigVO ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Only add Player if it does not already exist</span>
            <span style="color: #00ffff;">if</span> ( ! facade.hasMediator( <span style="color: #7fffd4;">PlayerMediator</span>.NAME ) ) {
                <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">player</span>:Player = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Player</span>( playerConfig );
                <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">pm</span>:PlayerMediator = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">PlayerMediator</span>( player );
                facade.registerMediator( pm );
                gameBoard.addPlayerToBoard( player );
            }
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Add an unmediated Fixture component to the Gameboard</span>
        <span style="color: #00ffff;">protected</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">addFixture</span>( fixtureConfig:FixtureConfigVO ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">fixture</span>:Fixture = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">Fixture</span>( fixtureConfig );
            gameBoard.addFixtureToBoard( fixture );
        }
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline110" class="outline-4">
<h4 id="orgheadline110"><span class="section-number-4">1.9.3</span> 非长期存在的 ViewComponent 和 Mediator</h4>
<div class="outline-text-4" id="text-1-9-3">
<p>
在 Flex Mobile 中，你需要动态地调节你的视图，这些视图一直都在被创建和销毁。你的 Mediators 应该随着这些 View 的生命周期创建销毁。所以，整个应用程序中，只有 ApplicationMediator 是一个长期存在的 Mediator，其他 Mediator 都是临时存在的。<br>
</p>
<div class="org-src-container">

<pre class="src src-java"><span style="color: #ff0000;">// </span><span style="color: #ff0000;">IMyMobileApp.as</span>
<span style="color: #00ffff;">package</span> com.mycompany.myapp.<span style="color: #7fffd4;">view</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">vo</span>.<span style="color: #98fb98;">InfoVO</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">events</span>.<span style="color: #98fb98;">IEventDispatcher</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">spark</span>.<span style="color: #7fffd4;">components</span>.<span style="color: #98fb98;">View</span>;
    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">interface</span> <span style="color: #98fb98;">IMyMobileApp</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">IEventDispatcher</span>
    {
        <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getActiveView</span>():View;
        <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showLoginView</span>():<span style="color: #98fb98;">void</span>;
        <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showListView</span>():<span style="color: #98fb98;">void</span>;
        <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showInfoView</span>( infoVO:InfoVO ):<span style="color: #98fb98;">void</span>;
        <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showFormView</span>():<span style="color: #98fb98;">void</span>;
    }
}
<span style="color: #ff0000;">// </span><span style="color: #ff0000;">MyMobileApp.xml</span>
&lt;?xml version=<span style="color: #ffa07a;">"1.0"</span> encoding=<span style="color: #ffa07a;">"utf-8"</span>?&gt;
&lt;!-- FLEX MOBILE APPLICATION--&gt;
&lt;s:ViewNavigatorApplication
      firstView=<span style="color: #ffa07a;">"com.mycompany.myapp.view.component.LoginView"</span>
      <span style="color: #00ffff;">implements</span>=<span style="color: #ffa07a;">"com.mycompany.myapp.view.IMyMobileApp"</span>
      applicationComplete=<span style="color: #ffa07a;">"facade.startup(this)"</span>
      xmlns:s=<span style="color: #ffa07a;">"library://ns.adobe.com/flex/spark"</span>
      xmlns:fx=<span style="color: #ffa07a;">"http://ns.adobe.com/mxml/2009"</span>&gt;
    &lt;fx:Script&gt;
        &lt;![CDATA[
        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #98fb98;">ApplicationFacade</span>;
        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">vo</span>.<span style="color: #98fb98;">InfoVO</span>;
        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">InfoView</span>;
        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">ListView</span>;
        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">LoginView</span>;
        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">FormView</span>;

        <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">spark</span>.<span style="color: #7fffd4;">components</span>.<span style="color: #98fb98;">View</span>;
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">RETRIEVE FACADE</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">facade</span>:ApplicationFacade = ApplicationFacade.getInstance();
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">READ ONLY CONTEXT</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #98fb98;">get</span> <span style="color: #87cefa;">context</span>():String
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">if there is no context, then we are on the LoginView,</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">set by firstView (we can't set a context for firstView)</span>
            <span style="color: #00ffff;">return</span> ( navigator.context ) ? String( navigator.context ) : LOGIN;
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">CONTEXT VALUES</span>
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">LOGIN</span>:String = <span style="color: #ffa07a;">"LoginView"</span>;
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">LIST</span>:String = <span style="color: #ffa07a;">"ListView"</span>;
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">FORM</span>:String = <span style="color: #ffa07a;">"FormView"</span>;
        <span style="color: #00ffff;">private</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">INFO</span>:String = <span style="color: #ffa07a;">"InfoView"</span>;
        <span style="color: #ff0000;">//</span><span style="color: #ff0000;">-----------------------------------------------------------</span>
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Below methods satisfy IMyMobileApp interface</span>
        <span style="color: #ff0000;">//</span><span style="color: #ff0000;">-----------------------------------------------------------</span>

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">GET THE ACTIVE VIEW</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getActiveView</span>():View
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Since the LoginView is specified as the 'firstView'</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">we need to mediate it in the traditional way, which means</span>
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">we need to expose the active view</span>
            <span style="color: #00ffff;">return</span> navigator.activeView;
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">SHOW THE LOGIN VIEW</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showLoginView</span>( ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Only return to LoginView if we're not already on it</span>
            <span style="color: #00ffff;">if</span> ( context != LOGIN ) navigator.popToFirstView();
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">SHOW THE LIST VIEW</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showListView</span>( ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Only act if we're not already on the ListView</span>
            <span style="color: #00ffff;">if</span> ( context != LIST )
            {
                <span style="color: #ff0000;">// </span><span style="color: #ff0000;">If returning (from Info or Form views), just pop</span>
                <span style="color: #ff0000;">// </span><span style="color: #ff0000;">otherwise push a new ListView</span>
                <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">returning</span>:Boolean = ( context == INFO || context == FORM );
                <span style="color: #00ffff;">if</span> ( returning ) {
                    navigator.popView();
                } <span style="color: #00ffff;">else</span> {
                    navigator.pushView( ListView, <span style="color: #7fffd4;">null</span>, LIST );
                }
            }
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">SHOW THE FORM VIEW</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showFormView</span>( ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Only push a FormView if we're not already on it</span>
            <span style="color: #00ffff;">if</span> ( context != FORM )
            navigator.pushView( FormView, <span style="color: #7fffd4;">null</span>, FORM );
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">SHOW THE INFO VIEW (PASSING IN INFO VO)</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">showInfoView</span>( infoVO:InfoVO ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Only push an InfoView if we're not already on it</span>
            <span style="color: #00ffff;">if</span> ( context != INFO )
            navigator.pushView( InfoView, infoVO, INFO );
        }
    &lt;/fx:Script&gt;

&lt;/s:ViewNavigatorApplication&gt;

<span style="color: #ff0000;">// </span><span style="color: #ff0000;">ApplicationFacade.as</span>
<span style="color: #00ffff;">package</span> com.mycompany.<span style="color: #7fffd4;">myapp</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">controller</span>.<span style="color: #7fffd4;">command</span>.<span style="color: #98fb98;">StartupCommand</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">controller</span>.<span style="color: #7fffd4;">constants</span>.<span style="color: #98fb98;">AppConstants</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #98fb98;">IMyMobileApp</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">ApplicationFacade</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">getInstance</span>() : ApplicationFacade
        {
            <span style="color: #00ffff;">if</span> ( instance == <span style="color: #7fffd4;">null</span> ) {
                instance = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ApplicationFacade</span>();
            }
            <span style="color: #00ffff;">return</span> ApplicationFacade( instance );
        }

        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">startup</span>( app:IMyMobileApp ):<span style="color: #98fb98;">void</span>
        {
            registerCommand( <span style="color: #7fffd4;">AppConstants</span>.STARTUP, StartupCommand );
            sendNotification( <span style="color: #7fffd4;">ViewerConstants</span>.STARTUP, app );
        }
    }
}

<span style="color: #ff0000;">// </span><span style="color: #ff0000;">StartupCommand.as</span>
<span style="color: #00ffff;">package</span> com.mycompany.myapp.controller.<span style="color: #7fffd4;">command</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">proxy</span>.<span style="color: #98fb98;">InfoProxy</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">proxy</span>.<span style="color: #98fb98;">ThingProxy</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #98fb98;">IMyMobileApp</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">ApplicationMediator</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">INotification</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">command</span>.<span style="color: #98fb98;">SimpleCommand</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">StartupCommand</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">SimpleCommand</span>
    {
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">execute</span>( note : INotification ) : <span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Prepare the Controller</span>
            facade.registerCommand( <span style="color: #7fffd4;">AppConstants</span>.MEDIATE_VIEW, MediateViewCommand );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Prepare the Model</span>
            facade.registerProxy( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ThingProxy</span>( ) );
            facade.registerProxy( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">InfoProxy</span>( ) );
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Prepare the View</span>
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">app</span>:IMyMobileApp = IMobileApp( note.getBody() );
            facade.registerMediator( <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ApplicationMediator</span>( app ) );
        }
    }
}

<span style="color: #ff0000;">//</span><span style="color: #ff0000;">ApplicationMediator.as</span>
<span style="color: #00ffff;">package</span> com.mycompany.myapp.view.<span style="color: #7fffd4;">mediator</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">controller</span>.<span style="color: #7fffd4;">constants</span>.<span style="color: #98fb98;">AppConstants</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #98fb98;">IMyMobileApp</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">model</span>.<span style="color: #7fffd4;">vo</span>.<span style="color: #98fb98;">InfoVO</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">flash</span>.<span style="color: #7fffd4;">events</span>.<span style="color: #98fb98;">Event</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">INotification</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">Mediator</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">spark</span>.<span style="color: #7fffd4;">components</span>.<span style="color: #98fb98;">View</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">ApplicationMediator</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">Mediator</span>
    {
        <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">static</span> <span style="color: #00ffff;">const</span> <span style="color: #98fb98;">NAME</span>:String = <span style="color: #ffa07a;">"ApplicationMediator"</span>;
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">CONSTRUCTOR - HANDLE COMPONENT BY ITS INTERFACE</span>
        <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">ApplicationMediator</span>( app:IMyMobileApp )
        {
            <span style="color: #00ffff;">super</span>( NAME, app );
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">CALLED AT REGISTRATION - LIST NOTIFICATION INTERESTS</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">listNotificationInterests</span>():Array
        {
            <span style="color: #00ffff;">return</span> [ <span style="color: #7fffd4;">AppConstants</span>.SHOW_LOGIN,
            <span style="color: #7fffd4;">AppConstants</span>.SHOW_LIST,
            <span style="color: #7fffd4;">AppConstants</span>.SHOW_FORM,
            <span style="color: #7fffd4;">AppConstants</span>.SHOW_INFO,
            ];
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">CALLED AT REGISTRATION - LISTEN FOR EVENTS, MEDIATE FIRST VIEW</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">onRegister</span>():<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Listen for Views to be created</span>
            app.addEventListener( <span style="color: #7fffd4;">Event</span>.ADDED, handleAdded );

            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Mediate the firstView</span>
            sendNotification( <span style="color: #7fffd4;">AppConstants</span>.MEDIATE_VIEW, app.getActiveView() );
        }
        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">HANDLE NOTIFICATIONS TO CHANGE VIEWS</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handleNotification</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #00ffff;">switch</span> ( note.getName() )
            {
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.SHOW_LOGIN:
                    app.showLoginView();
                    <span style="color: #00ffff;">break</span>;
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.SHOW_LIST:
                    app.showListView();
                    <span style="color: #00ffff;">break</span>;
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.SHOW_FORM:
                    app.showFormView();
                    <span style="color: #00ffff;">break</span>;
                <span style="color: #00ffff;">case</span> <span style="color: #7fffd4;">AppConstants</span>.SHOW_INFO:
                    app.showInfoView( InfoVO( note.getBody() ) );
                    <span style="color: #00ffff;">break</span>;
            }
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">HANDLE ADDED EVENTS</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">handleAdded</span>( event:Event ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #ff0000;">// </span><span style="color: #ff0000;">Only act on Views</span>
            <span style="color: #00ffff;">if</span> ( event.target <span style="color: #98fb98;">is</span> <span style="color: #eedd82;">View</span> ) {
                sendNotification( <span style="color: #7fffd4;">AppConstants</span>.MEDIATE_VIEW, event.target );
            }
        }

        <span style="color: #ff0000;">// </span><span style="color: #ff0000;">CAST THE VIEW COMPONENT TO THE PROPER TYPE</span>
        <span style="color: #00ffff;">private</span> <span style="color: #98fb98;">function</span> <span style="color: #98fb98;">get</span> <span style="color: #87cefa;">app</span>():IMyMobileApp
        {
            <span style="color: #00ffff;">return</span> viewComponent as IMyMobileApp;
        }
    }
}

<span style="color: #ff0000;">// </span><span style="color: #ff0000;">MediateViewCommand.as</span>
<span style="color: #00ffff;">package</span> com.mycompany.myapp.controller.<span style="color: #7fffd4;">command</span>
{
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">InfoView</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">ListView</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">LoginView</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">component</span>.<span style="color: #98fb98;">FormView</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">InfoViewMediator</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">ListViewMediator</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">LoginViewMediator</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">com</span>.<span style="color: #7fffd4;">mycompany</span>.<span style="color: #7fffd4;">myapp</span>.<span style="color: #7fffd4;">view</span>.<span style="color: #7fffd4;">mediator</span>.<span style="color: #98fb98;">FormViewMediator</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">INotification</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">interfaces</span>.<span style="color: #98fb98;">IMediator</span>;
    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">org</span>.<span style="color: #7fffd4;">puremvc</span>.<span style="color: #7fffd4;">as3</span>.<span style="color: #7fffd4;">patterns</span>.<span style="color: #7fffd4;">command</span>.<span style="color: #98fb98;">SimpleCommand</span>;

    <span style="color: #00ffff;">import</span> <span style="color: #7fffd4;">spark</span>.<span style="color: #7fffd4;">components</span>.<span style="color: #98fb98;">View</span>;

    <span style="color: #00ffff;">public</span> <span style="color: #00ffff;">class</span> <span style="color: #98fb98;">MediateViewCommand</span> <span style="color: #00ffff;">extends</span> <span style="color: #98fb98;">SimpleCommand</span>
    {
        <span style="color: #ffa07a;">/**</span>
<span style="color: #ffa07a;">        * Each View is destroyed once it is moved away from,</span>
<span style="color: #ffa07a;">        * thus Mediators must also be transient. Any existing</span>
<span style="color: #ffa07a;">        * Mediator is removed, and a new one registered</span>
<span style="color: #ffa07a;">        * along with the new View. Any additional Mediators</span>
<span style="color: #ffa07a;">        * associated with the children of these Views should be</span>
<span style="color: #ffa07a;">        * registered and removed in the onRegister() and onRemove()</span>
<span style="color: #ffa07a;">        * methods of the View's Mediator.</span>
<span style="color: #ffa07a;">        */</span>
        override <span style="color: #00ffff;">public</span> <span style="color: #98fb98;">function</span> <span style="color: #87cefa;">execute</span>( note:INotification ):<span style="color: #98fb98;">void</span>
        {
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">view</span>:View = View( note.getBody() );
            <span style="color: #98fb98;">var</span> <span style="color: #eedd82;">mediator</span>:IMediator;
            <span style="color: #00ffff;">switch</span> ( view.className )
            {
                <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"LoginView"</span>:
                    facade.removeMediator( <span style="color: #7fffd4;">LoginViewMediator</span>.NAME );
                    mediator = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">LoginViewMediator</span>( view <span style="color: #98fb98;">as</span> <span style="color: #eedd82;">LoginView</span> );
                    <span style="color: #00ffff;">break</span>;
                <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"ListView"</span>:
                    facade.removeMediator( <span style="color: #7fffd4;">ListViewMediator</span>.NAME );
                    mediator = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">ListViewMediator</span>( view <span style="color: #98fb98;">as</span> <span style="color: #eedd82;">ListView</span> );
                    <span style="color: #00ffff;">break</span>;
                <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"InfoView"</span>:
                    facade.removeMediator( <span style="color: #7fffd4;">InfoViewMediator</span>.NAME );
                    mediator = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">InfoViewMediator</span>( view <span style="color: #98fb98;">as</span> <span style="color: #eedd82;">InfoView</span> );
                    <span style="color: #00ffff;">break</span>;
                <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"FormView"</span>:
                    facade.removeMediator( <span style="color: #7fffd4;">FormViewMediator</span>.NAME );
                    mediator = <span style="color: #00ffff;">new</span> <span style="color: #98fb98;">FormViewMediator</span>( view <span style="color: #98fb98;">as</span> <span style="color: #eedd82;">FormView</span> );
                    <span style="color: #00ffff;">break</span>;
            }
            <span style="color: #00ffff;">if</span> (mediator) facade.registerMediator( mediator );
        }
    }
}

<span style="color: #ff0000;">//</span><span style="color: #ff0000;">ListView.xml</span>
&lt;?xml version=<span style="color: #ffa07a;">"1.0"</span> encoding=<span style="color: #ffa07a;">"utf-8"</span>?&gt;
    &lt;!-- LIST VIEW --&gt;
    &lt;s:View xmlns:s=<span style="color: #ffa07a;">"library://ns.adobe.com/flex/spark"</span>
            xmlns:fx=<span style="color: #ffa07a;">"http://ns.adobe.com/mxml/2009"</span>
            destructionPolicy=<span style="color: #ffa07a;">"never"</span>&gt;

    &lt;!-- LIST STUFF HAPPENS HERE --&gt;

    &lt;/s:View&gt;
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline117" class="outline-2">
<h2 id="orgheadline117"><span class="section-number-2">2</span> FAQ</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline113" class="outline-4">
<h4 id="orgheadline113"><span class="section-number-4">2.0.1</span> PureMVC 中个元素的创建顺序是什么？为什么要遵守 PureMVC 特定的元素创建顺序？</h4>
<div class="outline-text-4" id="text-2-0-1">
<p>
<a href="#orgtarget1">按照从外到内的顺序进行创建</a><br>
</p>
</div>
</div>
<div id="outline-container-orgheadline114" class="outline-4">
<h4 id="orgheadline114"><span class="section-number-4">2.0.2</span> 在该书中 SelectContext 属于 PureMVC 中的什么角色？</h4>
<div class="outline-text-4" id="text-2-0-2">
<p>
SelectContext 不属于 PureMVC 的任何角色，它属于一个 ValueObject 类，SelectContext 的对象会被存储在一个 Proxy 中。<br>
<a href="#orgtarget3">SelectionContext</a><br>
</p>
</div>
</div>
<div id="outline-container-orgheadline115" class="outline-4">
<h4 id="orgheadline115"><span class="section-number-4">2.0.3</span> 为什么要尽量减少使用单例模式？</h4>
<div class="outline-text-4" id="text-2-0-3">
<p>
<a href="#orgtarget5">单例是魔鬼</a><br>
</p>
</div>
</div>
<div id="outline-container-orgheadline116" class="outline-4">
<h4 id="orgheadline116"><span class="section-number-4">2.0.4</span> PureMVC 如何处理弹框相关的逻辑？</h4>
<div class="outline-text-4" id="text-2-0-4">
<p>
<a href="#orgtarget4">处理弹出框的各种方式</a><br>
</p>
</div>
</div>
</div>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/">Action Script Developer Guide To PureMVC</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">wolfand11</a></p>
        <p><span>发布时间:</span>2017-02-13, 00:00:00</p>
        <p><span>最后更新:</span>2017-04-02, 20:45:46</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/" title="Action Script Developer Guide To PureMVC">http://wolfand11.coding.me/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/</a>
            <span class="copy-path" data-clipboard-text="原文: http://wolfand11.coding.me/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/　　作者: wolfand11" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2017/02/26/unity/UnityHotUpdate/">
                    Unity Hot Update
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2017/01/06/gameplay/MoveSync/">
                    Move Sync
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#orgheadline112"><span class="toc-number">1.</span> <span class="toc-text">1 Action Script Developer Guide To PureMVC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline1"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline27"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 使用 PureMVC 创建一个程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline2"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 选择平台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline7"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 写小说和编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline13"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 StoryArchitect 一个写小说的工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline20"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 搭建启动框架 （Erecting the Startup Scaffolding）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline26"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 按照从外到内的顺序进行创建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline48"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 为领域建模</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline43"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1 Designing the Schema</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline44"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2 Creating the Value Objects</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline46"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3 Creating the Enums</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline47"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.3.4 Testing the Entities</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline65"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 实现用户界面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline53"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1 Application</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline54"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2 Other View Components</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline59"><span class="toc-number">1.4.3.</span> <span class="toc-text">1.4.3 The Selection Context</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline64"><span class="toc-number">1.4.4.</span> <span class="toc-text">1.4.4 The App Event</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline75"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 为模型实现 Proxys</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline66"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.5.1 Proxy Life Cycle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline67"><span class="toc-number">1.5.2.</span> <span class="toc-text">1.5.2 重新考察持久化策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline74"><span class="toc-number">1.5.3.</span> <span class="toc-text">1.5.3 创建 Proxys</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline88"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 为视图实现 Mediators</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline76"><span class="toc-number">1.6.1.</span> <span class="toc-text">1.6.1 Mediator Life Cycle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline78"><span class="toc-number">1.6.2.</span> <span class="toc-text">1.6.2 和 ViewComponent 的交互</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline79"><span class="toc-number">1.6.3.</span> <span class="toc-text">1.6.3 和应用程序的交互</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline80"><span class="toc-number">1.6.4.</span> <span class="toc-text">1.6.4 确定调解的粒度 (Determing Granularity of Mediation)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline87"><span class="toc-number">1.6.5.</span> <span class="toc-text">1.6.5 创建 Mediators</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline102"><span class="toc-number">1.7.</span> <span class="toc-text">1.7 在 Commands 中实现业务逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline92"><span class="toc-number">1.7.1.</span> <span class="toc-text">1.7.1 两种逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline93"><span class="toc-number">1.7.2.</span> <span class="toc-text">1.7.2 Command Life Cycle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline100"><span class="toc-number">1.7.3.</span> <span class="toc-text">1.7.3 创建 Commands</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline101"><span class="toc-number">1.7.4.</span> <span class="toc-text">1.7.4 注册 Commands</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline107"><span class="toc-number">1.8.</span> <span class="toc-text">1.8 关于 Model 的高级主题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline105"><span class="toc-number">1.8.1.</span> <span class="toc-text">1.8.1 处理异步行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline106"><span class="toc-number">1.8.2.</span> <span class="toc-text">1.8.2 复用 Model 层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orgheadline111"><span class="toc-number">1.9.</span> <span class="toc-text">1.9 关于 View 的高级主题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline108"><span class="toc-number">1.9.1.</span> <span class="toc-text">1.9.1 Managing Pop Ups</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline109"><span class="toc-number">1.9.2.</span> <span class="toc-text">1.9.2 动态添加视图 Dynamically Adding View Components</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline110"><span class="toc-number">1.9.3.</span> <span class="toc-text">1.9.3 非长期存在的 ViewComponent 和 Mediator</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#orgheadline117"><span class="toc-number">2.</span> <span class="toc-text">2 FAQ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline113"><span class="toc-number">2.0.1.</span> <span class="toc-text">2.0.1 PureMVC 中个元素的创建顺序是什么？为什么要遵守 PureMVC 特定的元素创建顺序？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline114"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.0.2 在该书中 SelectContext 属于 PureMVC 中的什么角色？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline115"><span class="toc-number">2.0.3.</span> <span class="toc-text">2.0.3 为什么要尽量减少使用单例模式？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#orgheadline116"><span class="toc-number">2.0.4.</span> <span class="toc-text">2.0.4 PureMVC 如何处理弹框相关的逻辑？</span></a></li></ol></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Action Script Developer Guide To PureMVC　| wolfand11's blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://wolfand11.coding.me/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/';
            this.page.identifier = '2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//wolfand11.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2017/02/26/unity/UnityHotUpdate/" title="上一篇: Unity Hot Update">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2017/01/06/gameplay/MoveSync/" title="下一篇: Move Sync">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/architecture/Cryptology/">Cryptology</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/04/architecture/GameEngineArchitecture/">Game Engine Architecture</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/29/tools/ArtTools/">ArtTools</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/language/Python/">Python Note</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/18/algorithm/DynamicProgramming/">Dynamic Programming</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/16/gameplay/GameAI/">GameAI</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/01/unity/DOTween/">DOTween</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/tools/Matlab/">Matlab</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/08/architecture/KSFrameworkNote/">KSFramework Note</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/26/unity/UnityHotUpdate/">Unity Hot Update</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/13/architecture/ActionScriptDeveloperGuideToPureMVC/">Action Script Developer Guide To PureMVC</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/06/gameplay/MoveSync/">Move Sync</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/01/unity/UnityGUI/">Unity GUI</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/23/unity/UnityDoc-AnimationFromExternalSources/">Animation From External Sources</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/22/unity/UnityDoc-AnimationClips/">Animation Clips</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/12/unity/UnityDoc-AnimationSystemOverview/">Animation System Overview</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/09/language/Lua/">Programming in Lua</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/28/unity/UnityNote/">Unity Note</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/29/tools/vim/">VIM</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/28/tools/GameDevTools/">Game Dev Tools</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/27/language/CSharp/">Programing in CSharp</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/24/unity/UnityDoc-SpecialFolders/">Special Folders</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/tools/InitMyCore/">Init My Core</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/24/unity/UnityDoc-LoadingResourcesatRuntime/">Loading Resources at Runtime</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/20/unity/Unity5LightingCookbook/">Unity 5 Lighting Cookbook</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/20/unity/UnityShaderAndEffectCookbook/">UnityShaderAndEffectCookbook</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/14/language/Shell/">Shell</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/14/language/Elisp/">Programing in Elisp</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/14/tools/GitAndGithub/">Git Github</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/14/tools/InitPC/">Init My PC</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/14/tools/Emacs/">Emacs</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/12/tools/CreateBlogWithHexo/">Create Blog With Hexo</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/12/tools/CreateBlogWithJeykll/">Create Blog With Jeykll</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/16/architecture/GameModules/">GameModules</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/01/algorithm/AlgorithmIntroduce/">AlgorithmIntroduce</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2017 wolfand11
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>