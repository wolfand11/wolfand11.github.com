<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-02-02 Thu 11:08 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>URP</title>
<meta name="generator" content="Org Mode" />
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
         <meta name="viewport" content="width=device-width, initial-scale=1" />
         <link rel="stylesheet" title="Standard" href="https://wolfand11.github.io/res/worg_theme/css/worg.css" type="text/css" />
         <link rel="alternate stylesheet" title="Zenburn" href="https://wolfand11.github.io/res/worg_theme/css/worg-zenburn.css" type="text/css" />
         <link rel="alternate stylesheet" title="Classic" href="https://wolfand11.github.io/res/worg_theme/css/worg-classic.css" type="text/css" />
         <link rel="icon" href="https://wolfand11.github.io/res/favicon.ico" type="image/ico" />
         <script type="text/javascript" src="https://wolfand11.github.io/res/blog-tools.js"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="https://wolfand11.github.io"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">URP</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org63750a8">URP</a>
<ul>
<li><a href="#orgabad919">Base</a>
<ul>
<li><a href="#org4892320">源码分析</a></li>
<li><a href="#org6edb5d9">Native RenderPass</a></li>
<li><a href="#org7affa24">URPAsset</a>
<ul>
<li><a href="#org580099d">Runtime 修改 URPAsset 设置</a></li>
</ul>
</li>
<li><a href="#orga262710">RenderFeature</a>
<ul>
<li><a href="#org34de12b">Disable/Enable RenderFeature Runtime</a></li>
<li><a href="#org60e1b8e">Custom RenderFeature</a>
<ul>
<li><a href="#org3317c20">template</a></li>
<li><a href="#org658443f">kawase blur</a></li>
<li><a href="#org3e88b31">len flares</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4673f29">Shader</a>
<ul>
<li><a href="#org52352b2">MultiPass</a></li>
<li><a href="#org568fb32">Lightmap 烘培</a></li>
</ul>
</li>
<li><a href="#orge895121">Misc</a>
<ul>
<li><a href="#orgee9466b">Upgrade Buildin Shader To URP</a>
<ul>
<li><a href="#orgf019368">Point Light Effect Error</a></li>
<li><a href="#org536a028">Common</a></li>
</ul>
</li>
<li><a href="#org9fa4f00">Unity Buildin 和 URP 支持的 Feature 对比</a></li>
<li><a href="#org7f6ba79">创建一个 Lit Shader Graph 默认文件，生成的 shader 代码</a></li>
<li><a href="#orgb839c9e">URP Buildin GI 比较</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf32f3b1">HDRP</a>
<ul>
<li><a href="#org71117d7">Setup</a></li>
</ul>
</li>
<li><a href="#orge61499c">ERROR</a>
<ul>
<li>
<ul>
<li><a href="#org73e3a05">Material 'Liquid' with Shader 'Custom/MyEffect/Unlit/Liquid' doesn't have a texture property '_MainTex' UnityEngine.GUIUtility:ProcessEvent (int,intptr,bool&amp;)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1be03d7">参考资料</a></li>
</ul>
</div>
</div>
<p>
URP note.<br />
</p>
<div class="HTML" id="org3e848cb">
<p>
&lt;!&#x2013; more &#x2013;&gt;<br />
</p>

</div>

<div id="outline-container-org63750a8" class="outline-2">
<h2 id="org63750a8">URP</h2>
<div class="outline-text-2" id="text-org63750a8">
</div>
<div id="outline-container-orgabad919" class="outline-3">
<h3 id="orgabad919">Base</h3>
<div class="outline-text-3" id="text-orgabad919">
</div>
<div id="outline-container-org4892320" class="outline-4">
<h4 id="org4892320">源码分析</h4>
<div class="outline-text-4" id="text-org4892320">
<p>
<a href="./URP/Unity URP.xmind">./URP/Unity URP.xmind</a><br />
</p>

<p>
URP 12.1.6 版本中 ForwardRenderer 变为了 UniversalRenderer<br />
</p>

<ul class="org-ul">
<li>Unity URP 简要剖析 <a href="https://zhuanlan.zhihu.com/p/399297398">https://zhuanlan.zhihu.com/p/399297398</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org6edb5d9" class="outline-4">
<h4 id="org6edb5d9">Native RenderPass</h4>
<div class="outline-text-4" id="text-org6edb5d9">
<ul class="org-ul">
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@13.1/manual/urp-universal-renderer.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@13.1/manual/urp-universal-renderer.html</a><br /></li>
<li><a href="https://forum.unity.com/threads/what-is-the-issue-with-native-renderpass-and-xr.1141285/">https://forum.unity.com/threads/what-is-the-issue-with-native-renderpass-and-xr.1141285/</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org7affa24" class="outline-4">
<h4 id="org7affa24">URPAsset</h4>
<div class="outline-text-4" id="text-org7affa24">
</div>
<div id="outline-container-org580099d" class="outline-5">
<h5 id="org580099d">Runtime 修改 URPAsset 设置</h5>
<div class="outline-text-5" id="text-org580099d">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">System</span>.<span style="color: #7590db;">Collections</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">System</span>.<span style="color: #7590db;">Collections</span>.<span style="color: #7590db;">Generic</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">System</span>.<span style="color: #7590db;">Reflection</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>.<span style="color: #7590db;">Rendering</span>.<span style="color: #7590db;">Universal</span>;

<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">UniversalRenderPipelineAssetExtensions</span>
{
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">ScriptableRendererFeature</span> <span style="color: #bc6ec5; font-weight: bold;">GetRenderFeature</span>&lt;<span style="color: #ce537a; font-weight: bold;">T</span>&gt;(<span style="color: #4f97d7; font-weight: bold;">this</span> <span style="color: #ce537a; font-weight: bold;">UniversalRenderPipelineAsset</span> <span style="color: #7590db;">asset</span>, <span style="color: #ce537a; font-weight: bold;">string</span> <span style="color: #7590db;">name</span>) <span style="color: #4f97d7; font-weight: bold;">where</span> T : ScriptableRendererFeature
    {
        <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">type</span> = asset.<span style="color: #bc6ec5; font-weight: bold;">GetType</span>();
        <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">propertyInfo</span> = type.<span style="color: #bc6ec5; font-weight: bold;">GetField</span>(<span style="color: #2d9574;">"m_RendererDataList"</span>, BindingFlags.Instance | BindingFlags.NonPublic);

        <span style="color: #4f97d7; font-weight: bold;">if</span> (propertyInfo == <span style="color: #a45bad;">null</span>)
        {
            <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
        }

        <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">scriptableRenderData</span> = (<span style="color: #ce537a; font-weight: bold;">ScriptableRendererData</span>[])propertyInfo.<span style="color: #bc6ec5; font-weight: bold;">GetValue</span>(<span style="color: #ce537a; font-weight: bold;">asset</span>);

        <span style="color: #4f97d7; font-weight: bold;">if</span> (scriptableRenderData != <span style="color: #a45bad;">null</span> &amp;&amp; scriptableRenderData.Length &gt; 0)
        {
            <span style="color: #4f97d7; font-weight: bold;">foreach</span> (<span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">renderData</span> <span style="color: #4f97d7; font-weight: bold;">in</span> scriptableRenderData)
            {
                <span style="color: #4f97d7; font-weight: bold;">foreach</span> (<span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">rendererFeature</span> <span style="color: #4f97d7; font-weight: bold;">in</span> renderData.rendererFeatures)
                {
                    <span style="color: #4f97d7; font-weight: bold;">if</span> (rendererFeature <span style="color: #4f97d7; font-weight: bold;">is</span> T &amp;&amp; rendererFeature.name == name)
                    {
                        <span style="color: #4f97d7; font-weight: bold;">return</span> rendererFeature;
                    }
                }
            }
        }

        <span style="color: #4f97d7; font-weight: bold;">return</span> <span style="color: #a45bad;">null</span>;
    }

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">static</span> <span style="color: #ce537a; font-weight: bold;">ScriptableRendererFeature</span> <span style="color: #bc6ec5; font-weight: bold;">SetRenderFeatureEnable</span>&lt;<span style="color: #ce537a; font-weight: bold;">T</span>&gt;(<span style="color: #4f97d7; font-weight: bold;">this</span> <span style="color: #ce537a; font-weight: bold;">UniversalRenderPipelineAsset</span> <span style="color: #7590db;">asset</span>, <span style="color: #ce537a; font-weight: bold;">string</span> <span style="color: #7590db;">name</span>, <span style="color: #ce537a; font-weight: bold;">bool</span> <span style="color: #7590db;">enable</span>) <span style="color: #4f97d7; font-weight: bold;">where</span> T : ScriptableRendererFeature
    {
        <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">feature</span> = <span style="color: #bc6ec5; font-weight: bold;">GetRenderFeature</span>&lt;<span style="color: #ce537a; font-weight: bold;">T</span>&gt;(<span style="color: #ce537a; font-weight: bold;">asset</span>, <span style="color: #ce537a; font-weight: bold;">name</span>);
        <span style="color: #4f97d7; font-weight: bold;">if</span> (feature)
            feature.<span style="color: #bc6ec5; font-weight: bold;">SetActive</span>(<span style="color: #ce537a; font-weight: bold;">enable</span>);

        <span style="color: #4f97d7; font-weight: bold;">return</span> feature;
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">EnableFeature</span>(<span style="color: #ce537a; font-weight: bold;">FeatureTag</span> <span style="color: #7590db;">featureTag</span>, <span style="color: #ce537a; font-weight: bold;">bool</span> <span style="color: #7590db;">isEnable</span>)
{
    <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">asset</span> =  GraphicsSettings.currentRenderPipeline <span style="color: #4f97d7; font-weight: bold;">as</span> UniversalRenderPipelineAsset;
    <span style="color: #4f97d7; font-weight: bold;">switch</span>(featureTag)
    {
    <span style="color: #4f97d7; font-weight: bold;">case</span> FeatureTag.kColorRT:
        asset.supportsCameraOpaqueTexture = isEnable;
        <span style="color: #4f97d7; font-weight: bold;">break</span>;
    <span style="color: #4f97d7; font-weight: bold;">case</span> FeatureTag.kDepthRT:
        asset.supportsCameraDepthTexture = isEnable;
        <span style="color: #4f97d7; font-weight: bold;">break</span>;
    <span style="color: #4f97d7; font-weight: bold;">case</span> FeatureTag.kUpdateDepthRT:
        asset.<span style="color: #bc6ec5; font-weight: bold;">SetRenderFeatureEnable</span>&lt;<span style="color: #ce537a; font-weight: bold;">CopyDepth</span>&gt;(<span style="color: #2d9574;">"UpdateDepth"</span>, isEnable);
        <span style="color: #4f97d7; font-weight: bold;">break</span>;
    <span style="color: #4f97d7; font-weight: bold;">case</span> FeatureTag.kPlaneReflectionRT:
        <span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">TODO</span>
        <span style="color: #4f97d7; font-weight: bold;">break</span>;
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga262710" class="outline-4">
<h4 id="orga262710">RenderFeature</h4>
<div class="outline-text-4" id="text-orga262710">
</div>
<div id="outline-container-org34de12b" class="outline-5">
<h5 id="org34de12b">Disable/Enable RenderFeature Runtime</h5>
<div class="outline-text-5" id="text-org34de12b">
<div class="org-src-container">
<pre class="src src-csharp">screenShotRendererFeature.<span style="color: #bc6ec5; font-weight: bold;">SetActive</span>(<span style="color: #ce537a; font-weight: bold;">enableSSRF</span>);
</pre>
</div>

<ul class="org-ul">
<li><a href="https://forum.unity.com/threads/enable-or-disable-render-features-at-runtime.932571/">https://forum.unity.com/threads/enable-or-disable-render-features-at-runtime.932571/</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org60e1b8e" class="outline-5">
<h5 id="org60e1b8e">Custom RenderFeature</h5>
<div class="outline-text-5" id="text-org60e1b8e">
</div>
<div id="outline-container-org3317c20" class="outline-6">
<h6 id="org3317c20">template</h6>
<div class="outline-text-6" id="text-org3317c20">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>.<span style="color: #7590db;">Rendering</span>;
<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">old version namespace</span>
<span style="color: #2aa1ae; background-color: #292e34;">//</span><span style="color: #2aa1ae; background-color: #292e34;">using UnityEngine.Rendering.LWRP;</span>
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>.<span style="color: #7590db;">Rendering</span>.<span style="color: #7590db;">Universal</span>;

<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">CustomRenderPassFeature</span> : <span style="color: #ce537a; font-weight: bold;">ScriptableRendererFeature</span>
{
    <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">CustomRenderPass</span> : <span style="color: #ce537a; font-weight: bold;">ScriptableRenderPass</span>
    {

        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Mesh</span> <span style="color: #7590db;">Mesh</span>;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Material</span> <span style="color: #7590db;">Material</span>;

        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">This method is called by the renderer before rendering a camera</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Override this method if you need to to configure render targets and their clear state, and to create temporary render target textures.</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">If a render pass doesn't override this method, this render pass renders to the active Camera's render target.</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">You should never call CommandBuffer.SetRenderTarget. Instead call &lt;c&gt;ConfigureTarget&lt;/c&gt; and &lt;c&gt;ConfigureClear&lt;/c&gt;.</span>
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">OnCameraSetup</span>(<span style="color: #ce537a; font-weight: bold;">CommandBuffer</span> <span style="color: #7590db;">cmd</span>, <span style="color: #4f97d7; font-weight: bold;">ref</span> <span style="color: #ce537a; font-weight: bold;">RenderingData</span> <span style="color: #7590db;">renderingData</span>)
        {

        }

        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">This method is called before executing the render pass.</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">It can be used to configure render targets and their clear state. Also to create temporary render target textures.</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">When empty this render pass will render to the active camera render target.</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">You should never call CommandBuffer.SetRenderTarget. Instead call &lt;c&gt;ConfigureTarget&lt;/c&gt; and &lt;c&gt;ConfigureClear&lt;/c&gt;.</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">The render pipeline will ensure target setup and clearing happens in an performance manner.</span>
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">Configure</span>(<span style="color: #ce537a; font-weight: bold;">CommandBuffer</span> <span style="color: #7590db;">cmd</span>, <span style="color: #ce537a; font-weight: bold;">RenderTextureDescriptor</span> <span style="color: #7590db;">cameraTextureDescriptor</span>)
        {
        }

        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Here you can implement the rendering logic.</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Use &lt;c&gt;ScriptableRenderContext&lt;/c&gt; to issue drawing commands or execute command buffers</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">https://docs.unity3d.com/ScriptReference/Rendering.ScriptableRenderContext.html</span>
        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">You don't have to call ScriptableRenderContext.submit, the render pipeline will call it at specific points in the pipeline.</span>
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">Execute</span>(<span style="color: #ce537a; font-weight: bold;">ScriptableRenderContext</span> <span style="color: #7590db;">context</span>, <span style="color: #4f97d7; font-weight: bold;">ref</span> <span style="color: #ce537a; font-weight: bold;">RenderingData</span> <span style="color: #7590db;">renderingData</span>)
        {
            <span style="color: #ce537a; font-weight: bold;">CommandBuffer</span> <span style="color: #7590db;">cmd</span> = CommandBufferPool.<span style="color: #bc6ec5; font-weight: bold;">Get</span>();
            cmd.<span style="color: #bc6ec5; font-weight: bold;">DrawMeshInstanced</span>(Mesh, 0, Material, 0, <span style="color: #4f97d7; font-weight: bold;">new</span>[] { Matrix4x4.<span style="color: #bc6ec5; font-weight: bold;">TRS</span>(Vector3.zero, Quaternion.identity, Vector3.one) });

            context.<span style="color: #bc6ec5; font-weight: bold;">ExecuteCommandBuffer</span>(cmd);
            CommandBufferPool.<span style="color: #bc6ec5; font-weight: bold;">Release</span>(cmd);
        }

        <span style="color: #9f8766;">/// Cleanup any allocated resources that were created during the execution of this render pass.</span>
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">FrameCleanup</span>(<span style="color: #ce537a; font-weight: bold;">CommandBuffer</span> <span style="color: #7590db;">cmd</span>)
        {
        }
    }

    <span style="color: #ce537a; font-weight: bold;">CustomRenderPass</span> <span style="color: #7590db;">m_ScriptablePass</span>;

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">Create</span>()
    {
        Debug.<span style="color: #bc6ec5; font-weight: bold;">Log</span>(<span style="color: #2d9574;">"Create"</span>);

        m_ScriptablePass = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">CustomRenderPass</span>();
        m_ScriptablePass.Mesh = Resources.<span style="color: #bc6ec5; font-weight: bold;">Load</span>&lt;<span style="color: #ce537a; font-weight: bold;">Mesh</span>&gt;(<span style="color: #2d9574;">"Cube123"</span>);
        m_ScriptablePass.Material = Resources.<span style="color: #bc6ec5; font-weight: bold;">Load</span>&lt;<span style="color: #ce537a; font-weight: bold;">Material</span>&gt;(<span style="color: #2d9574;">"TestMaterial123"</span>);

        <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Configures where the render pass should be injected.</span>
        m_ScriptablePass.renderPassEvent = RenderPassEvent.BeforeRenderingOpaques;
    }

    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">Here you can inject one or multiple render passes in the renderer.</span>
    <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">This method is called when setting up the renderer once per-camera.</span>
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">AddRenderPasses</span>(<span style="color: #ce537a; font-weight: bold;">ScriptableRenderer</span> <span style="color: #7590db;">renderer</span>, <span style="color: #4f97d7; font-weight: bold;">ref</span> <span style="color: #ce537a; font-weight: bold;">RenderingData</span> <span style="color: #7590db;">renderingData</span>)
    {
        renderer.<span style="color: #bc6ec5; font-weight: bold;">EnqueuePass</span>(m_ScriptablePass);
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org658443f" class="outline-6">
<h6 id="org658443f">kawase blur</h6>
<div class="outline-text-6" id="text-org658443f">
<ul class="org-ul">
<li><a href="https://github.com/sebastianhein/urp_kawase_blur/">https://github.com/sebastianhein/urp_kawase_blur/</a><br /></li>
</ul>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">System</span>.<span style="color: #7590db;">Collections</span>.<span style="color: #7590db;">Generic</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>.<span style="color: #7590db;">Rendering</span>;
<span style="color: #4f97d7; font-weight: bold;">using</span> <span style="color: #7590db;">UnityEngine</span>.<span style="color: #7590db;">Rendering</span>.<span style="color: #7590db;">Universal</span>;

<span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">KawaseBlur</span> : <span style="color: #ce537a; font-weight: bold;">ScriptableRendererFeature</span>
{
    [System.Serializable]
    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">class</span> KawaseBlurSettings
    {
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">RenderPassEvent</span> <span style="color: #7590db;">renderPassEvent</span> = RenderPassEvent.AfterRenderingTransparents;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Material</span> <span style="color: #7590db;">blurMaterial</span> = <span style="color: #a45bad;">null</span>;

        [<span style="color: #bc6ec5; font-weight: bold;">Range</span>(2,15)]
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">int</span> blurPasses = 1;

        [<span style="color: #bc6ec5; font-weight: bold;">Range</span>(1,4)]
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">int</span> downsample = 1;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">bool</span> <span style="color: #7590db;">copyToFramebuffer</span>;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">string</span> <span style="color: #7590db;">targetName</span> = <span style="color: #2d9574;">"_blurTexture"</span>;
    }

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">KawaseBlurSettings</span> <span style="color: #7590db;">settings</span> = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">KawaseBlurSettings</span>();

    <span style="color: #4f97d7; font-weight: bold;">class</span> <span style="color: #ce537a; font-weight: bold;">CustomRenderPass</span> : <span style="color: #ce537a; font-weight: bold;">ScriptableRenderPass</span>
    {
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">Material</span> <span style="color: #7590db;">blurMaterial</span>;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">passes</span>;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">downsample</span>;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">bool</span> <span style="color: #7590db;">copyToFramebuffer</span>;
        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">string</span> <span style="color: #7590db;">targetName</span>;
        <span style="color: #ce537a; font-weight: bold;">string</span> <span style="color: #7590db;">profilerTag</span>;

        <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">tmpId1</span>;
        <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">tmpId2</span>;

        <span style="color: #ce537a; font-weight: bold;">RenderTargetIdentifier</span> <span style="color: #7590db;">tmpRT1</span>;
        <span style="color: #ce537a; font-weight: bold;">RenderTargetIdentifier</span> <span style="color: #7590db;">tmpRT2</span>;

        <span style="color: #4f97d7; font-weight: bold;">private</span> <span style="color: #ce537a; font-weight: bold;">RenderTargetIdentifier</span> <span style="color: #7590db;">source</span> { <span style="color: #4f97d7; font-weight: bold;">get</span>; <span style="color: #4f97d7; font-weight: bold;">set</span>; }

        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">Setup</span>(<span style="color: #ce537a; font-weight: bold;">RenderTargetIdentifier</span> <span style="color: #7590db;">source</span>) {
            <span style="color: #4f97d7; font-weight: bold;">this</span>.source = source;
        }

        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #bc6ec5; font-weight: bold;">CustomRenderPass</span>(<span style="color: #ce537a; font-weight: bold;">string</span> <span style="color: #7590db;">profilerTag</span>)
        {
            <span style="color: #4f97d7; font-weight: bold;">this</span>.profilerTag = profilerTag;
        }

        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">Configure</span>(<span style="color: #ce537a; font-weight: bold;">CommandBuffer</span> <span style="color: #7590db;">cmd</span>, <span style="color: #ce537a; font-weight: bold;">RenderTextureDescriptor</span> <span style="color: #7590db;">cameraTextureDescriptor</span>)
        {
            <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">width</span> = cameraTextureDescriptor.width / downsample;
            <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">height</span> = cameraTextureDescriptor.height / downsample;

            tmpId1 = Shader.<span style="color: #bc6ec5; font-weight: bold;">PropertyToID</span>(<span style="color: #2d9574;">"tmpBlurRT1"</span>);
            tmpId2 = Shader.<span style="color: #bc6ec5; font-weight: bold;">PropertyToID</span>(<span style="color: #2d9574;">"tmpBlurRT2"</span>);
            cmd.<span style="color: #bc6ec5; font-weight: bold;">GetTemporaryRT</span>(tmpId1, width, height, 0, FilterMode.Bilinear, RenderTextureFormat.ARGB32);
            cmd.<span style="color: #bc6ec5; font-weight: bold;">GetTemporaryRT</span>(tmpId2, width, height, 0, FilterMode.Bilinear, RenderTextureFormat.ARGB32);

            tmpRT1 = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">RenderTargetIdentifier</span>(tmpId1);
            tmpRT2 = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">RenderTargetIdentifier</span>(tmpId2);

            <span style="color: #bc6ec5; font-weight: bold;">ConfigureTarget</span>(tmpRT1);
            <span style="color: #bc6ec5; font-weight: bold;">ConfigureTarget</span>(tmpRT2);
        }

        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">Execute</span>(<span style="color: #ce537a; font-weight: bold;">ScriptableRenderContext</span> <span style="color: #7590db;">context</span>, <span style="color: #4f97d7; font-weight: bold;">ref</span> <span style="color: #ce537a; font-weight: bold;">RenderingData</span> <span style="color: #7590db;">renderingData</span>)
        {
            <span style="color: #ce537a; font-weight: bold;">CommandBuffer</span> <span style="color: #7590db;">cmd</span> = CommandBufferPool.<span style="color: #bc6ec5; font-weight: bold;">Get</span>(profilerTag);

            <span style="color: #ce537a; font-weight: bold;">RenderTextureDescriptor</span> <span style="color: #7590db;">opaqueDesc</span> = renderingData.cameraData.cameraTargetDescriptor;
            opaqueDesc.depthBufferBits = 0;

            <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">first pass</span>
            <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">cmd.GetTemporaryRT(tmpId1, opaqueDesc, FilterMode.Bilinear);</span>
            cmd.<span style="color: #bc6ec5; font-weight: bold;">SetGlobalFloat</span>(<span style="color: #2d9574;">"_offset"</span>, 1.5f);
            cmd.<span style="color: #bc6ec5; font-weight: bold;">Blit</span>(source, tmpRT1, blurMaterial);

            <span style="color: #4f97d7; font-weight: bold;">for</span> (<span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">i</span>=1; i&lt;passes-1; i++) {
                cmd.<span style="color: #bc6ec5; font-weight: bold;">SetGlobalFloat</span>(<span style="color: #2d9574;">"_offset"</span>, 0.5f + i);
                cmd.<span style="color: #bc6ec5; font-weight: bold;">Blit</span>(tmpRT1, tmpRT2, blurMaterial);

                <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">pingpong</span>
                <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">rttmp</span> = tmpRT1;
                tmpRT1 = tmpRT2;
                tmpRT2 = rttmp;
            }

            <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">final pass</span>
            cmd.<span style="color: #bc6ec5; font-weight: bold;">SetGlobalFloat</span>(<span style="color: #2d9574;">"_offset"</span>, 0.5f + passes - 1f);
            <span style="color: #4f97d7; font-weight: bold;">if</span> (copyToFramebuffer) {
                cmd.<span style="color: #bc6ec5; font-weight: bold;">Blit</span>(tmpRT1, source, blurMaterial);
            } <span style="color: #4f97d7; font-weight: bold;">else</span> {
                cmd.<span style="color: #bc6ec5; font-weight: bold;">Blit</span>(tmpRT1, tmpRT2, blurMaterial);
                cmd.<span style="color: #bc6ec5; font-weight: bold;">SetGlobalTexture</span>(targetName, tmpRT2);
            }

            context.<span style="color: #bc6ec5; font-weight: bold;">ExecuteCommandBuffer</span>(cmd);
            cmd.<span style="color: #bc6ec5; font-weight: bold;">Clear</span>();

            CommandBufferPool.<span style="color: #bc6ec5; font-weight: bold;">Release</span>(cmd);
        }

        <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">FrameCleanup</span>(<span style="color: #ce537a; font-weight: bold;">CommandBuffer</span> <span style="color: #7590db;">cmd</span>)
        {
        }
    }

    <span style="color: #ce537a; font-weight: bold;">CustomRenderPass</span> <span style="color: #7590db;">scriptablePass</span>;

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">Create</span>()
    {
        scriptablePass = <span style="color: #4f97d7; font-weight: bold;">new</span> <span style="color: #ce537a; font-weight: bold;">CustomRenderPass</span>(<span style="color: #2d9574;">"KawaseBlur"</span>);
        scriptablePass.blurMaterial = settings.blurMaterial;
        scriptablePass.passes = settings.blurPasses;
        scriptablePass.downsample = settings.downsample;
        scriptablePass.copyToFramebuffer = settings.copyToFramebuffer;
        scriptablePass.targetName = settings.targetName;

        scriptablePass.renderPassEvent = settings.renderPassEvent;
    }

    <span style="color: #4f97d7; font-weight: bold;">public</span> <span style="color: #4f97d7; font-weight: bold;">override</span> <span style="color: #ce537a; font-weight: bold;">void</span> <span style="color: #bc6ec5; font-weight: bold;">AddRenderPasses</span>(<span style="color: #ce537a; font-weight: bold;">ScriptableRenderer</span> <span style="color: #7590db;">renderer</span>, <span style="color: #4f97d7; font-weight: bold;">ref</span> <span style="color: #ce537a; font-weight: bold;">RenderingData</span> <span style="color: #7590db;">renderingData</span>)
    {
        <span style="color: #ce537a; font-weight: bold;">var</span> <span style="color: #7590db;">src</span> = renderer.cameraColorTarget;
        scriptablePass.<span style="color: #bc6ec5; font-weight: bold;">Setup</span>(src);
        renderer.<span style="color: #bc6ec5; font-weight: bold;">EnqueuePass</span>(scriptablePass);
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org3e88b31" class="outline-6">
<h6 id="org3e88b31">len flares</h6>
<div class="outline-text-6" id="text-org3e88b31">
<ul class="org-ul">
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.1/manual/containers/create-custom-renderer-feature-1.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.1/manual/containers/create-custom-renderer-feature-1.html</a><br /></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org4673f29" class="outline-3">
<h3 id="org4673f29">Shader</h3>
<div class="outline-text-3" id="text-org4673f29">
</div>
<div id="outline-container-org52352b2" class="outline-4">
<h4 id="org52352b2">MultiPass</h4>
<div class="outline-text-4" id="text-org52352b2">
<p>
方案 1： shader 中多个 Pass。会打断 SRP Batch。<br />
方案 2： 为同一个物体使用多个材质<br />
</p>

<ul class="org-ul">
<li><a href="https://github.com/chavaloart/urp-multi-pass">https://github.com/chavaloart/urp-multi-pass</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org568fb32" class="outline-4">
<h4 id="org568fb32">Lightmap 烘培</h4>
<div class="outline-text-4" id="text-org568fb32">
<p>
<a href="./UnityCatLikeCoding.html#org6bd9ab0">Lightmap 烘培</a><br />
</p>
</div>
</div>
</div>
<div id="outline-container-orge895121" class="outline-3">
<h3 id="orge895121">Misc</h3>
<div class="outline-text-3" id="text-orge895121">
</div>
<div id="outline-container-orgee9466b" class="outline-4">
<h4 id="orgee9466b">Upgrade Buildin Shader To URP</h4>
<div class="outline-text-4" id="text-orgee9466b">
</div>
<div id="outline-container-orgf019368" class="outline-5">
<h5 id="orgf019368">Point Light Effect Error</h5>
<div class="outline-text-5" id="text-orgf019368">
<ul class="org-ul">
<li><a href="http://www.kittehface.com/2020/05/light-universal-render-pipeline-to.html">http://www.kittehface.com/2020/05/light-universal-render-pipeline-to.html</a><br /></li>
<li><a href="https://forum.unity.com/threads/lwrp-urp-point-light-issues.809382/">https://forum.unity.com/threads/lwrp-urp-point-light-issues.809382/</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org536a028" class="outline-5">
<h5 id="org536a028">Common</h5>
<div class="outline-text-5" id="text-org536a028">
<p>
URP 提供了下面工具，实现自动将 Buildin Shader 升级为 URP。<br />
Edit/Render Pipeline/Universal Render Pipeline/Upgrade Selected Materials to UniversalRP Materials<br />
</p>

<p>
工具实现在下面文件：<br />
com.unity.render-pipelines.universal@10.5.0\Editor\UniversalRenderPipelineMaterialUpgrader.cs<br />
</p>

<ul class="org-ul">
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/upgrading-your-shaders.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/upgrading-your-shaders.html</a><br /></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org9fa4f00" class="outline-4">
<h4 id="org9fa4f00">Unity Buildin 和 URP 支持的 Feature 对比</h4>
<div class="outline-text-4" id="text-org9fa4f00">
<ul class="org-ul">
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/universalrp-builtin-feature-comparison.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/universalrp-builtin-feature-comparison.html</a><br /></li>
<li>Upgrading shaders from Built-in <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/upgrading-your-shaders.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/upgrading-your-shaders.html</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org7f6ba79" class="outline-4">
<h4 id="org7f6ba79">创建一个 Lit Shader Graph 默认文件，生成的 shader 代码</h4>
<div class="outline-text-4" id="text-org7f6ba79">
<p>
下面文件是对 Lit Shader Graph 默认文件简化后的 shader 代码。<br />
<a href="./URP/urp_lit_shader_graph.shader">./URP/urp_lit_shader_graph.shader</a><br />
</p>

<p>
shader 的 vert frag 入口函数被定义在 com.unity.render-pipelines.universal/Editor/ShaderGraph/Includes/PBRForwardPass.hlsl 文件中。<br />
</p>
<div class="org-src-container">
<pre class="src src-shader">PackedVaryings <span style="color: #bc6ec5; font-weight: bold;">vert</span>(Attributes input)
{
    Varyings output = (Varyings)0;
    output = BuildVaryings(input);
    PackedVaryings packedOutput = (PackedVaryings)0;
    packedOutput = PackVaryings(output);
    <span style="color: #4f97d7; font-weight: bold;">return</span> packedOutput;
}

<span style="color: #ce537a; font-weight: bold;">half4</span> <span style="color: #bc6ec5; font-weight: bold;">frag</span>(PackedVaryings packedInput) : SV_TARGET
{
    Varyings unpacked = UnpackVaryings(packedInput);
    UNITY_SETUP_INSTANCE_ID(unpacked);
    UNITY_SETUP_STEREO_EYE_INDEX_POST_VERTEX(unpacked);

    SurfaceDescriptionInputs surfaceDescriptionInputs = BuildSurfaceDescriptionInputs(unpacked);
    SurfaceDescription surfaceDescription = SurfaceDescriptionFunction(surfaceDescriptionInputs);

<span style="color: #bc6ec5;">    #if</span> <span style="color: #7590db;">_ALPHATEST_ON</span>
        <span style="color: #ce537a; font-weight: bold;">half</span> alpha = surfaceDescription.Alpha;
        <span style="color: #4f97d7;">clip</span>(alpha - surfaceDescription.AlphaClipThreshold);
<span style="color: #bc6ec5;">    #elif</span> <span style="color: #7590db;">_SURFACE_TYPE_TRANSPARENT</span>
        <span style="color: #ce537a; font-weight: bold;">half</span> alpha = surfaceDescription.Alpha;
    #els
        <span style="color: #ce537a; font-weight: bold;">half</span> alpha = 1;
<span style="color: #bc6ec5;">    #endif</span>

    InputData inputData;
    InitializeInputData(unpacked, surfaceDescription, inputData);
    <span style="color: #2aa1ae; background-color: #292e34;">// TODO: Mip debug modes would require this, open question how to do this on ShaderGraph.</span>
    <span style="color: #2aa1ae; background-color: #292e34;">//SETUP_DEBUG_TEXTURE_DATA(inputData, unpacked.texCoord1.xy, _MainTex);</span>

<span style="color: #bc6ec5;">    #ifdef</span> <span style="color: #7590db;">_SPECULAR_SETUP</span>
        <span style="color: #ce537a; font-weight: bold;">float3</span> specular = surfaceDescription.<span style="color: #4f97d7; font-weight: bold;">Specular</span>;
        <span style="color: #ce537a; font-weight: bold;">float</span> metallic = 1;
<span style="color: #bc6ec5;">    #else</span>
        <span style="color: #ce537a; font-weight: bold;">float3</span> specular = 0;
        <span style="color: #ce537a; font-weight: bold;">float</span> metallic = surfaceDescription.Metallic;
<span style="color: #bc6ec5;">    #endif</span>

    <span style="color: #ce537a; font-weight: bold;">half3</span> normalTS = <span style="color: #ce537a; font-weight: bold;">half3</span>(0, 0, 0);
<span style="color: #bc6ec5;">    #if</span> defined(<span style="color: #7590db;">_NORMALMAP</span>) &amp;&amp; defined(<span style="color: #7590db;">_NORMAL_DROPOFF_TS</span>)
        normalTS = surfaceDescription.NormalTS;
<span style="color: #bc6ec5;">    #endif</span>

    SurfaceData surface;
    surface.albedo              = surfaceDescription.BaseColor;
    surface.metallic            = <span style="color: #4f97d7;">saturate</span>(metallic);
    surface.specular            = specular;
    surface.smoothness          = <span style="color: #4f97d7;">saturate</span>(surfaceDescription.Smoothness),
    surface.occlusion           = surfaceDescription.Occlusion,
    surface.emission            = surfaceDescription.<span style="color: #4f97d7; font-weight: bold;">Emission</span>,
    surface.alpha               = <span style="color: #4f97d7;">saturate</span>(alpha);
    surface.normalTS            = normalTS;
    surface.clearCoatMask       = 0;
    surface.clearCoatSmoothness = 1;

<span style="color: #bc6ec5;">    #ifdef</span> <span style="color: #7590db;">_CLEARCOA</span>
        surface.clearCoatMask       = <span style="color: #4f97d7;">saturate</span>(surfaceDescription.CoatMask);
        surface.clearCoatSmoothness = <span style="color: #4f97d7;">saturate</span>(surfaceDescription.CoatSmoothness);
<span style="color: #bc6ec5;">    #endif</span>

<span style="color: #bc6ec5;">#ifdef</span> <span style="color: #7590db;">_DBUFFER</span>
    ApplyDecalToSurfaceData(unpacked.positionCS, surface, inputData);
<span style="color: #bc6ec5;">#endif</span>

    <span style="color: #ce537a; font-weight: bold;">half4</span> color = UniversalFragmentPBR(inputData, surface);

    color.rgb = MixFog(color.rgb, inputData.fogCoord);
    <span style="color: #4f97d7; font-weight: bold;">return</span> color;
}
</pre>
</div>
<p>
生成的 shader 代码<br />
</p>
</div>
</div>
<div id="outline-container-orgb839c9e" class="outline-4">
<h4 id="orgb839c9e">URP Buildin GI 比较</h4>
<div class="outline-text-4" id="text-orgb839c9e">
<p>
下图为图 1<br />
</p>


<div id="org28313b5" class="figure">
<p><img src="./URP/gi_compare_01.png" alt="gi_compare_01.png" width="1500px" /><br />
</p>
</div>

<p>
下图为图 2<br />
</p>

<div id="orge72787c" class="figure">
<p><img src="./URP/gi_compare_02.png" alt="gi_compare_02.png" width="1500px" /><br />
</p>
</div>

<p>
下图为图 3<br />
</p>

<div id="org390ee0e" class="figure">
<p><img src="./URP/gi_compare_03.png" alt="gi_compare_03.png" width="1500px" /><br />
</p>
</div>

<p>
下图为图 4<br />
</p>

<div id="org663de73" class="figure">
<p><img src="./URP/gi_compare_04.png" alt="gi_compare_04.png" width="1500px" /><br />
</p>
</div>

<p>
下图为图 5<br />
</p>

<div id="orgd6a9e8c" class="figure">
<p><img src="./URP/gi_compare_05.png" alt="gi_compare_05.png" width="1500px" /><br />
</p>
</div>

<p>
图 1 中，Buildin 下 BakedGI 和 RealtimeGI 差别为什么很大？<br />
关闭 Mesh 的 LightProbe Blend，后差别几乎没有，说明 BakedGI 和 RealtimeGI 烘培所得的 LightProbe 不同，直接通过 FrameDebug 可以看到球谐系数不同。<br />
LightProbe 数据来自 AmbientColor，场景中方向光，场景中物体反射的光。前两个数据是相同的，所以只能是最后一个数据不同，而图 3 中，Buildin 下 BakedGI 和 RealtimeGI 差别不大，说明 Surface Shader 和 Standard Shader 烘培出来的结果不同。<br />
使用默认的 Surface Shader 进行测试，如图 5，发现 Buildin 下 BakedGI 和 RealtimeGI 差别不大。说明自定义的 Surface Shader 和默认的 Surface Shader 烘培出来的结果不同。<br />
</p>

<p>
检查自定义的 Surface Shader，发现其中会使用 viewDir，猜测在离线烘焙时，viewDir 的值为（0，0，0），所以导致 Custom Surface Shader MetaPass 返回的 albedo 是错误的。<br />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf32f3b1" class="outline-2">
<h2 id="orgf32f3b1">HDRP</h2>
<div class="outline-text-2" id="text-orgf32f3b1">
</div>
<div id="outline-container-org71117d7" class="outline-3">
<h3 id="org71117d7">Setup</h3>
<div class="outline-text-3" id="text-org71117d7">
<ol class="org-ol">
<li>安装 HDRP package<br /></li>
<li>打开 HDRP 设置向导 Window/Rendering/HDRP Wizard, 如果有设置错误，直接点击 FixAll<br /></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orge61499c" class="outline-2">
<h2 id="orge61499c">ERROR</h2>
<div class="outline-text-2" id="text-orge61499c">
</div>
<div id="outline-container-org73e3a05" class="outline-4">
<h4 id="org73e3a05">Material 'Liquid' with Shader 'Custom/MyEffect/Unlit/Liquid' doesn't have a texture property '_MainTex' UnityEngine.GUIUtility:ProcessEvent (int,intptr,bool&amp;)</h4>
<div class="outline-text-4" id="text-org73e3a05">
<p>
URP 中使用_BaseMap 代替了_MainTex。并在_BaseMap 的前面标记了[MainTexture]。Editor 中有代码依赖_MainTex 命名，所以导致了该错误。<br />
在 Shader 'Custom/MyEffect/Unlit/Liquid' 的 Property 部分添加如下代码就可以解决该问题<br />
</p>

<div class="org-src-container">
<pre class="src src-shader"><span style="color: #2aa1ae; background-color: #292e34;">// ObsoleteProperties</span>
<span style="color: #2aa1ae; background-color: #292e34;">//[HideInInspector] _MainTex("BaseMap", 2D) = "white" {}</span>
<span style="color: #2aa1ae; background-color: #292e34;">//[HideInInspector] _Color("Base Color", Color) = (1, 1, 1, 1)</span>
</pre>
</div>

<ul class="org-ul">
<li><a href="https://docs.unity3d.com/ScriptReference/Material-mainTexture.html">https://docs.unity3d.com/ScriptReference/Material-mainTexture.html</a><br /></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org1be03d7" class="outline-2">
<h2 id="org1be03d7">参考资料</h2>
<div class="outline-text-2" id="text-org1be03d7">
<ul class="org-ul">
<li><a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/index.html">https://docs.unity3d.com/Packages/com.unity.render-pipelines.universal@12.0/manual/index.html</a><br /></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="vssue"></div>
        <link rel="stylesheet" href="https://unpkg.com/vssue/dist/vssue.min.css">
        <script src="https://unpkg.com/vue@2.7.10/dist/vue.runtime.min.js"></script>
        <script src="https://unpkg.com/vssue/dist/vssue.github.min.js"></script>
        <script>
          new Vue({
            el: '#vssue',
            render: h => h('Vssue', {
              props: {
                // 在这里设置当前页面对应的 Issue 标题
                title: 'URP',

                // 在这里设置你使用的平台的 OAuth App 配置
                options: {
                    owner: 'wolfand11',
                    repo: 'blog_comments',
                    clientId: 'a02b49185d85859cb92c',
                    clientSecret: '6f123085c6f1ce339e2517d24e5b099fa1dc9c85', // 只有在使用某些平台时需要
                },
              }
            })
          })
        </script>
</div>
</body>
</html>