<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-10-27 周二 14:37 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Computer System</title>
<meta name="generator" content="Org mode" />
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
           <meta name="viewport" content="width=device-width, initial-scale=1" />
           <link rel="stylesheet" title="Standard" href="https://wolfand11.gitee.io/res/css/worg.css" type="text/css" />
           <link rel="alternate stylesheet" title="Zenburn" href="https://wolfand11.gitee.io/res/css/worg-zenburn.css" type="text/css" />
           <link rel="alternate stylesheet" title="Classic" href="https://wolfand11.gitee.io/res/css/worg-classic.css" type="text/css" />
           <link rel="icon" href="https://wolfand11.gitee.io/res/favicon.ico" type="image/ico" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="https://wolfand11.gitee.io"> HOME </a>
</div><div id="content">
<h1 class="title">Computer System</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org174098f">Computer System</a>
<ul>
<li><a href="#org57e3b24">内存管理</a></li>
<li><a href="#org6f4e460">虚拟内存</a>
<ul>
<li><a href="#orgc204710">动态内存分配</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd262cfd">Computer Systems: A Programmer's Perspective</a>
<ul>
<li><a href="#org8548622">程序结构和执行</a>
<ul>
<li><a href="#org1086826">信息的表示和处理</a>
<ul>
<li><a href="#orgb3c29fd">整数</a>
<ul>
<li><a href="#org1231ab7">整数的表示</a></li>
<li><a href="#orgc4e17eb">有符号数和无符号数之间的转换</a></li>
<li><a href="#org436412a">移位运算</a></li>
<li><a href="#org2633ca3">整数的运算</a></li>
</ul>
</li>
<li><a href="#org7d93b5a">浮点数</a>
<ul>
<li><a href="#orgb1ae030">浮点数表示</a></li>
<li><a href="#org38aa198">舍入</a></li>
<li><a href="#orgbcdcd11">浮点数运算</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
Computer System note.<br />
</p>
<div class="HTML">
<p>
&lt;!&#x2013; more &#x2013;&gt;<br />
</p>

</div>

<div id="outline-container-org174098f" class="outline-2">
<h2 id="org174098f">Computer System</h2>
<div class="outline-text-2" id="text-org174098f">
</div>
<div id="outline-container-org57e3b24" class="outline-3">
<h3 id="org57e3b24">内存管理</h3>
<div class="outline-text-3" id="text-org57e3b24">
<ul class="org-ul">
<li>内存管理详细 <a href="https://www.cnblogs.com/peterYong/p/6556619.html">https://www.cnblogs.com/peterYong/p/6556619.html</a><br /></li>
<li>内存管理 <a href="http://www.cnblogs.com/CareySon/archive/2012/04/25/2470063.html">http://www.cnblogs.com/CareySon/archive/2012/04/25/2470063.html</a><br /></li>
</ul>
</div>
</div>
<div id="outline-container-org6f4e460" class="outline-3">
<h3 id="org6f4e460">虚拟内存</h3>
<div class="outline-text-3" id="text-org6f4e460">
</div>
<div id="outline-container-orgc204710" class="outline-4">
<h4 id="orgc204710">动态内存分配</h4>
<div class="outline-text-4" id="text-orgc204710">
<ul class="org-ul">
<li>内存管理内幕 <a href="https://www.ibm.com/developerworks/cn/linux/l-memory/">https://www.ibm.com/developerworks/cn/linux/l-memory/</a><br /></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd262cfd" class="outline-2">
<h2 id="orgd262cfd">Computer Systems: A Programmer's Perspective</h2>
<div class="outline-text-2" id="text-orgd262cfd">
</div>
<div id="outline-container-org8548622" class="outline-3">
<h3 id="org8548622">程序结构和执行</h3>
<div class="outline-text-3" id="text-org8548622">
</div>
<div id="outline-container-org1086826" class="outline-4">
<h4 id="org1086826">信息的表示和处理</h4>
<div class="outline-text-4" id="text-org1086826">
</div>
<div id="outline-container-orgb3c29fd" class="outline-5">
<h5 id="orgb3c29fd">整数</h5>
<div class="outline-text-5" id="text-orgb3c29fd">
<p>
该部分用到的一些记号说明如下：<br />
<img src="./ComputerSystem/2020_05_24_int_uint_notation.jpg" alt="2020_05_24_int_uint_notation.jpg" /><br />
</p>
</div>

<div id="outline-container-org1231ab7" class="outline-6">
<h6 id="org1231ab7">整数的表示</h6>
<div class="outline-text-6" id="text-org1231ab7">

<div class="figure">
<p><img src="./ComputerSystem/2020_05_24_int_uint_exp.jpg" alt="2020_05_24_int_uint_exp.jpg" /><br />
</p>
</div>

<p>
上图展示了以下内容：<br />
</p>
<ul class="org-ul">
<li>无符号数的编码<br /></li>
<li>补码编码<br /></li>
<li>反码、原码编码<br /></li>
</ul>
</div>

<ul class="org-ul">
<li><a id="org9e26640"></a><span class="todo TODO">TODO</span> 为什么要用补码表示有符号整数？<br /></li>
</ul>
</div>

<div id="outline-container-orgc4e17eb" class="outline-6">
<h6 id="orgc4e17eb">有符号数和无符号数之间的转换</h6>
<div class="outline-text-6" id="text-orgc4e17eb">

<div class="figure">
<p><img src="./ComputerSystem/2020_05_24_int_uint_convert.jpg" alt="2020_05_24_int_uint_convert.jpg" /><br />
</p>
</div>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#26377;&#31526;&#21495;&#25968;&#21644;&#26080;&#31526;&#21495;&#25968;&#20043;&#38388;&#30340;&#36716;&#25442;</span>
<span style="color: #2aa1ae; background-color: #292e34;">//// </span><span style="color: #2aa1ae; background-color: #292e34;">&#24378;&#21046;&#31867;&#22411;&#36716;&#25442;&#30340;&#32467;&#26524;&#20445;&#25345;&#20301;&#20540;&#19981;&#21464;&#65292;&#21482;&#26159;&#25913;&#21464;&#20102;&#35299;&#37322;&#36825;&#20123;&#20301;&#30340;&#26041;&#24335;&#12290;</span>
<span style="color: #ce537a; font-weight: bold;">short</span> <span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">v</span>=-12345;
<span style="color: #ce537a; font-weight: bold;">unsigned</span> <span style="color: #ce537a; font-weight: bold;">short</span> <span style="color: #7590db;">uv</span> = (<span style="color: #ce537a; font-weight: bold;">unsigned</span> <span style="color: #ce537a; font-weight: bold;">short</span>) v;
printf(<span style="color: #2d9574;">"v = %d, uv = %u\n"</span>, v, uv);

<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">v = -12345, uv = 53191;</span>

<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#25193;&#23637;&#19968;&#20010;&#25968;&#23383;</span>
<span style="color: #ce537a; font-weight: bold;">short</span> <span style="color: #7590db;">sx</span> = -12345;           <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">-12345</span>
<span style="color: #ce537a; font-weight: bold;">unsigned</span> <span style="color: #ce537a; font-weight: bold;">short</span> <span style="color: #7590db;">usx</span> = sx;     <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">53191</span>
<span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">x</span> = sx;                  <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">-12345</span>
<span style="color: #ce537a; font-weight: bold;">unsigned</span> <span style="color: #7590db;">ux</span> = usx;           <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">53191</span>

<span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">&#25130;&#26029;&#25968;&#23383;</span>
<span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">x</span> = 53191;
<span style="color: #ce537a; font-weight: bold;">short</span> <span style="color: #7590db;">sx</span> = (<span style="color: #ce537a; font-weight: bold;">short</span>) x; <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">-12345</span>
<span style="color: #ce537a; font-weight: bold;">int</span> <span style="color: #7590db;">y</span> = sx;           <span style="color: #2aa1ae; background-color: #292e34;">// </span><span style="color: #2aa1ae; background-color: #292e34;">-12345</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org436412a" class="outline-6">
<h6 id="org436412a">移位运算</h6>
<div class="outline-text-6" id="text-org436412a">
<p>
对于一个位表示为[X(w-1), X(w-2), ···, X(0)]的操作数 x：<br />
左移操作：C 语言表达式 x&lt;&lt;k 会生成一个值，其位表示为[X(w-k-1), X(w-k-2), ···, X(0), 0, ···, 0]<br />
逻辑右移操作：逻辑右移在左端补 k 个 0，结果为[X(w-k-1), X(w-k-2), ···, X(0), 0, ···, 0]<br />
算术右移操作：算术右移在左端补 k 个最高有效位的值，结果为[X(w-1), X(w-1), ···, X(w-1),  X(w-2), ···, X(k)]<br />
</p>


<div class="figure">
<p><img src="./ComputerSystem/2020_05_24_bitwize_shift.jpg" alt="2020_05_24_bitwize_shift.jpg" /><br />
</p>
</div>
</div>
</div>

<div id="outline-container-org2633ca3" class="outline-6">
<h6 id="org2633ca3">整数的运算</h6>
<div class="outline-text-6" id="text-org2633ca3">
<p>
<img src="./ComputerSystem/2020_05_24_int_add_minus.jpg" alt="2020_05_24_int_add_minus.jpg" /><br />
<img src="./ComputerSystem/2020_05_24_int_add_minus_overflow.jpg" alt="2020_05_24_int_add_minus_overflow.jpg" /><br />
上图展示了加减运算，即加减运算产生的溢出<br />
</p>

<p>
<img src="./ComputerSystem/2020_05_24_int_uint_mul.jpg" alt="2020_05_24_int_uint_mul.jpg" /><br />
上图展示了乘法运算<br />
</p>

<p>
<img src="./ComputerSystem/2020_05_24_int_uint_divide.jpg" alt="2020_05_24_int_uint_divide.jpg" /><br />
上图展示了除法运算<br />
</p>

<p>
加法、减法、位级运算和移位只需要 1 个时钟周期<br />
乘法指令在比较老的 CPU 上需要 10 个或者更多时钟周期(Intel Core i7 Haswell 上需要 3 个时钟周期)<br />
除法指令在比较老的 CPU 上需要 30 个或者更多时钟周期.<br />
</p>

<p>
可以将乘法转化为加法、减法、移位的组合，例如：<br />
14 = 2^3 + 2^2 + 2^1 所以 x*14=(x&lt;&lt;3)+(x&lt;&lt;2)+(x&lt;&lt;1)<br />
14 = 2^4 - 2^1 所以 x*14=(x&lt;&lt;4)-(x&lt;&lt;1)<br />
任何一个整数都可以表示为 2 的幂次之和，所以乘法都可以转化为位移和加法操作。但是只有当乘法转化为少量的移位、加法和减法时，编译器才会执行这种转化，从而优化性能。<br />
当一个整数为 2 的幂次时，可以将除该整数转化为位移操作。而整数不为 2 的幂次时，则无法像乘法那样转化为位移操作了。<br />
</p>
</div>
</div>
</div>
<div id="outline-container-org7d93b5a" class="outline-5">
<h5 id="org7d93b5a">浮点数</h5>
<div class="outline-text-5" id="text-org7d93b5a">
</div>
<div id="outline-container-orgb1ae030" class="outline-6">
<h6 id="orgb1ae030">浮点数表示</h6>
<div class="outline-text-6" id="text-orgb1ae030">
<p>
<a id="orga645178"></a><br />
</p>

<p>
下图展示了 IEEE 浮点数表示的规则：<br />
<img src="./ComputerSystem/2020_05_22_float_number_rule.jpg" alt="2020_05_22_float_number_rule.jpg" /><br />
</p>

<p>
下图展示了 8 位浮点数表示的示例：<br />
<img src="./ComputerSystem/2020_05_22_float_number_rule_example.jpg" alt="2020_05_22_float_number_rule_example.jpg" /><br />
</p>

<p>
下图展示了 32 位浮点数表示的示例：<br />
<img src="./ComputerSystem/2020_05_22_float_number_rule_example_32.jpg" alt="2020_05_22_float_number_rule_example_32.jpg" /><br />
</p>

<p>
浮点数表示的连续性，可以将浮点数的表示有一种更直观的理解：<br />
e 间隔 1 的数落在[2^e, 2^(e+1)) 范围内，并且这个范围内，任意两个相邻的浮点数的间隔为 2^(e-23)  (以 float 为例)<br />
</p>

<ul class="org-ul">
<li>浮点数象形表示法 <a href="https://zhuanlan.zhihu.com/p/138845520">https://zhuanlan.zhihu.com/p/138845520</a><br /></li>
<li>Floating Point Visually Explained <a href="https://fabiensanglard.net/floating_point_visually_explained/index.html">https://fabiensanglard.net/floating_point_visually_explained/index.html</a><br /></li>
</ul>
</div>
</div>

<div id="outline-container-org38aa198" class="outline-6">
<h6 id="org38aa198">舍入</h6>
<div class="outline-text-6" id="text-org38aa198">
<p>
舍入的一个关键问题是在两个可能值的中间如何确定舍入方向。IEEE 浮点格式定义了四种不同的舍入方式。<br />
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">方式</th>
<th scope="col" class="org-right">1.40 美元</th>
<th scope="col" class="org-right">1.60 美元</th>
<th scope="col" class="org-right">1.50 美元</th>
<th scope="col" class="org-right">2.50 美元</th>
<th scope="col" class="org-right">-1.50 美元</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">向偶数舍入</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">-2</td>
</tr>

<tr>
<td class="org-left">向零舍入</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">-1</td>
</tr>

<tr>
<td class="org-left">向下舍入</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">-2</td>
</tr>

<tr>
<td class="org-left">向上舍入</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">-1</td>
</tr>
</tbody>
</table>

<p>
向偶数舍入也被称为向最接近的值舍入，其为默认的方式。给定值为两个可能值的中间值时，向偶数舍入将数字向上或者向下舍入，使得结果的最低有效数字为偶数。（例如：上面向偶数舍入将 1.5 和 2.5 都舍入为 2）<br />
</p>

<p>
向偶数舍入应用于二进制数时，最低有效位的值为 0 认为是偶数，值为 1 认为是奇数。只有对于形如 XX···X.YY···Y1000 的二进制位模式的数，这种舍入方式才有效，其中 X 和 Y 表示任意位值，最右边 Y 是要被舍入的位置。<br />
</p>
</div>

<ul class="org-ul">
<li><a id="org3c34275"></a>为什么要采用偶数舍入，而不是始终将位于两个可表示的值中间的值都向上舍入呢？<br />
<div class="outline-text-7" id="text-org3c34275">
<p>
将位于两个可表示的值中间的值都向上舍入，这种方法舍入一组数值，会在计算这些值的平均数中引入统计偏差，其结果比本身略高。相反，将位于两个可表示的值中间的值都向下舍入，其结果比本身略低。使用偶数舍入可以在大多数情况中避免这种统计偏差，在 50%时间里其向上舍入，而在 50%的时间里其向下舍入。<br />
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgbcdcd11" class="outline-6">
<h6 id="orgbcdcd11">浮点数运算</h6>
<div class="outline-text-6" id="text-orgbcdcd11">
</div>
<ul class="org-ul">
<li><a id="orge75d01e"></a>浮点数算术运算<br />
<div class="outline-text-7" id="text-orge75d01e">

<div class="figure">
<p><img src="./ComputerSystem/2020_05_24_float_algrithem.jpg" alt="2020_05_24_float_algrithem.jpg" /><br />
</p>
</div>

<p>
下图展示了，浮点数加法运算时，舍入所导致的误差范围：<br />
<img src="./ComputerSystem/2020_05_24_float_round_err.jpg" alt="2020_05_24_float_round_err.jpg" /><br />
</p>

<p>
下图展示了，从浮点运算导出的一些结论：<br />
<img src="./ComputerSystem/2020_05_24_float_calc_rule.jpg" alt="2020_05_24_float_calc_rule.jpg" /><br />
</p>
</div>
</li>

<li><a id="org50e425d"></a>Error Propagation<br />
<div class="outline-text-7" id="text-org50e425d">
<p>
下图展示了 Forward Error Analysis 和 Backword Error Analysis:<br />
<img src="./ComputerSystem/2020_05_25_forward_backward_error.jpg" alt="2020_05_25_forward_backward_error.jpg" /><br />
下图展示了对浮点计算误差的分析和定界：<br />
<img src="./ComputerSystem/2020_05_25_error_propagation.jpg" alt="2020_05_25_error_propagation.jpg" /><br />
</p>

<ul class="org-ul">
<li><a href="http://www.mathcs.emory.edu/~nagy/courses/fall12/515/Conditioning_and_FLOPS.pdf">http://www.mathcs.emory.edu/~nagy/courses/fall12/515/Conditioning_and_FLOPS.pdf</a><br /></li>
<li><a href="https://baike.baidu.com/item/%E5%8C%BA%E9%97%B4">https://baike.baidu.com/item/%E5%8C%BA%E9%97%B4</a><br /></li>
</ul>
</div>
</li>
<li><a id="org5e07251"></a>Running Error Analysis<br />
<div class="outline-text-7" id="text-org5e07251">
<p>
除了通过代数的方法来得出误差范围，也可以让计算机为我们做这项工作，这种方式被称为 running error analysis.其背后的理念是，每次执行浮点运算时，同时计算累积到当前计算的误差范围。<br />
</p>

<p>
具体的实现参考 <a href="../graphics/LightingModel.html#org21dfeb7">../graphics/LightingModel.html#org21dfeb7</a><br />
</p>
</div>
</li>
<li><a id="orge179f53"></a>Misc<br />
<div class="outline-text-7" id="text-orge179f53">
<p>
v&gt;0 v/0 = Infinity<br />
v&lt;0 v/0 = -Infinity<br />
v&gt;0 v*Infinity = Infinity<br />
v&lt;0 v*Infinity = -Infinity<br />
</p>

<p>
0*infinity = NaN<br />
Infinity - Infinity = NaN<br />
Infinity + Infinity = Infinity<br />
NaN + v = NaN<br />
NaN 和任意数字的比较都为 false<br />
</p>

<ul class="org-ul">
<li>浮点数加法是可交换的。<br /></li>
<li>浮点数加法不具有结合性（因为舍入或溢出）。<br />
(3.14+1e10)-1e10 = 0<br />
3.14+(1e10-1e10) = 3.14<br />
1e10 是 C/C++规定的浮点数的科学计数写法,意思是 1.0x10 的 10 次方<br /></li>
<li>浮点数加法满足单调性属性：如果 a&gt;=b,那么对于任何 a、b 以及 x 的值，除了 NaN，都有 x+a&gt;=x+b。<br /></li>

<li>浮点数乘法是可交换的。<br /></li>
<li>浮点数乘法不具有结合性（因为舍入或溢出）。<br />
(1e20*1e20)*1e-20 为无穷大<br />
1e20*(1e20*1e-20) 为 1e20<br /></li>
<li>浮点乘法在加法上不具备分配性。<br />
1e20*(1e20-1e20) = 0<br />
1e20*1e-20-1e20*1e-20 = NaN<br /></li>
<li>浮点乘法满足下列单调性：对于任何 a、b、c,并且 a、b、c 都不为 NaN,浮点乘法满足<br />
a&gt;=b 且 c&gt;=0 则 a*c&gt;=b*c<br />
a&gt;=b 且 c&lt;=0 则 a*c&lt;=b*c<br />
无符号或补码的乘法没有这些单调性属性，因为溢出时会取模。<br /></li>
</ul>
</div>
</li>

<li><a id="org26edacb"></a>Tips<br />
<div class="outline-text-7" id="text-org26edacb">
<p>
本节内容部分来自 Physically Based Rendering_v3_en 3.9 节 Managing Rounding Error.<br />
</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
